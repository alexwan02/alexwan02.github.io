<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
<meta name="twitter:description">
  
    <link rel="alternative" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Android：Material-Design笔记（一）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/31/Android：Material-Design笔记（一）/" class="article-date">
  <time datetime="2016-01-30T17:30:44.000Z" itemprop="datePublished">2016-01-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/31/Android：Material-Design笔记（一）/">Android：Material Design笔记（一）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="http://inthecheesefactory.com/blog/android-design-support-library-codelab/en" target="_blank" rel="external">Codelab for Android Design Support Library used in I/O Rewind Bangkok session</a></p>
<p><a href="http://developer.android.com/design/material/index.html" target="_blank" rel="external">Material Design for Android</a></p>
<p><a href="http://www.google.com/design/spec/material-design/introduction.html#" target="_blank" rel="external">Material Design Introduction</a></p>
<h3 id="u4E00_u3001_u51C6_u5907"><a href="#u4E00_u3001_u51C6_u5907" class="headerlink" title="一、准备"></a>一、准备</h3><h4 id="1-_style-xml_u914D_u7F6E"><a href="#1-_style-xml_u914D_u7F6E" class="headerlink" title="1. style.xml配置"></a>1. style.xml配置</h4><figure class="highlight xml"><figcaption><span>res/style.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--NoActionBar --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">resources</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Base application theme. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">style</span> <span class="attribute">name</span>=<span class="value">"AppTheme"</span> <span class="attribute">parent</span>=<span class="value">"Theme.AppCompat.Light.DarkActionBar"</span>&gt;</span><span class="css"></span><br><span class="line">        &lt;!<span class="tag">--</span> <span class="tag">Customize</span> <span class="tag">your</span> <span class="tag">theme</span> <span class="tag">here</span>. <span class="tag">--</span>&gt;</span><br><span class="line">        &lt;<span class="tag">item</span> <span class="tag">name</span>="<span class="tag">colorPrimary</span>"&gt;<span class="at_rule">@<span class="keyword">color/colorPrimary&lt;/item&gt;</span></span><br><span class="line">        &lt;item name=<span class="string">"colorPrimaryDark"</span>&gt;@color/colorPrimaryDark&lt;/item&gt;</span><br><span class="line">        &lt;item name=<span class="string">"colorAccent"</span>&gt;@color/colorAccent&lt;/item&gt;</span><br><span class="line">    </span></span><span class="tag">&lt;/<span class="title">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-gradle__u4F9D_u8D56"><a href="#2-gradle__u4F9D_u8D56" class="headerlink" title="2.gradle 依赖"></a>2.gradle 依赖</h4><p>在app的build.gradle中添加Design Support依赖<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">compile <span class="string">'com.android.support:support-v4:23.0.1'</span></span><br><span class="line">compile <span class="string">'com.android.support:appcompat-v7:23.0.1'</span></span><br><span class="line">compile <span class="string">'com.android.support:design:23.0.1'</span></span><br></pre></td></tr></table></figure></p>
<h4 id="3-_u5E03_u5C40_u6587_u4EF6"><a href="#3-_u5E03_u5C40_u6587_u4EF6" class="headerlink" title="3.布局文件"></a>3.布局文件</h4><figure class="highlight xml"><figcaption><span>layout/activity_main.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">android.support.v4.widget.DrawerLayout</span></span><br><span class="line">    <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    <span class="attribute">xmlns:tools</span>=<span class="value">"http://schemas.android.com/tools"</span></span><br><span class="line">    <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"match_parent"</span></span><br><span class="line">    <span class="attribute">android:paddingLeft</span>=<span class="value">"@dimen/activity_horizontal_margin"</span></span><br><span class="line">    <span class="attribute">android:paddingRight</span>=<span class="value">"@dimen/activity_horizontal_margin"</span></span><br><span class="line">    <span class="attribute">android:paddingTop</span>=<span class="value">"@dimen/activity_vertical_margin"</span></span><br><span class="line">    <span class="attribute">android:paddingBottom</span>=<span class="value">"@dimen/activity_vertical_margin"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">android.support.v4.widget.DrawerLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="u4E8C_u3001_u6DFB_u52A0FAB"><a href="#u4E8C_u3001_u6DFB_u52A0FAB" class="headerlink" title="二、添加FAB"></a>二、添加FAB</h3><p>Floating Action Button (FAB) 是带有阴影效果的圆形Button。在<code>activity_main.xml</code>中添加FloatingActionButton布局，FAB需要有个父布局来确定它在布局文件中的具体位置，所以把FAB放在FrameLayout中。如：<code>android:layout_gravity=&quot;bottom|end&quot;</code>表示FAB位于整个布局的右下角。</p>
<figure class="highlight xml"><figcaption><span>layout/activity_main.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">android.support.v4.widget.DrawerLayout</span></span><br><span class="line">    <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    <span class="attribute">xmlns:app</span>=<span class="value">"http://schemas.android.com/apk/res-auto"</span></span><br><span class="line">    <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"match_parent"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">FrameLayout</span></span><br><span class="line">        <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">        <span class="attribute">android:layout_height</span>=<span class="value">"match_parent"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">android.support.design.widget.FloatingActionButton</span></span><br><span class="line">            <span class="attribute">android:layout_width</span>=<span class="value">"wrap_content"</span></span><br><span class="line">            <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span></span><br><span class="line">            <span class="attribute">android:layout_gravity</span>=<span class="value">"bottom|end"</span></span><br><span class="line">            <span class="attribute">android:src</span>=<span class="value">"@drawable/ic_plus"</span></span><br><span class="line">            <span class="attribute">app:fabSize</span>=<span class="value">"normal"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">FrameLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">android.support.v4.widget.DrawerLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="1-_android_3Asrc"><a href="#1-_android_3Asrc" class="headerlink" title="1. android:src"></a>1. android:src</h4><p>表示FAB中的图标。建议大小为40dp的透明png图片。</p>
<h4 id="2-_app_3AfabSize"><a href="#2-_app_3AfabSize" class="headerlink" title="2. app:fabSize"></a>2. app:fabSize</h4><p>表示FAB的大小。有<code>normal</code>、<code>min</code>两个值。normal的大小为56dp，min的大小为40dp。</p>
<p>5.0的效果</p>
<div><br><image src="http://inthecheesefactory.com/uploads/source/designlibrary/screenshot21.jpg"><br></image></div>

<p>4.x的效果</p>
<div><br><image src="http://inthecheesefactory.com/uploads/source/designlibrary/screenshot20.jpg"><br></image></div>

<p>在同样的布局文件中，两个的margin并不一致。design library开发小组把这个问题已确认为bug。目前的解决方案是在api 21+的dimens资源中设置FAB的margin值设置为16dp，低于api 21的dimens资源中设置FAB的margin值为0dp</p>
<p>res/values/dimens.xml</p>
<figure class="highlight xml"><figcaption><span>res/values/dimens.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">dimen</span> <span class="attribute">name</span>=<span class="value">"codelab_fab_margin_right"</span>&gt;</span>0dp<span class="tag">&lt;/<span class="title">dimen</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">dimen</span> <span class="attribute">name</span>=<span class="value">"codelab_fab_margin_bottom"</span>&gt;</span>0dp<span class="tag">&lt;/<span class="title">dimen</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>res/values-v21/dimens.xml</p>
<figure class="highlight xml"><figcaption><span>res/values-v21/dimens.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">dimen</span> <span class="attribute">name</span>=<span class="value">"codelab_fab_margin_right"</span>&gt;</span>16dp<span class="tag">&lt;/<span class="title">dimen</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">dimen</span> <span class="attribute">name</span>=<span class="value">"codelab_fab_margin_bottom"</span>&gt;</span>16dp<span class="tag">&lt;/<span class="title">dimen</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>res/layout/activity_code_lab.xml 中设定FAB的margin值<br><figure class="highlight xml"><figcaption><span>res/layout/activity_code_lab.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">android.support.design.widget.FloatingActionButton</span></span><br><span class="line">    <span class="attribute">...</span></span><br><span class="line">    <span class="attribute">android:layout_marginBottom</span>=<span class="value">"@dimen/codelab_fab_margin_bottom"</span></span><br><span class="line">    <span class="attribute">android:layout_marginRight</span>=<span class="value">"@dimen/codelab_fab_margin_right"</span></span><br><span class="line">    <span class="attribute">...</span>/&gt;</span></span><br></pre></td></tr></table></figure></p>
<h4 id="3-_app_3Aelevation"><a href="#3-_app_3Aelevation" class="headerlink" title="3. app:elevation"></a>3. app:elevation</h4><p>FAB的阴影深度。默认为6dp</p>
<h4 id="4-_app_3ApressedTranslationZ"><a href="#4-_app_3ApressedTranslationZ" class="headerlink" title="4. app:pressedTranslationZ"></a>4. app:pressedTranslationZ</h4><p>FAB按住时的阴影深度。默认为12dp</p>
<h4 id="5-app_3AbackgroundTint"><a href="#5-app_3AbackgroundTint" class="headerlink" title="5.app:backgroundTint"></a>5.app:backgroundTint</h4><p>FAB背景颜色。默认使用样式中的<code>colorAccent</code>的颜色。</p>
<h4 id="6-FAB_u70B9_u51FB_u4E8B_u4EF6"><a href="#6-FAB_u70B9_u51FB_u4E8B_u4EF6" class="headerlink" title="6.FAB点击事件"></a>6.FAB点击事件</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">FloatingActionButton fabBtn;</span><br><span class="line">...</span><br><span class="line">fabBtn = (FloatingActionButton) findViewById(R.id.fabBtn);</span><br><span class="line">    fabBtn.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<h3 id="u4E09_u3001_u4F7F_u7528Snackbar"><a href="#u4E09_u3001_u4F7F_u7528Snackbar" class="headerlink" title="三、使用Snackbar"></a>三、使用Snackbar</h3><p>Snackbar，一个在屏幕底部显示的黑色条，可以设置显示的文本。类似Toast，与Toast不一样的是，Snackbar为UI的一部分，而Toast是浮动在屏幕上。</p>
<div><br>    <image src="http://inthecheesefactory.com/uploads/source/designlibrary/snackbar.jpg"><br></image></div>

<h4 id="1-__u5B9E_u4F8B_u5316_Snackbar"><a href="#1-__u5B9E_u4F8B_u5316_Snackbar" class="headerlink" title="1. 实例化 Snackbar"></a>1. 实例化 Snackbar</h4><p>Snackbar make(@NonNull View view, @NonNull CharSequence text, int duration)</p>
<ul>
<li>view Snackbar 的显示位置</li>
<li>text 显示的文字</li>
<li>duration  Snackbar显示的时长 <code>LENGTH_SHORT</code>或<code>LENGTH_LONG</code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">FrameLayout rootLayout;</span><br><span class="line">...</span><br><span class="line">rootLayout = (FrameLayout) findViewById(R.id.rootLayout);</span><br><span class="line">...</span><br><span class="line">fabBtn = (FloatingActionButton) findViewById(R.id.fabBtn);</span><br><span class="line">fabBtn.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        Snackbar.make(rootLayout, <span class="string">"Hello. I am Snackbar!"</span>, Snackbar.LENGTH_SHORT)</span><br><span class="line">                .setAction(<span class="string">"Undo"</span>, <span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">                    <span class="annotation">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                .show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>效果：</p>
<div><br>    <image src="http://inthecheesefactory.com/uploads/source/designlibrary/screenshot24.jpg"><br></image></div>

<p>Snackbar显示的有问题，是因为Snackbar需要Design Library的CoordinatorLayout布局配合来使用。</p>
<h3 id="u56DB_u3001CoordinatorLayout"><a href="#u56DB_u3001CoordinatorLayout" class="headerlink" title="四、CoordinatorLayout"></a>四、CoordinatorLayout</h3><p>CoordinatorLayout是由Design Library的新添的布局，可以让包含的View和相协调。必须保证每个子View是为配合CoordinatorLayout的布局而设计和实现的。其中FAB和Snackbar就是其中两个。</p>
<h4 id="u66FF_u6362FrameLayout_u3002"><a href="#u66FF_u6362FrameLayout_u3002" class="headerlink" title="替换FrameLayout。"></a>替换<code>FrameLayout</code>。</h4><figure class="highlight xml"><figcaption><span>res/activity/main_activity.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">android.support.design.widget.CoordinatorLayout</span></span><br><span class="line">    <span class="attribute">android:id</span>=<span class="value">"@+id/rootLayout"</span></span><br><span class="line">    <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"match_parent"</span></span><br><span class="line">    &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">android.support.design.widget.FloatingActionButton</span></span><br><span class="line">        <span class="attribute">...</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">android.support.design.widget.CoordinatorLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>同时修改Activity中rootLayout的类型为CoordinatorLayout。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//FrameLayout rootLayout;</span></span><br><span class="line">CoordinatorLayout rootLayout;</span><br><span class="line">...</span><br><span class="line"><span class="comment">//rootLayout = (FrameLayout) findViewById(R.id.rootLayout);</span></span><br><span class="line">rootLayout = (CoordinatorLayout) findViewById(R.id.rootLayout);</span><br></pre></td></tr></table></figure>
<p>效果图：</p>
<div><br>    <image src="http://inthecheesefactory.com/uploads/source/designlibrary/screenshot19n.png"><br></image></div>

<p>在android api 4.x上会有显示的bug。FAB的margin变为0dp。调整dimens的值</p>
<figure class="highlight xml"><figcaption><span>res/values/dimens.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">dimen</span> <span class="attribute">name</span>=<span class="value">"codelab_fab_margin_right"</span>&gt;</span>16dp<span class="tag">&lt;/<span class="title">dimen</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">dimen</span> <span class="attribute">name</span>=<span class="value">"codelab_fab_margin_bottom"</span>&gt;</span>16dp<span class="tag">&lt;/<span class="title">dimen</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>修改完毕</p>
<div><br>    <image src="http://inthecheesefactory.com/uploads/source/designlibrary/screenshot20n.png"><br></image></div>

<p><code>注</code> ：如果使用<code>Android Design Support</code>库的话，考虑使用<code>CoordinatorLayout</code>作为布局根view。</p>
<h3 id="u4E94_u3001Toolbar"><a href="#u4E94_u3001Toolbar" class="headerlink" title="五、Toolbar"></a>五、Toolbar</h3><p>相比传统的ActionBar，Toolbar更加灵活。</p>
<h4 id="1-_u9690_u85CFActionBar"><a href="#1-_u9690_u85CFActionBar" class="headerlink" title="1.隐藏ActionBar"></a>1.隐藏ActionBar</h4><figure class="highlight xml"><figcaption><span>res/values/styles.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">style</span> <span class="attribute">name</span>=<span class="value">"AppTheme"</span> <span class="attribute">parent</span>=<span class="value">"Theme.AppCompat.Light.DarkActionBar"</span>&gt;</span><span class="css"></span><br><span class="line">    &lt;<span class="tag">item</span> <span class="tag">name</span>="<span class="tag">windowActionBar</span>"&gt;<span class="tag">false</span>&lt;/<span class="tag">item</span>&gt;</span><br><span class="line">    &lt;<span class="tag">item</span> <span class="tag">name</span>="<span class="tag">windowNoTitle</span>"&gt;<span class="tag">true</span>&lt;/<span class="tag">item</span>&gt;</span><br><span class="line"></span><span class="tag">&lt;/<span class="title">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-_u6DFB_u52A0Toolbar"><a href="#2-_u6DFB_u52A0Toolbar" class="headerlink" title="2.添加Toolbar"></a>2.添加Toolbar</h4><p>（1）、在布局main_activity.xml添加Toolbar</p>
<figure class="highlight xml"><figcaption><span>res/layout/main_activity.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">android.support.design.widget.CoordinatorLayout</span></span><br><span class="line">    <span class="attribute">...</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">android.support.design.widget.AppBarLayout</span></span><br><span class="line">            <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">            <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">android.support.v7.widget.Toolbar</span></span><br><span class="line">                <span class="attribute">android:id</span>=<span class="value">"@+id/toolbar"</span></span><br><span class="line">                <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">                <span class="attribute">android:layout_height</span>=<span class="value">"?attr/actionBarSize"</span></span><br><span class="line">                <span class="attribute">android:background</span>=<span class="value">"?attr/colorPrimary"</span></span><br><span class="line">                <span class="attribute">app:popupTheme</span>=<span class="value">"@style/ThemeOverlay.AppCompat.Light"</span></span><br><span class="line">                <span class="attribute">app:theme</span>=<span class="value">"@style/ThemeOverlay.AppCompat.Dark.ActionBar"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="title">android.support.design.widget.AppBarLayout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">android.support.design.widget.FloatingActionButton</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">android.support.design.widget.CoordinatorLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>（2）、在Activity中调用setSupportActionBar为Activity指定toolBar。</p>
<figure class="highlight java"><figcaption><span>MainActivity</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    Toolbar toolBar;</span><br><span class="line">    DrawerLayout drawerLayout;</span><br><span class="line">    ActionBarDrawerToggle drawerToggle;</span><br><span class="line">    ...</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        toolbar = (Toolbar) findViewById(R.id.toolbar);</span><br><span class="line">        setSupportActionBar(toolbar);</span><br><span class="line">        ActionBar actionBar = getSupportActionBar();</span><br><span class="line">        <span class="keyword">if</span>(actionBar != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="comment">// 是否显示icon</span></span><br><span class="line">            actionBar.setDisplayShowHomeEnabled(<span class="keyword">true</span>);</span><br><span class="line">            actionBar.setDisplayHomeAsUpEnabled(<span class="keyword">true</span>);</span><br><span class="line">            <span class="comment">// 是否显示标题</span></span><br><span class="line">            actionBar.setDisplayShowTitleEnabled(<span class="keyword">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        drawerLayout = (DrawerLayout) findViewById(R.id.drawer_layout);</span><br><span class="line">        drawerToggle = <span class="keyword">new</span> ActionBarDrawerToggle(<span class="keyword">this</span> , drawerLayout , <span class="number">0</span> , <span class="number">0</span>);</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onPostCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onPostCreate(savedInstanceState);</span><br><span class="line">        <span class="comment">// toolbar 导航图标样式为home</span></span><br><span class="line">        drawerToggle.syncState();</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="u516D_u3001_u5185_u5BB9_u5E03_u5C40"><a href="#u516D_u3001_u5185_u5BB9_u5E03_u5C40" class="headerlink" title="六、内容布局"></a>六、内容布局</h3><p>我们介绍了FAB、Toolbar，现在为<code>main_activity.xml</code>布局主区域添加一些内容。如：添加带有两个button的LinearLayout。<br><figure class="highlight xml"><figcaption><span>res/layout/main_activity.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">android.support.design.widget.AppBarLayout</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;/<span class="title">android.support.design.widget.AppBarLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">LinearLayout</span></span><br><span class="line">    <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"match_parent"</span></span><br><span class="line">    <span class="attribute">android:orientation</span>=<span class="value">"vertical"</span></span><br><span class="line">    &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">Button</span></span><br><span class="line">        <span class="attribute">android:layout_width</span>=<span class="value">"wrap_content"</span></span><br><span class="line">        <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span></span><br><span class="line">        <span class="attribute">android:text</span>=<span class="value">"Yo Yo"</span></span><br><span class="line">        /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">Button</span></span><br><span class="line">        <span class="attribute">android:layout_width</span>=<span class="value">"wrap_content"</span></span><br><span class="line">        <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span></span><br><span class="line">        <span class="attribute">android:text</span>=<span class="value">"Yo Yo"</span></span><br><span class="line">        /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">LinearLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">android.support.design.widget.FloatingActionButton</span></span><br><span class="line">    <span class="attribute">...</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>如下图</p>
<div><br>    <image src="http://inthecheesefactory.com/uploads/source/designlibrary/screenshot29.jpg"><br></image></div>

<p>发现两个buttom并不是我们想要的样式：置于toolbar下面，而是被toolbar遮住。因为<code>LinearLayout</code>并不适配CoordinatorLayout，所以没有像toolbar那样直接自适应CoordinatorLayout的内容。解决这个问题也很简单，在<code>LinearLayout</code>中加上<code>app:layout_behavior=&quot;@string/appbar_scrolling_view_behavior&quot;</code>这个属性即可完美适配CoordinatorLayout布局了。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;LinearLayout</span><br><span class="line">    ...</span><br><span class="line">    app:layout_behavior=<span class="string">"@string/appbar_scrolling_view_behavior"</span></span><br><span class="line">    ...</span><br><span class="line">    &gt;</span><br></pre></td></tr></table></figure></p>
<div><br>    <image src="http://inthecheesefactory.com/uploads/source/designlibrary/screenshot30.jpg"><br></image></div>

<p>内容介绍结束。</p>
<h3 id="u4E03_u3001TabLayout"><a href="#u4E03_u3001TabLayout" class="headerlink" title="七、TabLayout"></a>七、TabLayout</h3><p>Material Design提供新的tab布局TabLayout，在这之前实现这个功能一般选择第三方库<code>SlidingTabLayout</code>或<code>SlidingTabStrip</code>。引入TabLayout与toolbar类似需要在xml布局文件中添加TabLayout的布局，并在Java代码中设定TabLayout的Tab属性。</p>
<h4 id="1-main_activity-xml"><a href="#1-main_activity-xml" class="headerlink" title="1.main_activity.xml"></a>1.main_activity.xml</h4><figure class="highlight xml"><figcaption><span>res/layout/main_activity.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="title">android.support.design.widget.AppBarLayout</span> <span class="attribute">...</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="title">android.support.v7.widget.Toolbar</span> <span class="attribute">...</span> /&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="title">android.support.design.widget.TabLayout</span></span><br><span class="line">        <span class="attribute">android:id</span>=<span class="value">"@+id/tabLayout"</span></span><br><span class="line">        <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">        <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span>/&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="title">android.support.design.widget.AppBarLayout</span>&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h4 id="2-_u5728Java_u4EE3_u7801_u4E2D_u6DFB_u52A0Tab"><a href="#2-_u5728Java_u4EE3_u7801_u4E2D_u6DFB_u52A0Tab" class="headerlink" title="2.在Java代码中添加Tab"></a>2.在Java代码中添加Tab</h4><figure class="highlight java"><figcaption><span>MainActivity.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">TabLayout tabLayout;</span><br><span class="line">...</span><br><span class="line">tabLayout = (TabLayout) findViewById(R.id.tabLayout);</span><br><span class="line">tabLayout.addTab(tabLayout.newTab().setText(<span class="string">"Tab 1"</span>));</span><br><span class="line">tabLayout.addTab(tabLayout.newTab().setText(<span class="string">"Tab 2"</span>));</span><br><span class="line">tabLayout.addTab(tabLayout.newTab().setText(<span class="string">"Tab 3"</span>));</span><br></pre></td></tr></table></figure>
<div><br>    <image src="http://inthecheesefactory.com/uploads/source/designlibrary/screenshot31.jpg"><br></image></div>

<h4 id="3-_u4FEE_u6539Tab_u7684_u5B57_u4F53_u989C_u8272"><a href="#3-_u4FEE_u6539Tab_u7684_u5B57_u4F53_u989C_u8272" class="headerlink" title="3.修改Tab的字体颜色"></a>3.修改Tab的字体颜色</h4><p>Tab的字体颜色是默认为黑色，用<code>app:theme=&quot;@style/ThemeOverlay.AppCompat.Dark.ActionBar&quot;</code>可以修改Tab的字体颜色为白色</p>
<figure class="highlight xml"><figcaption><span>res/layout/main_activity.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="title">android.support.design.widget.TabLayout</span></span><br><span class="line">    <span class="attribute">...</span></span><br><span class="line">    <span class="attribute">app:theme</span>=<span class="value">"@style/ThemeOverlay.AppCompat.Dark.ActionBar"</span> /&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<div><br>    <image src="http://inthecheesefactory.com/uploads/source/designlibrary/screenshot32.jpg"><br></image></div>

<h4 id="4-_u9002_u914DViewPager"><a href="#4-_u9002_u914DViewPager" class="headerlink" title="4.适配ViewPager"></a>4.适配ViewPager</h4><p>调用<code>setupWithViewPager()</code> 方法为TabLayout指定ViewPager容器。</p>
<h4 id="5-_app_3AtabMode__u4E0E_app_3AtabGravity_u5C5E_u6027"><a href="#5-_app_3AtabMode__u4E0E_app_3AtabGravity_u5C5E_u6027" class="headerlink" title="5. app:tabMode 与 app:tabGravity属性"></a>5. app:tabMode 与 app:tabGravity属性</h4><p>app:tabMode<br>设置为<code>fixed</code>时，显示所有的Tab。适应于少量的Tab。不确定Tab的数量或Tab的数量较多的情况时，使用<code>scrollable</code>属性值，可以像Google Play Store那样滚动Tab。</p>
<p>app:tabGravity 设置为<code>fill</code>时，Tab显示的方式为填充，设置为<code>center</code>时，则居中显示Tab。</p>
<blockquote>
<p>如果app:tabMode 的属性值为<code>scrollable</code>时，app:tabGravity的属性值则被忽略。</p>
</blockquote>
<div><br>    <image src="http://inthecheesefactory.com/uploads/source/designlibrary/tabmodetabgravity.jpg" style="width:100%"><br></image></div>

<h3 id="u516B_u3001_u8BA9AppBarLayout_u968F_u5185_u5BB9_u6EDA_u52A8_u9000_u51FA_u5C4F_u5E55"><a href="#u516B_u3001_u8BA9AppBarLayout_u968F_u5185_u5BB9_u6EDA_u52A8_u9000_u51FA_u5C4F_u5E55" class="headerlink" title="八、让AppBarLayout随内容滚动退出屏幕"></a>八、让AppBarLayout随内容滚动退出屏幕</h3><p>Android UX中设计非常好的一点就是可以让AppBarLayout随内容滚动退出屏幕，可以增加内容区域更多的显示空间。</p>
<h4 id="1-_u4FEE_u6539_u5E03_u5C40_u6587_u4EF6"><a href="#1-_u4FEE_u6539_u5E03_u5C40_u6587_u4EF6" class="headerlink" title="1.修改布局文件"></a>1.修改布局文件</h4><p>使用NestedScrollView替换LinearLayout。<br><figure class="highlight xml"><figcaption><span>res/layout/main_activity.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">android.support.v4.widget.NestedScrollView</span> <span class="attribute">...</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">LinearLayout</span> <span class="attribute">...</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="tag">&lt;/<span class="title">LinearLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">android.support.v4.widget.NestedScrollView</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h4 id="2-_u8BBE_u7F6EToolbar_u7684Scroll_Flags_u5C5E_u6027_u503C"><a href="#2-_u8BBE_u7F6EToolbar_u7684Scroll_Flags_u5C5E_u6027_u503C" class="headerlink" title="2.设置Toolbar的Scroll Flags属性值"></a>2.设置Toolbar的Scroll Flags属性值</h4><figure class="highlight xml"><figcaption><span>res/layout/main_activity.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="title">android.support.v7.widget.Toolbar</span></span><br><span class="line">    <span class="attribute">...</span></span><br><span class="line">    <span class="attribute">app:layout_scrollFlags</span>=<span class="value">"scroll|enterAlways"</span> /&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/01/31/Android：Material-Design笔记（一）/" data-id="cipdnp2h1000mvx2218e6epui" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Android图片加载框架：Picasso（一）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/28/Android图片加载框架：Picasso（一）/" class="article-date">
  <time datetime="2016-01-28T03:46:43.000Z" itemprop="datePublished">2016-01-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/28/Android图片加载框架：Picasso（一）/">Android图片加载框架：Picasso（一）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="http://square.github.io/picasso/" target="_blank" rel="external">Picasso</a><br><a href="http://square.github.io/picasso/2.x/picasso/" target="_blank" rel="external">Picasso JavaDoc</a><br><a href="http://stackoverflow.com/questions/tagged/picasso?sort=active" target="_blank" rel="external">Picasso stackOverflow</a></p>
<h3 id="u4E00_u3001_u4ECB_u7ECD"><a href="#u4E00_u3001_u4ECB_u7ECD" class="headerlink" title="一、介绍"></a>一、介绍</h3><p>在Android开发中的视觉显示上，图片占有很大的比重。Picasso可以只使用一行代码来解决图片加载的问题。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Picasso.with(context).load(<span class="string">"http://i.imgur.com/DvpvklR.png"</span>).into(imageView);</span><br></pre></td></tr></table></figure></p>
<p>Picasso 可以极大减少Android开发过程中的加载图片的问题：</p>
<ul>
<li>解决<code>ImageView</code>回收和<code>Adapter</code>下载取消的问题。</li>
<li>使用最小的内存来处理图片转换问题</li>
<li>自动的磁盘和内存缓存</li>
</ul>
<h3 id="u4E8C_u3001_u7279_u6027"><a href="#u4E8C_u3001_u7279_u6027" class="headerlink" title="二、特性"></a>二、特性</h3><p>1、Adapter 图片加载<br>adapter自动检测是否重用图片，是否取消之前图片的加载。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Override</span> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getView</span><span class="params">(<span class="keyword">int</span> position, View convertView, ViewGroup parent)</span> </span>&#123;</span><br><span class="line">    SquaredImageView view = (SquaredImageView) convertView;</span><br><span class="line">    <span class="keyword">if</span> (view == <span class="keyword">null</span>) &#123;</span><br><span class="line">        view = <span class="keyword">new</span> SquaredImageView(context);</span><br><span class="line">    &#125;</span><br><span class="line">    String url = getItem(position);</span><br><span class="line">    Picasso.with(context).load(url).into(view);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>2.图片转换</p>
<p>(1) 转换图片来满足Layout的合适大小以降低内存。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Picasso.with(context)</span><br><span class="line">  .load(url)</span><br><span class="line">  .resize(<span class="number">50</span>, <span class="number">50</span>)</span><br><span class="line">  .centerCrop()</span><br><span class="line">  .into(imageView)</span><br></pre></td></tr></table></figure></p>
<p>(2) 指定自定义的变换适应更多的效果<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CropSquareTransformation</span> <span class="keyword">implements</span> <span class="title">Transformation</span> </span>&#123;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Bitmap <span class="title">transform</span><span class="params">(Bitmap source)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> size = Math.min(source.getWidth(), source.getHeight());</span><br><span class="line">        <span class="keyword">int</span> x = (source.getWidth() - size) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">int</span> y = (source.getHeight() - size) / <span class="number">2</span>;</span><br><span class="line">        Bitmap result = Bitmap.createBitmap(source, x, y, size, size);</span><br><span class="line">        <span class="keyword">if</span> (result != source) &#123;</span><br><span class="line">            source.recycle();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">key</span><span class="params">()</span> </span>&#123; </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"square()"</span>; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">返回值指定的对象给`transform`方法</span><br></pre></td></tr></table></figure></p>
<p>3.Place Holders<br>Picasso支持设置默认和加载错误图片<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Picasso.with(context)</span><br><span class="line">    .load(url)</span><br><span class="line">    .placeholder(R.drawable.user_placeholder)</span><br><span class="line">    .error(R.drawable.user_placeholder_error)</span><br><span class="line">    .into(imageView);</span><br></pre></td></tr></table></figure></p>
<p>在显示加载错误的图片之前会尝试请求三次指定图片的地址。</p>
<p>4.资源加载<br>Picasso支持Resources，assets，files，content providers 等图片资源<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Picasso.with(context).load(R.drawable.landing_screen).into(imageView1);</span><br><span class="line">Picasso.with(context).load(<span class="string">"file:///android_asset/DvpvklR.png"</span>).into(imageView2);</span><br><span class="line">Picasso.with(context).load(<span class="keyword">new</span> File(...)).into(imageView3);</span><br></pre></td></tr></table></figure></p>
<p>5.Debug指示器<br>作为开发者，可以设置是否使用颜色指示器来显示加载图片的来源：网络、磁盘、内存。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Picasso instance</span></span><br><span class="line">setIndicatorsEnabled(<span class="keyword">true</span>)</span><br></pre></td></tr></table></figure></p>
<p>6.配置</p>
<ul>
<li>maven</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>com.squareup.picasso<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>picasso<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">version</span>&gt;</span>2.5.2<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>gradle</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile <span class="string">'com.squareup.picasso:picasso:2.5.2'</span></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/01/28/Android图片加载框架：Picasso（一）/" data-id="cipdnp2hh0012vx22rzhcbrg6" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Android数据库框架：Realm（一）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/28/Android数据库框架：Realm（一）/" class="article-date">
  <time datetime="2016-01-28T03:45:24.000Z" itemprop="datePublished">2016-01-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/28/Android数据库框架：Realm（一）/">Android数据库框架：Realm（一）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/01/28/Android数据库框架：Realm（一）/" data-id="cipdnp2hf0010vx22t1fq41uc" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Android网络框架：OkHttp3-一" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/28/Android网络框架：OkHttp3-一/" class="article-date">
  <time datetime="2016-01-28T03:40:10.000Z" itemprop="datePublished">2016-01-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/28/Android网络框架：OkHttp3-一/">Android网络框架：OkHttp3(一)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/01/28/Android网络框架：OkHttp3-一/" data-id="cipdnp2h6000pvx22vgp1d512" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-RxJava读书笔记（三）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/28/RxJava读书笔记（三）/" class="article-date">
  <time datetime="2016-01-28T03:13:59.000Z" itemprop="datePublished">2016-01-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/28/RxJava读书笔记（三）/">RxJava读书笔记（三）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/01/28/RxJava读书笔记（三）/" data-id="cipdnp2gj0006vx22mixglbjc" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-RxJava读书笔记（二）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/28/RxJava读书笔记（二）/" class="article-date">
  <time datetime="2016-01-28T03:07:30.000Z" itemprop="datePublished">2016-01-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/28/RxJava读书笔记（二）/">RxJava读书笔记（二）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/01/28/RxJava读书笔记（二）/" data-id="cipdnp2gh0005vx22okgqogfq" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Android：WebView开发笔记（二）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/21/Android：WebView开发笔记（二）/" class="article-date">
  <time datetime="2016-01-21T07:07:47.000Z" itemprop="datePublished">2016-01-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/21/Android：WebView开发笔记（二）/">Android：WebView开发笔记（二）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="http://www.jianshu.com/p/897d9e3bc783?utm_campaign=haruki&amp;utm_content=note&amp;utm_medium=reader_share&amp;utm_source=qq" target="_blank" rel="external">WebView小结</a></p>
<p><a href="http://developer.android.com/intl/ja/reference/android/webkit/WebView.html" target="_blank" rel="external">WebView相关API</a></p>
<h3 id="u4E00_u3001WebView_u4ECB_u7ECD"><a href="#u4E00_u3001WebView_u4ECB_u7ECD" class="headerlink" title="一、WebView介绍"></a>一、WebView介绍</h3><p>1.权限<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission android:name=<span class="string">"android.permission.INTERNET"</span> /&gt;</span><br></pre></td></tr></table></figure></p>
<p>2.基本使用</p>
<p>创建有两种方式1.在layout布局文件中使用<code>&lt;WebView/&gt;</code>标签或在代码中动态创建 WebView对象<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WebView webView = <span class="keyword">new</span> WebView(<span class="keyword">this</span>);</span><br><span class="line">setContentView(webView);</span><br></pre></td></tr></table></figure></p>
<p>在浏览器中加载<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Uri uri = Uri.parse(<span class="string">"http://www.example.com"</span>); </span><br><span class="line">Intent intent = <span class="keyword">new</span> Intent(Intent.ACTION_VIEW, uri); </span><br><span class="line">startActivity(intent);</span><br></pre></td></tr></table></figure></p>
<p>webview加载页面<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加载URL</span></span><br><span class="line">webView.loadUrl(<span class="string">"http://slashdot.org/"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//加载String形式的HTML,</span></span><br><span class="line">String summary = <span class="string">"&lt;html&gt;&lt;body&gt;You scored &lt;b&gt;192&lt;/b&gt; points.&lt;/body&gt;&lt;/html&gt;"</span>;</span><br><span class="line"><span class="comment">// 有时候会显示为乱码,可以把 string 的内容也变为 utf-8的编码，统一编码格式 </span></span><br><span class="line"><span class="comment">// summary = new String(summary.getBytes() , "UTF-8");</span></span><br><span class="line">webView.loadData(summary);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载本地文件</span></span><br><span class="line">webView.loadUrl(<span class="string">"file:///android_asset/XX.html"</span>);</span><br></pre></td></tr></table></figure></p>
<p>设置WebSetting<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WebSettings webSetting = webView.getSettings()</span><br><span class="line"><span class="comment">// 允许JS</span></span><br><span class="line">webSetting.setJavaScriptEnabled(<span class="keyword">true</span>);</span><br></pre></td></tr></table></figure></p>
<p>设置WebViewClient<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">webView.setWebViewClient(<span class="keyword">new</span> WebViewClient() &#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceivedError</span><span class="params">(WebView view, <span class="keyword">int</span> errorCode, String description, String failingUrl)</span> </span>&#123;</span><br><span class="line">     Toast.makeText(activity, <span class="string">"Oh no! "</span> + description, Toast.LENGTH_SHORT).show();</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure></p>
<p>设置WebChromeClient<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">webView.setWebChromeClient(<span class="keyword">new</span> WebChromeClient() &#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onProgressChanged</span><span class="params">(WebView view, <span class="keyword">int</span> progress)</span> </span>&#123;</span><br><span class="line">     <span class="comment">// Activities and WebViews measure progress with different scales.</span></span><br><span class="line">     <span class="comment">// The progress meter will automatically disappear when we reach 100%</span></span><br><span class="line">     activity.setProgress(progress * <span class="number">1000</span>);</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure></p>
<p>Js调用Native层代码</p>
<ul>
<li><p>html代码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">language</span>=<span class="value">"javascript"</span>&gt;</span><span class="javascript"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">wave</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"droid"</span>).src=<span class="string">"android_waving.png"</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- js调用java方法 window.js_callback.clickOnAndroid().index(this)); --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 形式：window.指定string.函数名 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">a</span> <span class="attribute">onClick</span>=<span class="value">"window.android.clickOnAndroid()"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">img</span> <span class="attribute">id</span>=<span class="value">"droid"</span> <span class="attribute">src</span>=<span class="value">"android_normal.png"</span> <span class="attribute">mce_src</span>=<span class="value">"android_normal.png"</span>/&gt;</span><span class="tag">&lt;<span class="title">br</span>&gt;</span> Click me! <span class="tag">&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>java对应的代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这里假设已经允许JS webSetting.setJavaScriptEnabled(true);</span></span><br><span class="line">webView.addJavascriptInterface(<span class="keyword">new</span> JavaScriptInterface() , <span class="string">"android"</span>)</span><br><span class="line"><span class="comment">// JS调用的Native函数对象</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JavaScriptInterface</span></span>&#123;</span><br><span class="line">    <span class="comment">/*4.2以后才有@JavascriptInterface，因为安全隐患问题。</span><br><span class="line">    * 因为 JavaScript 可以通过反射访问注入 webview 的 java 对象的 public fields，</span><br><span class="line">    * 使用宿主程序的权限执行 java 代码。所以，4.2以后，任何为 JS 暴露接口的，都要加上@JavascriptInterface。</span><br><span class="line">    * 这样，这个 Java 对象的 fields 将不允许被 js 访问。*/</span></span><br><span class="line">    <span class="annotation">@JavascriptInterface</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clickOnAndroid</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//TODO</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>Native调用Js</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">webView.loadUrl(<span class="string">"javascript:alert()"</span>);</span><br></pre></td></tr></table></figure>
<h3 id="u4E8C_u3001WebSettings"><a href="#u4E8C_u3001WebSettings" class="headerlink" title="二、WebSettings"></a>二、WebSettings</h3><p>WebView配置管理类。当WebView第一次创建时包含默认配置。通过<code>getter</code>方法来获取配置信息。调用WebView.getSetting()方法将WebSettings与WebView的生命周期绑定。如果WebView被销毁，调用任何WebView的方法都会抛出<code>IllegalStateException</code>异常信息</p>
<ul>
<li><p>setSupportZoom(boolean support) </p>
<p>  是否支持缩放，配合方法<code>setBuiltInZoomControls</code>使用，默认true</p>
</li>
<li><p>setMediaPlaybackRequiresUserGesture(boolean require) </p>
<p>  是否需要用户手势来播放Media，默认true</p>
</li>
<li><p>setBuiltInZoomControls(boolean enabled) </p>
<p>  是否使用WebView内置的缩放组件，由浮动在窗口上的缩放控制和手势缩放控制组成，默认false</p>
</li>
<li><p>setDisplayZoomControls(boolean enabled) </p>
<p>  是否显示窗口悬浮的缩放控制，默认true</p>
</li>
<li><p>setAllowFileAccess(boolean allow)</p>
<p>  是否允许访问WebView内部文件，默认true</p>
</li>
<li><p>setAllowContentAccess(boolean allow)</p>
<p>  是否允许获取WebView的内容URL ，可以让WebView访问ContentPrivider存储的内容。 默认true</p>
</li>
<li><p>setLoadWithOverviewMode(boolean overview)</p>
<p>  是否启动概述模式浏览界面，当页面宽度超过WebView显示宽度时，缩小页面适应WebView。默认false</p>
</li>
<li><p>setSaveFormData(boolean save)</p>
<p>  是否保存表单数据，默认false</p>
</li>
<li><p>setTextZoom(int textZoom)</p>
<p>  设置页面文字缩放百分比，默认100%</p>
</li>
<li><p>setUseWideViewPort(boolean use)</p>
<p>  是否支持ViewPort的meta tag属性，如果页面有ViewPort meta tag 指定的宽度，则使用meta tag指定的值，否则默认使用宽屏的视图窗口</p>
</li>
<li><p>setSupportMultipleWindows(boolean support)</p>
<p>  是否支持多窗口，如果设置为true ，<code>WebChromeClient#onCreateWindow</code>方法必须被主程序实现，默认false</p>
</li>
<li><p>setLayoutAlgorithm(LayoutAlgorithm l)</p>
<p>  指定WebView的页面布局显示形式，调用该方法会引起页面重绘。默认LayoutAlgorithm#NARROW_COLUMNS</p>
</li>
<li><p>setStandardFontFamily(String font)</p>
<p>  设置标准的字体族，默认”sans-serif”。font-family 规定元素的字体系列。font-family 可以把多个字体名称作为一个“回退”系统来保存。如果浏览器不支持第一个字体，则会尝试下一个。也就是说，font-family 属性的值是用于某个元素的字体族名称或/及类族名称的一个优先表。浏览器会使用它可识别的第一个值。</p>
</li>
<li><p>setFixedFontFamily(String font)</p>
<p>  设置混合字体族。默认”monospace”</p>
</li>
<li><p>setSansSerifFontFamily(String font)</p>
<p>  设置SansSerif字体族。默认”sans-serif”</p>
</li>
<li><p>setSerifFontFamily(String font)</p>
<p>  设置SerifFont字体族，默认”sans-serif”</p>
</li>
<li><p>setCursiveFontFamily(String font)</p>
<p>  设置CursiveFont字体族，默认”cursive”</p>
</li>
<li><p>setFantasyFontFamily(String font)</p>
<p>  设置FantasyFont字体族，默认”fantasy”</p>
</li>
<li><p>setMinimumFontSize(int size)</p>
<p>  设置最小字体，默认8. 取值区间[1-72]，超过范围，使用其上限值。</p>
</li>
<li><p>setMinimumLogicalFontSize(int size)</p>
<p>  设置最小逻辑字体，默认8. 取值区间[1-72]，超过范围，使用其上限值。</p>
</li>
<li><p>setDefaultFontSize(int size)</p>
<p>  设置默认字体大小，默认16，取值区间[1-72]，超过范围，使用其上限值。</p>
</li>
<li><p>setDefaultFixedFontSize(int size)</p>
<p>  设置默认填充字体大小，默认16，取值区间[1-72]，超过范围，使用其上限值。</p>
</li>
<li><p>setLoadsImagesAutomatically(boolean flag)</p>
<p>  设置是否加载图片资源，<code>注意：</code>方法控制所有的资源图片显示，包括嵌入的本地图片资源。使用方法<code>setBlockNetworkImage</code>则只限制网络资源图片的显示。值设置为true后，webview会自动加载网络图片。默认true</p>
</li>
<li><p>setBlockNetworkImage(boolean flag)</p>
<p>  是否加载网络图片资源。<code>注意</code>如果<code>getLoadsImagesAutomatically</code>返回false，则该方法没有效果。如果使用<code>setBlockNetworkLoads</code>设置为false，该方法设置为false，也不会显示网络图片。当值从true改为false时。WebView会自动加载网络图片。</p>
</li>
<li><p>setBlockNetworkLoads(boolean flag)</p>
<p>  设置是否加载网络资源。<code>注意</code>如果值从true切换为false后，WebView不会自动加载，除非调用WebView#reload().如果没有<code>android.Manifest.permission#INTERNET</code>权限，值设为false，则会抛出<code>java.lang.SecurityException</code>异常。默认值：有<code>android.Manifest.permission#INTERNET</code>权限时为false，其他为true。</p>
</li>
<li><p>setJavaScriptEnabled(boolean flag)</p>
<p>  设置是否允许执行JS。</p>
</li>
<li><p>setAllowUniversalAccessFromFileURLs(boolean flag)</p>
<p>  是否允许Js访问任何来源的内容。包括访问file scheme的URLs。考虑到安全性，限制Js访问范围默认禁用。<code>注意：</code>该方法只影响file scheme类型的资源，其他类型资源如图片类型的，不会受到影响。<code>ICE_CREAM_SANDWICH_MR1</code>版本以及以下默认为true，<code>JELLY_BEAN</code>版本以上默认为false</p>
</li>
<li><p>setAllowFileAccessFromFileURLs(boolean flag)</p>
<p>  是否允许Js访问其他file scheme的URLs。包括访问file scheme的资源。考虑到安全性，限制Js访问范围默认禁用。<code>注意：</code>该方法只影响file scheme类型的资源，其他类型资源如图片类型的，不会受到影响。如果<code>getAllowUniversalAccessFromFileURLs</code>为true，则该方法被忽略。<code>ICE_CREAM_SANDWICH_MR1</code>版本以及以下默认为true，<code>JELLY_BEAN</code>版本以上默认为false</p>
</li>
<li><p>setGeolocationDatabasePath(String databasePath)</p>
<p>  设置存储定位数据库的位置，考虑到位置权限和持久化Cache缓存，Application需要拥有指定路径的write权限</p>
</li>
<li><p>setAppCacheEnabled(boolean flag)</p>
<p>  是否允许Cache，默认false。考虑需要存储缓存，应该为缓存指定存储路径<code>setAppCachePath</code></p>
</li>
<li><p>setAppCachePath(String appCachePath)</p>
<p>  设置Cache API缓存路径。为了保证可以访问Cache，Application需要拥有指定路径的write权限。该方法应该只调用一次，多次调用自动忽略。</p>
</li>
<li><p>setDatabaseEnabled(boolean flag)</p>
<p>  是否允许数据库存储。默认false。查看<code>setDatabasePath</code> API 如何正确设置数据库存储。该设置拥有全局特性，同一进程所有WebView实例共用同一配置。<code>注意：</code>保证在同一进程的任一WebView加载页面之前修改该属性，因为在这之后设置WebView可能会忽略该配置</p>
</li>
<li><p>setDomStorageEnabled(boolean flag)</p>
<p>  是否存储页面DOM结构，默认false。</p>
</li>
<li><p>setGeolocationEnabled(boolean flag)</p>
<p>  是否允许定位，默认true。<code>注意：</code>为了保证定位可以使用，要保证以下几点：</p>
<ul>
<li>Application 需要有<code>android.Manifest.permission#ACCESS_COARSE_LOCATION</code>的权限</li>
<li>Application 需要实现<code>WebChromeClient#onGeolocationPermissionsShowPrompt</code>的回调，接收Js定位请求访问地理位置的通知</li>
</ul>
</li>
<li><p>setJavaScriptCanOpenWindowsAutomatically(boolean flag)</p>
<p>  是否允许JS自动打开窗口。默认false</p>
</li>
<li><p>setDefaultTextEncodingName(String encoding)</p>
<p>  设置页面的编码格式，默认UTF-8</p>
</li>
<li><p>setUserAgentString(String ua)</p>
<p>  设置WebView代理，默认使用默认值</p>
</li>
<li><p>setNeedInitialFocus(boolean flag)</p>
<p>  通知WebView是否需要设置一个节点获取焦点当<code>WebView#requestFocus(int, android.graphics.Rect)</code>被调用的时候，默认true</p>
</li>
<li><p>setCacheMode(int mode)</p>
<p>  基于WebView导航的类型使用缓存：正常页面加载会加载缓存并按需判断内容是否需要重新验证。如果是页面返回，页面内容不会重新加载，直接从缓存中恢复。<code>setCacheMode</code>允许客户端根据指定的模式来使用缓存。</p>
<ul>
<li>LOAD_DEFAULT 默认加载方式</li>
<li>LOAD_CACHE_ELSE_NETWORK 按网络情况使用缓存</li>
<li>LOAD_NO_CACHE 不使用缓存</li>
<li>LOAD_CACHE_ONLY 只使用缓存</li>
</ul>
</li>
<li><p>setMixedContentMode(int mode)</p>
<p>  设置加载不安全资源的WebView加载行为。<code>KITKAT</code>版本以及以下默认为<code>MIXED_CONTENT_ALWAYS_ALLOW</code>方式，<code>LOLLIPOP</code>默认<code>MIXED_CONTENT_NEVER_ALLOW</code>。强烈建议：使用<code>MIXED_CONTENT_NEVER_ALLOW</code></p>
</li>
</ul>
<h3 id="u4E09_u3001WebViewClient"><a href="#u4E09_u3001WebViewClient" class="headerlink" title="三、WebViewClient"></a>三、WebViewClient</h3><ul>
<li><p>shouldOverrideUrlLoading(WebView view, String url)</p>
<p>  当加载新的URL时是否由主程序控制显示。如果没有提供<code>WebViewClient</code>，则选择合适的url处理方式。如果指定<code>WebViewClient</code>，返回值为true意味主程序处理url，返回值为false意味当前<code>WebView</code>处理url。<code>注意：</code>如果使用<code>POST</code>方法该方法不会被调用。</p>
</li>
<li><p>onPageStarted(WebView view, String url, Bitmap favicon)。</p>
<p>  通知主程序页面开始加载。该方法只有在加载main frame时加载一次，如果一个页面有多个frame，<code>onPageStarted</code>只在加载main frame时调用一次。也意味着若内置frame发生变化，<code>onPageStarted</code>不会被调用，如：在iframe中打开url链接。</p>
</li>
<li><p>onPageFinished(WebView view, String url)</p>
<p>  通知主程序页面加载结束。方法只被main frame调用一次。</p>
</li>
<li><p>onLoadResource(WebView view, String url)</p>
<p>  通知主程序开始加载指定url的资源文件。</p>
</li>
<li><p>shouldInterceptRequest(WebView view,WebResourceRequest request)</p>
<p>  通知主程序资源请求，是否允许程序返回指定数据资源。如果返回值为<code>null</code>，表示继续正常加载资源文件，否则使用返回响应和值。<code>注意：</code>该方法在线程被调用而不是UI线程，所有客户端在调用私有数据或在与View交互的时候应该注意。</p>
</li>
<li><p>onReceivedError(WebView view, int errorCode, String description, String failingUrl)</p>
<p>  返回访问错误通知。</p>
</li>
<li><p>onFormResubmission(WebView view, Message dontResend, Message resend)</p>
<p>  是否重发POST请求数据，默认不重发。</p>
</li>
<li><p>doUpdateVisitedHistory(WebView view, String url, boolean isReload)</p>
<p>  更新访问历史</p>
</li>
<li><p>onReceivedSslError(WebView view, SslErrorHandler handler, SslError error)</p>
<p>  通知主程序加载资源的SSL错误。必须调用<code>handler.cancel()</code>或<code>handler.proceed()</code>。该设置可能会为之后资源访问的SSL错误保留使用当前的设定。默认<code>cancel</code></p>
</li>
<li><p>onReceivedClientCertRequest(WebView view, ClientCertRequest request)</p>
<p>  通知主程序处理SSL客户端认证请求。如果需要提供密钥，主程序负责显示UI界面。有三个响应方法：<code>proceed()</code>, <code>cancel()</code> 和 <code>ignore()</code>。如果调用<code>proceed()</code>和<code>cancel()</code>，webview将会记住response，对相同的host和port地址不再调用onReceivedClientCertRequest方法。如果调用<code>ignore()</code>方法，webview则不会记住response。该方法在UI线程中执行，在回调期间，连接被挂起。默认<code>cancel()</code>，即无客户端认证</p>
</li>
<li><p>onReceivedHttpAuthRequest(WebView view, HttpAuthHandler handler, String host, String realm)</p>
<p>  通知主程序：WebView接收HTTP认证请求，主程序可以使用<code>HttpAuthHandler</code>为请求设置WebView响应。默认取消请求。</p>
</li>
<li><p>shouldOverrideKeyEvent(WebView view, KeyEvent event)</p>
<p>  是否让主程序同步处理Key Event事件，如过滤菜单快捷键的Key Event事件。如果返回true，WebView不会处理Key Event，如果返回false，Key Event总是由WebView处理。默认：false</p>
</li>
<li><p>onUnhandledInputEvent(WebView view, InputEvent event)</p>
<p>  通知主程序输入事件不是由WebView调用。是否让主程序处理WebView未处理的Input Event。除了系统按键，WebView总是消耗掉输入事件或<code>shouldOverrideKeyEvent</code>返回true。该方法由event 分发异步调用。<code>注意：</code>如果事件为<code>MotionEvent</code>，则事件的生命周期只存在方法调用过程中，如果WebViewClient想要使用这个Event，则需要复制Event对象。</p>
</li>
<li><p>onScaleChanged(WebView view, float oldScale, float newScale)</p>
<p>  通知主程序WebView的大小发生变化。</p>
</li>
<li><p>onReceivedLoginRequest(WebView view, String realm, String account, String args)</p>
<p>  通知主程序执行了自动登录请求。</p>
</li>
</ul>
<h3 id="u56DB_u3001WebChromeClient"><a href="#u56DB_u3001WebChromeClient" class="headerlink" title="四、WebChromeClient"></a>四、WebChromeClient</h3><ul>
<li><p>onProgressChanged(WebView view, int newProgress)</p>
<p>  通知程序当前页面加载进度</p>
</li>
<li><p>onReceivedTitle(WebView view, String title) </p>
<p>  通知页面标题变化</p>
</li>
<li><p>onReceivedIcon(WebView view, Bitmap icon)</p>
<p>  通知当前页面网站新图标</p>
</li>
<li><p>onReceivedTouchIconUrl(WebView view, String url, boolean precomposed)</p>
<p> 通知主程序图标按钮URL</p>
</li>
<li><p>CustomViewCallback</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CustomViewCallback</span> </span>&#123;</span><br><span class="line">       <span class="comment">// 通知当前页面自定义的View被关闭</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCustomViewHidden</span><span class="params">()</span></span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>onShowCustomView(View view, CustomViewCallback callback)</p>
<p>  通知主程序当前页面将要显示指定方向的View，该方法用来全屏播放视频。</p>
</li>
<li><p>onHideCustomView()</p>
<p>  与<code>onShowCustomView</code>对应，通知主程序当前页面将要关闭Custom View</p>
</li>
<li><p>onCreateWindow(WebView view, boolean isDialog, boolean isUserGesture, Message resultMsg)</p>
<p>  请求主程序创建一个新的Window，如果主程序接收请求，返回true并创建一个新的WebView来装载Window，然后添加到View中，发送带有创建的WebView作为参数的resultMsg的给Target。如果主程序拒绝接收请求，则方法返回false。默认不做任何处理，返回false</p>
</li>
<li><p>onRequestFocus(WebView view)</p>
<p>  显示当前WebView，为当前WebView获取焦点。</p>
</li>
<li><p>onCloseWindow(WebView window)</p>
<p>  通知主程序关闭WebView，并从View中移除，<code>WebCore</code>停止任何的进行中的加载和JS功能。</p>
</li>
<li><p>onJsAlert(WebView view, String url, String message, JsResult result)</p>
<p>  告诉客户端显示Js 提示框。如果客户端返回true，由客户端处理提示框。否则继续显示Js 提示框。</p>
</li>
<li><p>onJsConfirm(WebView view, String url, String message, JsResult result)</p>
<p>  告诉客户端显示确认提示框。如果返回true，由客户端处理确认提示框，调用合适的JsResult方法。如果返回false，则返回默认值false给javascript。默认：false</p>
</li>
<li><p>onJsPrompt(WebView view, String url, String message, String defaultValue, JsPromptResult result)</p>
<p>  告诉客户端显示提示框。如果返回true，由客户端处理确认提示框，调用合适的JsPromptResult方法。如果返回false，则返回默认值false给javascript。默认：false</p>
</li>
<li><p>onJsBeforeUnload(WebView view, String url, String message, JsResult result)</p>
<p>  告诉客户端显示离开当前页面的导航提示框。如果返回true，由客户端处理确认提示框，调用合适的JsResult方法。如果返回false，则返回默认值true给javascript接受离开当前页面的导航。默认：false。JsResult设置false，当前页面取消导航提示，否则离开当前页面。</p>
</li>
<li><p>onGeolocationPermissionsShowPrompt(String origin, GeolocationPermissions.Callback callback)</p>
<p>  通知主程序web内容尝试使用定位API，但是没有相关的权限。主程序需要调用调用指定的定位权限申请的回调。更多说明查看<code>GeolocationPermissions</code>相关API。</p>
</li>
<li><p>onGeolocationPermissionsHidePrompt()</p>
<p>  通知程序有定位权限请求。如果<code>onGeolocationPermissionsShowPrompt</code>权限申请操作被取消，则隐藏相关的UI界面。</p>
</li>
<li><p>onPermissionRequest(PermissionRequest request)</p>
<p>  通知主程序web内容尝试申请指定资源的权限（权限没有授权或已拒绝），主程序必须调用<code>PermissionRequest#grant(String[])</code>或<code>PermissionRequest#deny()</code>。如果没有覆写该方法，默认拒绝。</p>
</li>
<li><p>onPermissionRequestCanceled(PermissionRequest request)</p>
<p>  通知主程序相关权限被取消。任何相关UI都应该隐藏掉。</p>
</li>
<li><p>onJsTimeout() </p>
<p>  通知主程序 执行的Js操作超时。客户端决定是否中断<code>JavaScript</code>继续执行。如果客户端返回true，JavaScript中断执行。如果客户端返回false，则执行继续。<code>注意：</code>如果继续执行，重置JavaScript超时计时器。如果Js下一次检查点仍没有结束，则再次提示。</p>
</li>
<li><p>onConsoleMessage(ConsoleMessage consoleMessage)</p>
<p>  通知主程序的Js控制台消息，<code>ChromeClient</code>应该覆写该方法在合适的时候来打印日志。</p>
</li>
<li><p>getDefaultVideoPoster()</p>
<p>  当停止播放，Video显示为一张图片。默认图片可以通过HTML的Video的poster属性标签来指定。如果poster属性不存在，则使用默认的poster。该方法允许<code>ChromeClient</code>提供默认图片。</p>
</li>
<li><p>getVideoLoadingProgressView()</p>
<p>  当用户重放视频，在渲染第一帧前需要花费时间去缓冲足够的数据。在缓冲期间，<code>ChromeClient</code>可以提供一个显示的View。如：可以显示一个加载动画。</p>
</li>
<li><p>getVisitedHistory(ValueCallback<string[]> callback)</string[]></p>
<p>  获取访问历史Item，用于链接颜色。</p>
</li>
<li><p>onShowFileChooser(WebView webView, ValueCallback<uri[]> filePathCallback,</uri[]></p>
<pre><code>FileChooserParams fileChooserParams)
</code></pre><p>  通知客户端显示文件选择器。用来处理file类型的HTML标签，响应用户点击选择文件的按钮操作。调用<code>filePathCallback.onReceiveValue(null)</code>并返回true取消请求操作。</p>
</li>
<li><p>FileChooserParams </p>
<p>  <code>onShowFileChooser</code>方法使用的参数</p>
<ul>
<li>MODE_OPEN 打开</li>
<li>MODE_OPEN_MULTIPLE 选中多个文件打开</li>
<li>MODE_OPEN_FOLDER 打开文件夹（暂不支持）</li>
<li>MODE_SAVE 保存</li>
<li><p>parseResult(int resultCode, Intent data)</p>
<p>  解析文件选择Activity返回的结果。需要和<code>createIntent</code>一起使用。</p>
</li>
<li><p>createIntent()</p>
<p>  创建Intent对象来启动文件选择器。Intent支持可访问的简单类型文件资源。不支持高级文件资源如<code>live media capture</code>媒体快照。如果需要访问这些资源或其他高级文件类型资源可以自己创建Intent对象。</p>
</li>
<li><p>getMode()</p>
<p>  返回文件选择模式</p>
</li>
<li><p>getAcceptTypes() </p>
<p>  返回可访问<code>MIME</code>类型数组，如<code>audio/*</code>，如果没有指定可访问类型，数组返回为null</p>
</li>
<li><p>isCaptureEnabled()</p>
<p>  返回优先的媒体快照类型值如<code>Camera</code>、<code>Microphone</code>。true：允许快照。false，禁止快照。使用<code>getAcceptTypes</code>方法确定合适的<code>capture</code>设备。</p>
</li>
<li><p>getTitle()</p>
<p>  返回文件选择器的标题。如果为null，使用默认名称。</p>
</li>
<li><p>getFilenameHint()</p>
<p>  指定默认选中的文件名或为null</p>
</li>
</ul>
</li>
<li><p>setupAutoFill(Message msg) <code>暂不支持</code></p>
<p>  告诉客户端当前页面以自动填充表单形式查看。</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/01/21/Android：WebView开发笔记（二）/" data-id="cipdnp2gu000ivx22xdzbwbtx" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Android-WebView开发笔记（一）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/19/Android-WebView开发笔记（一）/" class="article-date">
  <time datetime="2016-01-19T08:58:34.000Z" itemprop="datePublished">2016-01-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/19/Android-WebView开发笔记（一）/">Android:WebView开发笔记（一）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="http://kymjs.com/code/2015/05/03/01/" target="_blank" rel="external">讲解WebView</a></p>
<p><a href="http://droidyue.com/blog/2014/07/09/override-javascript-alert-in-android/?hmsr=toutiao.io&amp;utm_medium=toutiao.io&amp;utm_source=toutiao.io" target="_blank" rel="external">技术小黑屋：WebView重写onJsAlert那些事</a></p>
<p><a href="http://droidyue.com/blog/2014/11/23/block-web-resource-in-webview/?hmsr=toutiao.io&amp;utm_medium=toutiao.io&amp;utm_source=toutiao.io" target="_blank" rel="external">技术小黑屋：Android中WebView拦截替换网络请求数据</a></p>
<h3 id="u4E00_u3001Android_WebView"><a href="#u4E00_u3001Android_WebView" class="headerlink" title="一、Android WebView"></a>一、Android WebView</h3><p>1.添加网络访问权限</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission android:name=<span class="string">"android.permission.INTERNET"</span> /&gt;</span><br></pre></td></tr></table></figure>
<p>2.添加JavaScript支持<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WebView.getSettings().setJavaScriptEnabled(<span class="keyword">true</span>);</span><br></pre></td></tr></table></figure></p>
<p>3.只在当前WebView进行跳转，则必须覆盖<code>WebViewClient</code>对象<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mWebView.setWebViewClient(<span class="keyword">new</span> WebViewClient()&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldOverrideUrlLoading</span><span class="params">(WebView view, String url)</span></span>&#123; </span><br><span class="line">		view.loadUrl(url);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>4.支持点击返回键回到上一页，而不是关闭当前Actvitiy或Fragment，则复写<code>onBackPress</code>方法。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onKeyDown</span><span class="params">(<span class="keyword">int</span> keyCode, KeyEvent event)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> ((keyCode == KEYCODE_BACK) &amp;&amp; mWebView.canGoBack()) &#123; </span><br><span class="line">		mWebView.goBack();</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">super</span>.onKeyDown(keyCode, event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>5.调用页面Js方法<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebViewDemo</span> <span class="keyword">extends</span> <span class="title">Activity</span></span>&#123;</span><br><span class="line">	mWebView.addJavascriptInterface(<span class="keyword">new</span> Object() &#123;</span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clickOnAndroid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			mHandler.post(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">				<span class="comment">// 在子线程中执行</span></span><br><span class="line">				<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; </span><br><span class="line">					<span class="comment">// java 调用Js 方法</span></span><br><span class="line">					mWebView.loadUrl(<span class="string">"javascript:wave()"</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;, <span class="string">"demo"</span>); </span><br><span class="line">	</span><br><span class="line">	mWebView.loadUrl(<span class="string">"file:///android_asset/demo.html"</span>); 	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>主要方法<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">addJavascriptInterface(Object obj,String interfaceName)</span><br></pre></td></tr></table></figure></p>
<p><code>addJavascriptInterface</code>将Java对象绑定到JavaScript对象中,<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">language</span>=<span class="value">"javascript"</span>&gt;</span><span class="javascript"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">wave</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"droid"</span>).src=<span class="string">"android_waving.png"</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line">	// js调用java方法</span><br><span class="line">  <span class="tag">&lt;<span class="title">a</span> <span class="attribute">onClick</span>=<span class="value">"window.demo.clickOnAndroid()"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">img</span> <span class="attribute">id</span>=<span class="value">"droid"</span> <span class="attribute">src</span>=<span class="value">"android_normal.png"</span> <span class="attribute">mce_src</span>=<span class="value">"android_normal.png"</span>/&gt;</span><span class="tag">&lt;<span class="title">br</span>&gt;</span> Click me! <span class="tag">&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<h3 id="u4E8C_u3001Js_u8C03_u7528Android_u4EE3_u7801"><a href="#u4E8C_u3001Js_u8C03_u7528Android_u4EE3_u7801" class="headerlink" title="二、Js调用Android代码"></a>二、Js调用Android代码</h3><ol>
<li><ul>
<li>WebView主要用来解析和渲染界面。</li>
<li>WebViewClient 处理通知、请求事件等。</li>
<li>WebChromeClient辅助WebView处理Js的对话框、网站图标、标题等。</li>
</ul>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">webView.addJavascriptInterface(<span class="keyword">new</span> JavaScriperface(<span class="keyword">this</span>) , <span class="string">"android"</span>);</span><br><span class="line"><span class="comment">// 加载 htmlText 是以字符串的方式读取assets下的html内容</span></span><br><span class="line">webView.loadData(htmlText , <span class="string">"text/html"</span> , <span class="string">"utf-8"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回上一页</span></span><br><span class="line">webview.goBack();</span><br></pre></td></tr></table></figure>
<h3 id="u4E09_u3001WebView_u7F13_u5B58"><a href="#u4E09_u3001WebView_u7F13_u5B58" class="headerlink" title="三、WebView缓存"></a>三、WebView缓存</h3><p>1.加载网页时，webview会在<code>/data/data/包名</code>目录下生成database与cache两个文件夹。请求url的记录保存在<code>WebViewCache.db</code>，内容保存在WebViewCache文件夹下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 启用缓存</span></span><br><span class="line"><span class="comment">// 优先使用缓存</span></span><br><span class="line">webView.getSetting.setCacheMode(WebSettings. LOAD_CACHE_ELSE_NETWORK);</span><br><span class="line"><span class="comment">// 不使用缓存</span></span><br><span class="line">webView.getSetting.setCacheMode(WebSettings.LOAD_NO_CACHE);</span><br></pre></td></tr></table></figure>
<p>2.删除缓存<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">clearCacheFolder</span><span class="params">(File dir , <span class="keyword">long</span> numDays)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> deletedFiles = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span>(dir != <span class="keyword">null</span> &amp;&amp; dir.isDirectory)&#123;</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			<span class="keyword">for</span>(File child:dir.listFiles())&#123;</span><br><span class="line">				<span class="keyword">if</span>(child.isDirectory())&#123;</span><br><span class="line">					deletedFiles += clearCacheFolder(child , numDays);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span>(child.lastModified() &lt; numDays)&#123;</span><br><span class="line">					<span class="keyword">if</span>(child.delete)&#123;</span><br><span class="line">						deleteFiles++;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">			e.printStackTrace();	</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> deletedFiles;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="u56DB_u3001_u5904_u7406404"><a href="#u56DB_u3001_u5904_u7406404" class="headerlink" title="四、处理404"></a>四、处理404</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">webView.setWebViewClient(<span class="keyword">new</span> WebViewClient() &#123;</span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceivedError</span><span class="params">(WebView view, <span class="keyword">int</span> errorCode, String description, String failingUrl)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// stop load and handle errorcode</span></span><br><span class="line">		<span class="keyword">if</span>(errorCode == <span class="number">404</span>)&#123;</span><br><span class="line">			<span class="comment">// load 404 </span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="u4E94_u3001_u5224_u65AD_u662F_u5426_u6ED1_u52A8_u5230_u5E95_u90E8"><a href="#u4E94_u3001_u5224_u65AD_u662F_u5426_u6ED1_u52A8_u5230_u5E95_u90E8" class="headerlink" title="五、判断是否滑动到底部"></a>五、判断是否滑动到底部</h3><ul>
<li>getScrollY() 当前可见区域的距离整个页面顶端的距离，即当前内容滚动的距离</li>
<li>getHeight() 当前WebView的高度</li>
<li>getBottom() 当前WebView</li>
<li>getContentHeight() 返回整个html页面的高度，不是当前页面的高度，因为webview的缩放</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 是否可以缩放</span></span><br><span class="line">webView.getSettings().setSupportZoom(<span class="keyword">true</span>);</span><br><span class="line"><span class="comment">// 是否显示缩放控制</span></span><br><span class="line">webView.getSettings().setBuildInZoomControls(<span class="keyword">true</span>);</span><br><span class="line"><span class="comment">// 默认缩放大小</span></span><br><span class="line">webView.getSettings(). setDefaultZoom(ZoomDensity.CLOSE);</span><br></pre></td></tr></table></figure>
<p>当前整个页面的高度<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> currentHeight = webView.getContentHeight * getScale();</span><br><span class="line"><span class="keyword">boolean</span> isBottom = currentHeight - webView.getHeight() - webView.getScroll() &lt;= <span class="number">0</span></span><br></pre></td></tr></table></figure></p>
<h3 id="u516D_u3001_u670D_u52A1_u5668Session"><a href="#u516D_u3001_u670D_u52A1_u5668Session" class="headerlink" title="六、服务器Session"></a>六、服务器Session</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CookieManager manager = CookieManager.getInstance();</span><br><span class="line"><span class="comment">// 删除cookie</span></span><br><span class="line">manager.removeAllCookie();</span><br><span class="line"><span class="comment">// 获取cookie</span></span><br><span class="line">manager.getCookie(url);</span><br><span class="line"><span class="comment">// 设置cookie，覆盖之前的path，host，name的cookie</span></span><br><span class="line">manager.setCookie(url , cookie);</span><br></pre></td></tr></table></figure>
<p>1.设置和清除SessionCookies</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">*  同步本地cookie到Webview中</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">synCookies</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!CacheUtils.isLogin(<span class="keyword">this</span>)) <span class="keyword">return</span>;</span><br><span class="line">	CookiesSyncManager.createInstance(<span class="keyword">this</span>);</span><br><span class="line">	CookieManager manager = CookieManager.getInstance();</span><br><span class="line">	<span class="comment">// 是否发送和接收cookies，默认为true</span></span><br><span class="line">	manager.setAcceptCookie(<span class="keyword">true</span>);</span><br><span class="line">	<span class="comment">// 移除session cookie</span></span><br><span class="line">	manager.removeSessionCookies(<span class="keyword">new</span> ValueCallback&lt;Boolean&gt;()&#123;</span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceiveValue</span><span class="params">(Boolean value)</span></span>&#123;</span><br><span class="line">				<span class="comment">//TODO</span></span><br><span class="line">			&#125;</span><br><span class="line">	&#125;);</span><br><span class="line">	String cookies = PreferenceHelper.readString(<span class="keyword">this</span> , key , key);</span><br><span class="line">	manager.setCookie(url , cookies);</span><br><span class="line">	CookieSyncManager.getInstance().sync();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2.WebView本身也记录html缓存</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 清除缓存</span></span><br><span class="line">webview.clearCache(<span class="keyword">true</span>);</span><br><span class="line">webview.clearHistory();</span><br></pre></td></tr></table></figure>
<h3 id="u4E03_u3001Android_u4E2DWebView_u66FF_u6362_u7F51_u7EDC_u8D44_u6E90"><a href="#u4E03_u3001Android_u4E2DWebView_u66FF_u6362_u7F51_u7EDC_u8D44_u6E90" class="headerlink" title="七、Android中WebView替换网络资源"></a>七、Android中WebView替换网络资源</h3><p><code>shouldInterceptRequest</code><br>通知主程序WebView处理资源文件，允许主程序返回处理后的数据。如果返回数据为null，WebView会自行加载网络资源，否则使用主程序提供的数据。回调是在子线程中处理，不能直接进行UI操作。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Deprecated</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> WebResourceResponse <span class="title">shouldInterceptRequest</span><span class="params">(WebView view,</span><br><span class="line">        String url)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">	</span><br><span class="line"><span class="function"><span class="keyword">public</span> WebResourceResponse <span class="title">shouldInterceptRequest</span><span class="params">(WebView view,</span><br><span class="line">        WebResourceRequest request)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> shouldInterceptRequest(view, request.getUrl().toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Example<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">WebView webView = <span class="keyword">new</span> WebView(<span class="keyword">this</span>);</span><br><span class="line">webView.setWebViewClient(<span class="keyword">new</span> WebViewClient()&#123;</span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> WebResourceResponse <span class="title">shouldInterceptRequest</span><span class="params">(WebView view,</span><br><span class="line">            String url)</span> </span>&#123;</span><br><span class="line">		WebResourceResponse response = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">if</span>(url.contains(<span class="string">"logo"</span>))&#123;</span><br><span class="line">			InputStream localCopy = <span class="keyword">null</span>;</span><br><span class="line">			<span class="keyword">try</span>&#123;</span><br><span class="line">				localCopy = getAssets().open(<span class="string">"xx.png"</span>);</span><br><span class="line">				<span class="comment">// MIME类型，数据编码，数据(InputStream流形式)</span></span><br><span class="line">				response = <span class="keyword">new</span> WebResourceResponse(<span class="string">"image/png"</span> , <span class="string">"UTF-8"</span> , localCopy);</span><br><span class="line">			&#125; <span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125; <span class="keyword">finally</span>&#123;</span><br><span class="line">				<span class="keyword">try</span>&#123;</span><br><span class="line">					<span class="keyword">if</span>(localCopy != <span class="keyword">null</span>)&#123;</span><br><span class="line">						localCopy.close();</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/01/19/Android-WebView开发笔记（一）/" data-id="cipdnp2hl0014vx22j491vnmw" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Android源码学习（一）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/12/Android源码学习（一）/" class="article-date">
  <time datetime="2016-01-12T08:41:51.000Z" itemprop="datePublished">2016-01-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android源码学习系列/">Android源码学习系列</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/12/Android源码学习（一）/">Android源码学习（一）：Mac OSX开发环境搭建</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="https://source.android.com/source/initializing.html#setting-up-a-mac-os-x-build-environment" target="_blank" rel="external">官网教程</a></p>
<p><a href="http://iluhcm.com/2015/08/18/compile-newest-android-source-code-on-macosx/" target="_blank" rel="external">Mac OS X 10.10.3下android-5.1.1_r9 源码下载与编译</a></p>
<p><a href="https://medium.com/@raminmahmoodi/build-android-5-0-lollipop-on-osx-10-10-yosemite-441bd00ee77a#.vxeycv4xr" target="_blank" rel="external">Build Android 5.0 Lollipop on OSX 10.10 Yosemite</a></p>
<p><a href="http://www.liball.me/mac-10-10-build-android-4-4-4-for-nexus/" target="_blank" rel="external">Mac 10.10 编译android 4.4.4 for nexus</a></p>
<p><a href="http://llzz.me/2015/06/17/Build-Android-5-0-Source/" target="_blank" rel="external">Build Android 5.0 Source</a></p>
<h4 id="u4E00_u3001Mac_OSX__u5F00_u53D1_u73AF_u5883_u642D_u5EFA"><a href="#u4E00_u3001Mac_OSX__u5F00_u53D1_u73AF_u5883_u642D_u5EFA" class="headerlink" title="一、Mac OSX 开发环境搭建"></a>一、Mac OSX 开发环境搭建</h4><p>本文的Mac OSX的版本为 <code>OSX 10.11</code></p>
<p>默认情况下，MacOs系统是大小写保留，但大小写不敏感的文件系统。这种文件系统不被git支持，会引起git一些命令行行为不正常，如 <code>git status</code>。因此建议将ASOP源码文件放在一个大小写敏感的工作环境中。可以使用磁盘镜像来建立一个这样的文件系统。</p>
<h4 id="1_u3001_u521B_u5EFA_u78C1_u76D8_u6587_u4EF6"><a href="#1_u3001_u521B_u5EFA_u78C1_u76D8_u6587_u4EF6" class="headerlink" title="1、创建磁盘文件"></a>1、创建磁盘文件</h4><p>在MacOs系统中使用磁盘镜像创建一个大小写敏感的文件系统很简单。打开Mac自带的磁盘工具（Disk Utility），选择<code>New Image</code>，分配至少26G大小的空间；稍微大一点的空间可能会更好如<code>50G</code>。保证选择格式为<code>OSX 扩展（区分大小写，日志式）</code>的卷。</p>
<div><br>    <img src="http://res.cloudinary.com/dmfz9aun7/image/upload/v1457867135/android/android_disk_img.jpg" style="height:350px"><br></div>

<p>也可以通过shell命令行来创建磁盘镜像</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdiutil create -type SPARSE -fs <span class="string">'Case-sensitive Journaled HFS+'</span> -size <span class="number">50</span>g ~/android.dmg</span><br></pre></td></tr></table></figure>
<p>上面的命令行会创建一个<code>.dmg</code>（或<code>.dmg.sparseimage</code>）格式文件。以后可以用这个镜像来作为Android 开发环境的磁盘。<br>之后，如果需要更大的磁盘空间，可以用下面的命令行来改变磁盘镜像的大小<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># hdiutil resize -size &lt;new-size-you-want&gt;g ~/android.dmg.sparseimage</span><br></pre></td></tr></table></figure></p>
<p>对于名称为<code>android.dmg</code>的磁盘镜像，可以在<code>~/.bash_profile</code>文件中加入下面的辅助<code>function</code>来启动你的磁盘镜像</p>
<ul>
<li><p>当执行<code>mountAndroid</code>时挂载镜像</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># mount the android file image</span><br><span class="line">function mountAndroid &#123; hdiutil attach ~/android.dmg -mountpoint /Volumes/android; &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>执行<code>umountAndroid</code>卸载镜像</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># unmount the android file image</span><br><span class="line">function umountAndroid() &#123; hdiutil detach /Volumes/android; &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>镜像文件的地址要视你的本地具体的镜像的位置（本地的镜像地址在home的根目录中）。<br>磁盘镜像创建完毕</p>
<h4 id="2_u3001_u5B89_u88C5_u914D_u7F6EJDK"><a href="#2_u3001_u5B89_u88C5_u914D_u7F6EJDK" class="headerlink" title="2、安装配置JDK"></a>2、安装配置JDK</h4><p>在安装和配置JDK的时候要根据你的Mac 系统的版本来决定你要选择的JDK版本和要编译的Android Source的分支（branch）。</p>
<ul>
<li><code>master</code>分支的<a href="https://android.googlesource.com/" target="_blank" rel="external">AOSP</a>需要Java 8.x 对应的<a href="http://www.oracle.com/technetwork/java/javase/downloads/java-archive-javase8-2177648.html#jdk-8u45-oth-JPR" target="_blank" rel="external">JDK 1.8</a></li>
<li><code>5.0.x</code>分支的AOSP需要Java 7对应的版本<a href="https://www.oracle.com/technetwork/java/javase/downloads/java-archive-downloads-javase7-521261.html#jdk-7u71-oth-JPR" target="_blank" rel="external">JDK 1.7</a></li>
<li><code>Gingerbread</code>到<code>KitKat</code>版本之间的Android版本需要下载安装Java 6 对应的 <a href="http://support.apple.com/kb/dl1572" target="_blank" rel="external">Java JDK</a></li>
</ul>
<h5 id="1_29_Master_u5206_u652F"><a href="#1_29_Master_u5206_u652F" class="headerlink" title="1) Master分支"></a>1) Master分支</h5><p>为了在Mac上编译最新的源码，需要运行<code>Mac OS X v10.10 (Yosemite)</code>或<code>更新</code>版本的Mac，和对应的<code>Xcode 4.5.2</code>及以上版本的Command Line Tools。</p>
<h5 id="2_29_6-0-x_u5206_u652F"><a href="#2_29_6-0-x_u5206_u652F" class="headerlink" title="2) 6.0.x分支"></a>2) 6.0.x分支</h5><p>编译 6.0.x的AOSP 源码，需要系统版本为<code>Mac OS X v10.10 (Yosemite)</code>的Mac，和对应版本为<code>Xcode 4.5.2</code>与<code>Command Line Tools</code></p>
<h5 id="3_29_5-0-x_u5206_u652F"><a href="#3_29_5-0-x_u5206_u652F" class="headerlink" title="3) 5.0.x分支"></a>3) 5.0.x分支</h5><p>编译 5.0.x的AOSP 源码，需要系统版本为<code>Mac OS X v10.8 (Mountain Lion)</code>的Mac，和对应版本为<code>Xcode 4.5.2</code>与<code>Command Line Tools</code></p>
<h5 id="4_29_4-4-x_u5206_u652F"><a href="#4_29_4-4-x_u5206_u652F" class="headerlink" title="4) 4.4.x分支"></a>4) 4.4.x分支</h5><p>编译 4.4.x的AOSP 源码，需要系统版本为<code>Mac OS X v10.6 (Snow Leopard)</code>或<code>Mac OS X v10.7 (Lion)</code>的Mac，和对应版本为<code>Xcode 4.2</code>与<code>Command Line Tools</code>。</p>
<h5 id="5_29_4-0-x_u4EE5_u53CA_u66F4_u65E9_u7684_u5206_u652F"><a href="#5_29_4-0-x_u4EE5_u53CA_u66F4_u65E9_u7684_u5206_u652F" class="headerlink" title="5) 4.0.x以及更早的分支"></a>5) 4.0.x以及更早的分支</h5><p>对于4.0.x以及更早版本的分支，需要系统版本为<code>Mac OS X v10.5 (Leopard)</code>或<code>Mac OS X v10.6 (Snow Leopard)</code>的Mac，同时要有<code>Mac OS X v10.5 SDK</code>的支持</p>
<h4 id="3_u3001_u5B89_u88C5_u9700_u6C42_u5DE5_u5177"><a href="#3_u3001_u5B89_u88C5_u9700_u6C42_u5DE5_u5177" class="headerlink" title="3、安装需求工具"></a>3、安装需求工具</h4><ul>
<li>安装Xcode</li>
</ul>
<p>从<a href="https://developer.apple.com/resources/cn/" target="_blank" rel="external">Apple Developer</a>网站来安装Xcode。建议<code>3.1.4</code>版本及以上的Xcode。版本<code>4.x</code>可能会引起一些问题。如果你未注册苹果开发者，则需要创建一个Apple ID来下载Xcode。</p>
<ul>
<li>安装<a href="http://www.macports.org/install.php" target="_blank" rel="external">MacPorts</a>（安装时间可能会比较长，耐心等待即可）</li>
</ul>
<p><code>注意：</code> 保证在<code>/usr/bin</code>上级路径中已有<code>/opt/local/bin</code>路径目录。如果没有，需要在<code>~/.bash_profile</code>文件中添加一下命令<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH=/opt/local/bin:$PATH</span><br></pre></td></tr></table></figure></p>
<p><code>注意：</code>如果home根目录中不存在.bash_profile 文件，需要手动创建一个。</p>
<ul>
<li>从MacPorts上获取<code>Git</code>、<code>GPG</code>等包<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ POSIXLY_CORRECT=<span class="number">1</span> sudo port install gmake libsdl git gnupg</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>如果Mac系统版本为OS X v10.4，还需要安装<code>bison</code><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ POSIXLY_CORRECT=<span class="number">1</span> sudo port install bison</span><br></pre></td></tr></table></figure></p>
<p>对于版本<code>ICS</code>（ Ice Cream Sandwich (4.0.x)）之前的Android，使用 gmake 3.82版本会有阻止android源码编译的bug，安装时请安装最新的gmake或者通过以下几步安装<code>3.81</code>版本。</p>
<ol>
<li><p>编辑<code>/opt/local/etc/macports/sources.conf</code>，添加一行</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file:<span class="comment">///Users/Shared/dports</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在远程同步之前，创建目录</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir /Users/Shared/dports</span><br></pre></td></tr></table></figure>
</li>
<li><p>在新的dports目录中运行</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ portindex /Users/Shared/dports</span><br></pre></td></tr></table></figure>
</li>
<li><p>最后安装旧版本的gmake</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo port install gmake @<span class="number">3.81</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="4_u3001_u89E3_u9664_u6587_u4EF6_u9650_u5236"><a href="#4_u3001_u89E3_u9664_u6587_u4EF6_u9650_u5236" class="headerlink" title="4、解除文件限制"></a>4、解除文件限制</h4><p>默认情况下，Mac系统限制了同时打开文件数，会限制编译进程的执行；在 ~/.bash_profile文件中添加以下命令来取消限制：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># set the number of open files to be 1024</span><br><span class="line">ulimit -S -n 1024</span><br></pre></td></tr></table></figure></p>
<h4 id="5_u3001_u81EA_u5B9A_u4E49_u914D_u7F6E_uFF08_u53EF_u9009_uFF09"><a href="#5_u3001_u81EA_u5B9A_u4E49_u914D_u7F6E_uFF08_u53EF_u9009_uFF09" class="headerlink" title="5、自定义配置（可选）"></a>5、自定义配置（可选）</h4><p>使用<code>ccache</code>编译工具来加速<code>rebuilds</code>。如果你经常用<code>make clean</code>命令或切换不同开发版本，<code>ccache</code>很有用。</p>
<ul>
<li>在.bashrc（或类似）文件中加入下面命令<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export USE_CCACHE=<span class="number">1</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>默认情况<code>cache</code>会被存储在~/.ccache中。如果你的home目录在NFS或其他非本地文件系统上，你也可以在.bashrc文件中指定cache目录<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export CCACHE_DIR=&lt;path-to-your-cache-directory&gt;</span><br></pre></td></tr></table></figure></p>
<p>建议缓存的大小为50-100GB，下载源码后需要先执行下面的命令<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">prebuilts/misc/linux-x86/ccache/ccache -M <span class="number">50</span>G</span><br></pre></td></tr></table></figure></p>
<p>如果是Mac系统，应该用darwin-x86来替换linux-x86<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">prebuilts/misc/darwin-x86/ccache/ccache -M <span class="number">50</span>G</span><br></pre></td></tr></table></figure></p>
<p>当编译<code>Ice Cream Sandwich (4.0.x)</code>及之前版本时，<code>ccache</code>则在不同的位置：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">prebuilt/linux-x86/ccache/ccache -M <span class="number">50</span>G</span><br></pre></td></tr></table></figure></p>
<p>设置存储在CCACHE_DIR中，并且为持久化状态。</p>
<h4 id="u4E8C_u3001_u4E0B_u8F7D_u6E90_u7801"><a href="#u4E8C_u3001_u4E0B_u8F7D_u6E90_u7801" class="headerlink" title="二、下载源码"></a>二、下载源码</h4><p>配置好开发环境后，就可以进行源码下载了。因为国内网络环境，国内开发者建议通过<a href="https://mirrors.tuna.tsinghua.edu.cn/help/AOSP/" target="_blank" rel="external">清华AOSP</a>来下载AOSP。用清华AOSP时建议用<code>repo git</code>来下载源码。</p>
<h5 id="1-_u5B89_u88C5Repo"><a href="#1-_u5B89_u88C5Repo" class="headerlink" title="1.安装Repo"></a>1.安装Repo</h5><p>Repo是一个辅助Git管理Android版本及分支的工具.在安装repo前,需要新建一个文件夹~/bin(名字可随意定)并把这个文件夹放到PATH环境变量里,然后我们就可以把repo下载到这个文件夹里.</p>
<ul>
<li><p>保证你在home目录中有<code>bin/</code>的目录并且包含在你的路径中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir ~/bin</span><br><span class="line">$ PATH=~/bin:$PATH</span><br></pre></td></tr></table></figure>
</li>
<li><p>下载Repo工具并保证可以执行</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ curl https:<span class="comment">//storage.googleapis.com/git-repo-downloads/repo &gt; ~/bin/repo</span></span><br><span class="line">$ chmod a+x ~/bin/repo</span><br></pre></td></tr></table></figure>
</li>
<li><p>建立工作目录（目录可以是任意指定的 ，Mac可以在挂载<code>Disk Image</code>中创建目录）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir WORKING_DIRECTORY</span><br><span class="line">cd WORKING_DIRECTORY</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置Git的name 和 email。为了使用Gerrit Code-review工具，需要一个注册<a href="https://www.google.com/accounts" target="_blank" rel="external">Google账号</a>的email，保证email是激活状态能够收取到消息。(若为清华AOSP，Email随意)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global user.name <span class="string">"Your Name"</span></span><br><span class="line">$ git config --global user.email <span class="string">"you@example.com"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>运行<code>repo init</code>来初始化代码仓库。必须为manifest指定一个URL，指定要下载的远程代码分支</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ repo init -u https:<span class="comment">//android.googlesource.com/platform/manifest</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>上面初始的是<code>master</code>分支的代码，根据你的Mac系统版本来选择android源码版本，可以为之后编译工具减少不少的麻烦。用<code>-b</code>命令来选择分支。因为本文Mac系统版本为 Mac OSX 10.11，所以用的master分支的源码来进行源码学习。具体分支查看<a href="https://source.android.com/source/build-numbers.html#source-code-tags-and-builds" target="_blank" rel="external">Source Code Tags and Builds</a>。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ repo init -u https:<span class="comment">//android.googlesource.com/platform/manifest -b android-4.0.1_r1</span></span><br></pre></td></tr></table></figure></p>
<p>国内开发者可以参考文章<a href="https://lug.ustc.edu.cn/wiki/mirrors/help/aosp" target="_blank" rel="external">Android 镜像使用帮助</a></p>
<p>初始化成功后，会有<code>Repo is initialized in your working directory</code>的成功消息了。对应源码根目录会含有对应的<code>.repo</code>目录。</p>
<ul>
<li>下载源码：在上面指定<code>WORKING_DIRECTORY</code>根目录中用repo sync命令拉取android 源码，并下载到本地，<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ repo sync</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>下载源码的时间特别漫长,中途可能会发生断开连接的现象。不过下载支持断点续传，停止时再用repo sync命令即可。<br>更多关于<a href="https://source.android.com/source/developing.html" target="_blank" rel="external">Repo command</a></p>
<h4 id="u4E09_u3001_u7F16_u8BD1_u6E90_u7801"><a href="#u4E09_u3001_u7F16_u8BD1_u6E90_u7801" class="headerlink" title="三、编译源码"></a>三、编译源码</h4><p>源码下载完成后就可以进行编译工作了。源码下载成功后，会自动解压缩到<code>WORKING_DIRECTORY</code>目录中，如果你下载的源码不是在挂载的android磁盘镜像中，需要将<code>WORKING_DIRECTORY</code>中的源码拷贝到<code>/Volumes/android/</code>中，进行编译（command+c - command + v 即可）。</p>
<ul>
<li><p>进入源码根目录</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /Volumes/android</span><br></pre></td></tr></table></figure>
</li>
<li><p>执行envsetup.sh脚本初始化环境</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ source build/envsetup.sh</span><br></pre></td></tr></table></figure>
<p>  或</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ . build/envsetup.sh</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>得到类似这面这样的提示信息</p>
<div><br><img src="http://res.cloudinary.com/dmfz9aun7/image/upload/v1457874157/android/envsetup_sh.jpg" style="width:600px"><br></div>

<ul>
<li>选择编译的目标<br>用<code>lunch</code>选择要编译的目标，如：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ lunch aosp_arm-eng</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>表示编译后的版本为模拟器的版本。成功后得到类似下面这样的信息</p>
<div><br><img src="http://res.cloudinary.com/dmfz9aun7/image/upload/v1457874467/android/lunch_build.jpg" style="width:600px"><br></div>

<p>更多查看<a href="https://source.android.com/source/running.html" target="_blank" rel="external">Running Builds</a></p>
<ul>
<li>开始编译<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ make -jN</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>其中N代表同时进行的任务数.官方建议任务数设置为线程数的1~2倍,比如我的机器是单CPU,四核,8线程,则最快的构建任务数是8~16。根据不同机器的性能，编译时长会有不同的差异。本文的Mac配置<code>MacBook Pro (2.2 GHz Intel Core i7/16 GB 1600 MHz DDR3)</code>编译一个半小时。在编译过程中可能会有因为各种问题而中断编译。在文章<a href="http://blog.alexwan1989.com/2016/03/04/Android%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0%EF%BC%9A%E7%BC%96%E8%AF%91%E8%BF%87%E7%A8%8B%E4%B8%AD%E7%9A%84%E9%97%AE%E9%A2%98/" target="_blank" rel="external">Android源码学习（二）：编译问题总结</a>中对常遇到的问题进行了总结。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">**<span class="function">make completed <span class="title">successfully</span> <span class="params">(xx:xx (mm:ss)</span>)**</span></span><br></pre></td></tr></table></figure></p>
<p>如果出现以上的提示，恭喜，表示你你已经编译成功。</p>
<p>因为编译时选择的是aosp_arm-eng，所以用的是模拟器来进行调试<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ emulator</span><br></pre></td></tr></table></figure></p>
<p>模拟器启动很慢，大概10分钟这样模拟器运行成功。有资源的同学建议还是用真机来刷。具体的刷机参考<a href="https://source.android.com/source/building.html#flash-a-device" target="_blank" rel="external">Flash a Device</a>，这里就不详细说明了。</p>
<h4 id="u56DB_u3001_u67E5_u770B_u6E90_u7801"><a href="#u56DB_u3001_u67E5_u770B_u6E90_u7801" class="headerlink" title="四、查看源码"></a>四、查看源码</h4><p>Mac下查看android源码，这里推荐<a href="https://www.sublimetext.com/" target="_blank" rel="external">Sublime Text</a>配合插件还是比较好用的，类似这样</p>
<div><br><img src="http://res.cloudinary.com/dmfz9aun7/image/upload/v1457875178/android/sublime_text_android_source.jpg" style="width:650px"><br></div>

<p>具体可以参考<a href="http://blog.csdn.net/wangbaochu/article/details/44836661" target="_blank" rel="external">Android 源码Mac-OSX查看工具Sublime-Text2</a><br>来安装<a href="https://packagecontrol.io/installation" target="_blank" rel="external">Package Control插件</a>和CTags Package：</p>
<ul>
<li><p>安装Package Control插件</p>
<ol>
<li>打开控制台：View-&gt;show console 或 ctrl + ~</li>
<li>本文用是Sublime Text3 , 输入以下命令 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request,os,hashlib; h = <span class="string">'2915d1851351e5ee549c20394736b442'</span> + <span class="string">'8bc59f460fa1548d1514676163dafc88'</span>; pf = <span class="string">'Package Control.sublime-package'</span>; ipp = sublime.installed_packages_path(); urllib.request.install_opener( urllib.request.build_opener( urllib.request.ProxyHandler()) ); by = urllib.request.urlopen( <span class="string">'http://packagecontrol.io/'</span> + pf.replace(<span class="string">' '</span>, <span class="string">'%20'</span>)).read(); dh = hashlib.sha256(by).hexdigest(); print(<span class="string">'Error validating download (got %s instead of %s), please try manual install'</span> % (dh, h)) <span class="keyword">if</span> dh != <span class="function">h <span class="keyword">else</span> <span class="title">open</span><span class="params">(os.path.join( ipp, pf)</span>, 'wb' ).<span class="title">write</span><span class="params">(by)</span></span></span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p>安装CTags Package</p>
<ol>
<li>首先打开Sublime Text3，右键 -&gt; Preference -&gt; Packages Browse。查看是否已经安装了CTags Package，如果没有则继续下面步骤。</li>
<li>右键 -&gt; Preference -&gt; Package control, 输入”install package”，它会找出你可以安装的插件，在列表中选择ctag插件进行安装</li>
<li><p>修改函数跳转方式: 默认函数跳转：Ctrl+shift+左键; 跳转返回：Ctrl+shift+右键。修改方法：</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Perference-&gt;Package Settings-&gt;CTags-&gt;Mouse Binding Default-&gt;复制全部-&gt;粘贴到Perference-&gt;Package Settings-&gt;CTags-&gt;Mouse Binding User</span><br></pre></td></tr></table></figure>
<p> 把里面的”ctrl+shift”，修改为“command”，这样就可以用“command+左键”跳转了</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[  </span><br><span class="line">&#123;  </span><br><span class="line">  <span class="string">"button"</span>: <span class="string">"button1"</span>,  </span><br><span class="line">  <span class="string">"count"</span>: <span class="number">1</span>,  </span><br><span class="line">  <span class="string">"press_command"</span>: <span class="string">"drag_select"</span>,  </span><br><span class="line">  <span class="string">"modifiers"</span>: [“command”],  </span><br><span class="line">  <span class="string">"command"</span>: <span class="string">"navigate_to_definition"</span>  </span><br><span class="line">&#125;,  </span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"button"</span>: <span class="string">"button2"</span>,  </span><br><span class="line">  <span class="string">"count"</span>: <span class="number">1</span>,  </span><br><span class="line">  <span class="string">"modifiers"</span>: [<span class="string">"command"</span>],  </span><br><span class="line">  <span class="string">"command"</span>: <span class="string">"jump_prev"</span>  </span><br><span class="line">&#125;  </span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p>导入Android 源码工程</p>
<ol>
<li>在Sublime Text3工具栏点击 Project-&gt;Open Project, 选择Android源码根目录作为工程导入</li>
<li>右键点击Side Bar中android 源码根目录，右键-&gt; CTgas: Rebuild Tags, 创建索引</li>
<li>接下来就利用快捷键浏览代码了： <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Command+P：查找文件</span><br><span class="line">Command+R：查找方法</span><br><span class="line">Command+左键：文件或函数跳转        </span><br><span class="line">Command+右键：返回文件或函数跳转的原始位置</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/01/12/Android源码学习（一）/" data-id="cipdnp2hd000wvx22s6in689t" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Android网络Client：Retrofit(一)" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/11/Android网络Client：Retrofit(一)/" class="article-date">
  <time datetime="2016-01-11T15:44:20.000Z" itemprop="datePublished">2016-01-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/11/Android网络Client：Retrofit(一)/">Android网络Client：Retrofit(一)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="http://square.github.io/retrofit/" target="_blank" rel="external">Retrofit - A type-safe HTTP client for Android and Java</a></p>
<p><a href="http://www.jianshu.com/p/45cb536be2f4?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=reader_share&amp;utm_source=weixin&amp;from=singlemessage&amp;isappinstalled=0" target="_blank" rel="external">Retrofit分析-漂亮的解耦套路</a></p>
<h3 id="Retrofit"><a href="#Retrofit" class="headerlink" title="Retrofit"></a>Retrofit</h3><p><a href="http://square.github.io/retrofit/" target="_blank" rel="external">A type-safe HTTP client for Android and Java</a></p>
<h3 id="u4E00_u3001_u4ECB_u7ECD"><a href="#u4E00_u3001_u4ECB_u7ECD" class="headerlink" title="一、介绍"></a>一、介绍</h3><p>1.接口定义来定义HTTP API</p>
<pre><code>public interface GitHubService{
    @GET(&quot;users/{user}/repos&quot;)
    Call&lt;List&lt;Repo&gt;&gt; listRepos(@Path(&quot;user&quot;) String user);
}
</code></pre><p>2.Retrofit对象生成GitHubService的实现</p>
<pre><code>Retrofit retorfit = new Retrofit.Builder()
        .baseUrl(&quot;https://api.github.com&quot;)
        .build();

GitHubService service = retrofit.create(GitHubService.class);
</code></pre><p>3.创建GitHubService的实现后，发起同步或异步的网络请求，并返回Call对象</p>
<pre><code>Call&lt;List&lt;Repo&gt;&gt; repos = service.listRepos(&quot;octocat&quot;);
</code></pre><p>注解描述HTTP请求</p>
<pre><code>1.支持URL参数和查询参数动态可配
2.支持对象转换成请求体（eg. JSON 、Protocol buffers）
3.支持多种请求体和文件上传
</code></pre><h3 id="u4E8C_u3001API__u58F0_u660E"><a href="#u4E8C_u3001API__u58F0_u660E" class="headerlink" title="二、API 声明"></a>二、API 声明</h3><p>Annotations on the interface methods and its parameters indicate how a request will be handled.<br>以注解形式定义接口方法和对应的请求参数</p>
<p>1.请求方法</p>
<p>每个方法必须有一个对应的HTTP请求注解，提供请求的方法和对应的URL参数。五类注解：<code>GET</code>、<code>POST</code>、<code>PUT</code>、 <code>DELETE</code> 和<code>HEAD</code>。对应的资源URL请求地址在注解上指定。</p>
<pre><code>@GET(&quot;users/list&quot;)
</code></pre><p>你也可以在URL中指定查询参数</p>
<pre><code>@GET(&quot;users/list?sort=desc&quot;)
</code></pre><p>2.URL 处理</p>
<p>URL可以使用替换块动态改变方法的请求参数。替换参数为使用<code>{}</code>引用起来的字符串，并且要使用<code>@Path</code>注解的方式，用同样的字符串表示参数。</p>
<pre><code>@GET(&quot;group/{id}/users&quot;)
Call&lt;List&lt;User&gt;&gt; groupList(@Path(&quot;id&quot;) int groupId);
</code></pre><p>也可以添加查询参数</p>
<pre><code>@GET(&quot;group/{id}/users&quot;)
Call&lt;List&lt;User&gt;&gt; groupList(@Path(&quot;id&quot;) int groupId , @Query(&quot;sort&quot;) String sort);
</code></pre><p>复杂查询，参数可以为<code>Map</code>类型</p>
<pre><code>@GET(&quot;group/{id}/users&quot;)
Call&lt;List&lt;User&gt;&gt; groupList(@Path(&quot;id&quot;) int groupId , @QueryMap Map&lt;String , String&gt; options);
</code></pre><p>3.请求体</p>
<p><code>@Body</code>注解用来指定对象作为HTTP请求体</p>
<pre><code>@POST(&quot;users/new&quot;)
Call&lt;User&gt; createUser(@Body User user);
</code></pre><p>使用<code>Retrofit</code>对象实例指定转换器来转换对象。<br>如果没有添加转换器，只能使用<code>RequestBody</code></p>
<p>4.Form Encode编码数据And Multipart数据的请求<br>multipart/form-data : POST数据提交的方式，数据以multipart/form-data来编码。<br>Method 也可以发送form-encoded and multipart编码格式的数据<br><code>@FormUrlEncoded</code>注解表示发送的数据格式为Form-encoded 格式。每个用注解<code>@Filed</code>表示的键值对包含指定键的名称和提供值的对象</p>
<pre><code>@FormUrlEncoded
@POST(&quot;user/edit&quot;)
Call&lt;uSER&gt; updateUser(@Filed(&quot;first_name&quot;) String first , @Field(&quot;last_name&quot;) String last);
</code></pre><p><code>@Multipart</code>注解用来表示Method 为 Multipart请求。Parts使用<code>@Part</code>注解来表示。</p>
<pre><code>@Multipart
@PUT(&quot;user/photo&quot;)
Call&lt;User&gt; updateUser(@Part(&quot;photo&quot;) RequestBody photo , @Part(&quot;description&quot;) RequestBody description);
</code></pre><p>Multipart的Parts对象使用<code>Retrofit</code>的转换器或实现<code>RequestBody</code>来完成序列化</p>
<p>5.HEADER 请求操作</p>
<p><code>@Headers</code>注解为方法指定静态headers</p>
<pre><code>@Headers(&quot;Cache-Control:max-age = 640000&quot;)
@GET(&quot;widget/list&quot;)
Call&lt;List&lt;Widget&gt;&gt; widgetList();

@Headers({
        &quot;Accept: application/vnd.github.v3.full+json&quot; ,
        &quot;User-Agent: Retrofit-Sample-App&quot;
})
@GET(&quot;users/{username}&quot;)
Call&lt;User&gt; getUser(@Path(&quot;username&quot;) String username);
</code></pre><p>  <strong>注意：</strong> Heads不必在每个方法上单独声明，可以在方法中引用相同名称的头部</p>
<p><code>@Header</code>注解可以动态指定Header。与普通请求注解相同需要指定Header的参数，如果参数为null，则Header被忽略掉。另外，值和结果使用的时候会调用<code>toString</code>方法</p>
<pre><code>@GET(&quot;user&quot;)
Call&lt;User&gt; getUser(@Header(&quot;Authorization&quot;) String authorization);
</code></pre><p><a href="https://github.com/square/okhttp/wiki/Interceptors" target="_blank" rel="external">OkHttp interceptor</a>可以为需要添加Header的请求指定头部</p>
<p>6.同步和异步请求</p>
<p><code>Call</code>可以执行同步或异步请求。每个实例只能使用一次，<code>clone()</code>方法可以创建一个新的<code>Call</code>。</p>
<p><strong>注意：</strong> 在Android中，回调会在主线程中执行，在JVM中，回调会在调用Http Request请求的线程中执行。</p>
<h3 id="u4E09_u3001Retrofit_u914D_u7F6E"><a href="#u4E09_u3001Retrofit_u914D_u7F6E" class="headerlink" title="三、Retrofit配置"></a>三、Retrofit配置</h3><p><code>Retrofit</code> 通过定义的API Interfaces转变为回调对象。除了自带的默认的配置信息，开发者也可以自定义实现<code>Retrofit</code>的配置。</p>
<p>1.CONVERTERS 转换器<br>默认情况<code>Retrofit</code>只能把HTTP 体反序列化为<a href="https://github.com/square/okhttp" target="_blank" rel="external">OkHttp</a>的<code>ResponseBody</code>类型的对象，并且<code>@Body</code>只接受<code>ResponseBody</code>数据。<br>Converters 可以支持其他类型的数据。</p>
<p>(1).<a href="https://github.com/google/gson" target="_blank" rel="external">Gson</a>: com.squareup.retrofit2:converter-gson</p>
<p>(2).<a href="http://wiki.fasterxml.com/JacksonHome" target="_blank" rel="external">Jackson</a>: com.squareup.retrofit2:converter-jackson</p>
<p>(3).<a href="https://github.com/square/moshi/" target="_blank" rel="external">Moshi</a>: com.squareup.retrofit2:converter-moshi</p>
<p>(4).<a href="https://developers.google.com/protocol-buffers/" target="_blank" rel="external">Protobuf</a>: com.squareup.retrofit2:converter-protobuf</p>
<p>(5).<a href="https://github.com/square/wire" target="_blank" rel="external">Wire</a>: com.squareup.retrofit2:converter-wire</p>
<p>(6).<a href="http://simple.sourceforge.net/" target="_blank" rel="external">Simple XML</a>: com.squareup.retrofit2:converter-simplexml</p>
<p>例子：用基于Gson反序列化的<code>GsonConverterFactory</code>来生成<code>GitHubService</code>实例，</p>
<pre><code>Retrofit retrofit = new Retrofit.Builder()
        .baseUrl(&quot;https://api.github.com&quot;)
        .addConverterFactory(GsonConverterFactory.create())
        .build();

GitHubService service = retrofit.create(GitHubService.class);
</code></pre><p>2.自定义CONVERTERS</p>
<p>如果要使用内容格式为如 <code>YAML</code>, <code>txt</code>等<code>Retrofit</code>不支持的或希望使用不同的库实现支持的内容的API，你可以创建继承<code>Converter.Factory</code>的自定义Converter，在建造自己的adapter时候指定一个自定义的Converter实例。</p>
<p><code>Retrofit</code>地址 ： <a href="http://github.com/square/retrofit" target="_blank" rel="external">Github</a></p>
<p>(1).Retrofit requires at minimum Java 7 or Android 2.3.</p>
<p>(2).proguard</p>
<pre><code>-dontwarn retrofit2.**
-keep class retrofit2.** { *; }
-keepattributes Signature
-keepattributes Exceptions
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/01/11/Android网络Client：Retrofit(一)/" data-id="cipdnp2h8000qvx220imt9ciq" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
    </nav>
  
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android源码学习系列/">Android源码学习系列</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java设计模式/">Java设计模式</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/RxJava/">RxJava</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java设计模式/">Java设计模式</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RxJava/">RxJava</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android/">android</a><span class="tag-list-count">2</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Java设计模式/" style="font-size: 10px;">Java设计模式</a> <a href="/tags/RxJava/" style="font-size: 10px;">RxJava</a> <a href="/tags/android/" style="font-size: 20px;">android</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a><span class="archive-list-count">14</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/06/13/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2016/06/05/Android：Activity启动过程/">Android：Activity启动过程</a>
          </li>
        
          <li>
            <a href="/2016/05/17/RxJava读书笔记(一)/">RxJava读书笔记(一)</a>
          </li>
        
          <li>
            <a href="/2016/04/18/Android：NDK开发（二）/">Android NDK开发（二）：使用Android Studio开发进行NDK开发</a>
          </li>
        
          <li>
            <a href="/2016/04/12/Android：NDK开发（一）/">Android：NDK开发（一）</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>