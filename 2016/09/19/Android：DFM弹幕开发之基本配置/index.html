
<!DOCTYPE html>
<html lang="zh">
    
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Alexwan Studio">
    <title>Android：DFM弹幕开发之基本配置 - Alexwan Studio</title>
    <meta name="author" content="alexwan">
    
        <link rel="icon" href="/assets/images/https://cdn.discordapp.com/icons/102860784329052160/109fd014c718f40110c4a182f105ca71.jpg">
    
    
        <link rel="alternative" type="application/atom+xml" title="RSS" href="/atom.xml">
    
    <meta name="description" content="DanmakuFlameMaster(以下简称DFM)是哔哩哔哩开源的Android弹幕解析绘制引擎项目。DFM使用多种方式(View/SurfaceView/TextureView)实现高效绘制，支持自定义字体，支持多种弹幕参数设置等
一、配置Gradle
1234567repositories &amp;#123;    jcenter()&amp;#125;dependencies &amp;#123;    co">
<meta property="og:type" content="blog">
<meta property="og:title" content="Android：DFM弹幕开发之基本配置">
<meta property="og:url" content="http://blog.alexwan1989.com/2016/09/19/Android：DFM弹幕开发之基本配置/index.html">
<meta property="og:site_name" content="Alexwan Studio">
<meta property="og:description" content="DanmakuFlameMaster(以下简称DFM)是哔哩哔哩开源的Android弹幕解析绘制引擎项目。DFM使用多种方式(View/SurfaceView/TextureView)实现高效绘制，支持自定义字体，支持多种弹幕参数设置等
一、配置Gradle
1234567repositories &amp;#123;    jcenter()&amp;#125;dependencies &amp;#123;    co">
<meta property="og:image" content="http://res.cloudinary.com/dmfz9aun7/image/upload/v1474278152/android/dfm_play.gif">
<meta property="og:image" content="http://res.cloudinary.com/dmfz9aun7/image/upload/v1474278810/android/dfm_add.gif">
<meta property="og:image" content="http://res.cloudinary.com/dmfz9aun7/image/upload/c_scale,w_521/v1474442790/android/danmaku_bg.png">
<meta property="og:image" content="http://res.cloudinary.com/dmfz9aun7/image/upload/c_scale,w_556/v1474625129/android/danmaku_parser.png">
<meta property="og:updated_time" content="2016-11-14T02:14:58.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android：DFM弹幕开发之基本配置">
<meta name="twitter:description" content="DanmakuFlameMaster(以下简称DFM)是哔哩哔哩开源的Android弹幕解析绘制引擎项目。DFM使用多种方式(View/SurfaceView/TextureView)实现高效绘制，支持自定义字体，支持多种弹幕参数设置等
一、配置Gradle
1234567repositories &amp;#123;    jcenter()&amp;#125;dependencies &amp;#123;    co">
    
    
    
        <meta property="og:image" content="/assets/images/http://res.cloudinary.com/dmfz9aun7/image/upload/v1467081842/android/3397490934332211.jpg"/>
    
    
        <meta property="og:image" content="/2016/09/19/Android：DFM弹幕开发之基本配置/http://res.cloudinary.com/dmfz9aun7/image/upload/b_rgb:fff,c_fit,dpr_0.75,e_grayscale,w_564/v1474249270/android/bilibili_dfm.png"/>
        <meta class="swiftype" name="image" data-type="enum" content="http://blog.alexwan1989.com/2016/09/19/Android：DFM弹幕开发之基本配置/http://res.cloudinary.com/dmfz9aun7/image/upload/b_rgb:fff,c_fit,dpr_0.75,e_grayscale,w_564/v1474249270/android/bilibili_dfm.png" />
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style.min.css" type="text/css">
    <!--STYLES END-->
    
    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-74386866-1']);
        _gaq.push(['_trackPageview']);
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>

</head>

    <body>
        <div id="blog">
            <header id="header" data-behavior="1">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <h1 class="header-title">
        <a class="header-title-link" href="/ ">Alexwan Studio</a>
    </h1>
    
        
            <a  class="header-right-icon st-search-show-outputs"
                href="/#search">
        
                <i class="fa fa-lg fa-search"></i>
            </a>
    
</header>
            <nav id="sidebar" data-behavior="1">
    
        <div class="sidebar-profile">
            <a href="/#about">
                
                    <!-- use remote images as avatar-->
                    <img class="sidebar-profile-picture" src="http://res.cloudinary.com/dmfz9aun7/image/upload/v1467081842/android/3397490934332211.jpg"/>
                
            </a>
            <span class="sidebar-profile-name">alexwan</span>
        </div>
    
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/ "
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-home"></i>
                    <span class="sidebar-button-desc">主页</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-categories"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
                    <span class="sidebar-button-desc">分类</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-tags"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                    <span class="sidebar-button-desc">标签</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-archives"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-bars"></i>
                    <span class="sidebar-button-desc">归档</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link st-search-show-outputs"
                         href="/#search"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-search"></i>
                    <span class="sidebar-button-desc">搜索</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/#about"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-question"></i>
                    <span class="sidebar-button-desc">关于</span>
                </a>
        </li>
        
    </ul>
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="https://github.com/alexwan02" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-github-square"></i>
                    <span class="sidebar-button-desc">GitHub</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="http://stackoverflow.com/users/4919743/alexwan1989" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-stack-overflow"></i>
                    <span class="sidebar-button-desc">Stack Overflow</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="https://alexwan0312@gmail.com" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-envelope-o"></i>
                    <span class="sidebar-button-desc">Mail</span>
                </a>
        </li>
        
    </ul>
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/atom.xml"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
                    <span class="sidebar-button-desc">RSS</span>
                </a>
        </li>
        
    </ul>
    
</nav>

            
            <div id="main" data-behavior="1"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post" itemscope itemType="http://schema.org/BlogPosting">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title" itemprop="headline">
            Android：DFM弹幕开发之基本配置
        </h1>
    
    <div class="post-meta">
    <time itemprop="datePublished" content="Mon Sep 19 2016 09:34:37 GMT+0800">
	
		    Sep 19, 2016
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/danmaku/">danmaku</a>


    
</div>
</div>
    
    <div class="post-content markdown" itemprop="articleBody">
        <div class="main-content-wrap">
            <p><a href="https://github.com/Bilibili/DanmakuFlameMaster" target="_blank" rel="external">DanmakuFlameMaster</a>(以下简称DFM)是哔哩哔哩开源的Android弹幕解析绘制引擎项目。<code>DFM</code>使用多种方式(View/SurfaceView/TextureView)实现高效绘制，支持自定义字体，支持多种弹幕参数设置等</p>
<h1 id="u4E00_u3001_u914D_u7F6E"><a href="#u4E00_u3001_u914D_u7F6E" class="headerlink" title="一、配置"></a>一、配置</h1><p>Gradle</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">repositories &#123;</span><br><span class="line">    jcenter()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compile <span class="string">'com.github.ctiao:DanmakuFlameMaster:0.4.9'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在布局中应用</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">master.flame.danmaku.ui.widget.DanmakuView</span></span><br><span class="line">    <span class="attribute">android:id</span>=<span class="value">"@+id/sv_danmaku"</span></span><br><span class="line">    <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"match_parent"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="u4E8C_u3001_u57FA_u7840_u7528_u6CD5"><a href="#u4E8C_u3001_u57FA_u7840_u7528_u6CD5" class="headerlink" title="二、基础用法"></a>二、基础用法</h1><h2 id="1_u3001_u5F39_u5E55_u64AD_u653E"><a href="#1_u3001_u5F39_u5E55_u64AD_u653E" class="headerlink" title="1、弹幕播放"></a>1、弹幕播放</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// Activity onCreate 中初始化弹幕的配置</span></span><br><span class="line"><span class="keyword">final</span> DanmakuView svDanmaku = (DanmakuView) findViewById(R.id.sv_danmaku);</span><br><span class="line"></span><br><span class="line">HashMap&lt;Integer, Integer&gt; maxLinesPair = <span class="keyword">new</span> HashMap&lt;&gt;(); <span class="comment">// 最大行数</span></span><br><span class="line">maxLinesPair.put(BaseDanmaku.TYPE_SCROLL_RL, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">HashMap&lt;Integer, Boolean&gt; overlappingEnablePair = <span class="keyword">new</span> HashMap&lt;&gt;(); <span class="comment">// 防止弹幕重叠</span></span><br><span class="line">overlappingEnablePair.put(BaseDanmaku.TYPE_SCROLL_RL, <span class="keyword">true</span>);</span><br><span class="line">overlappingEnablePair.put(BaseDanmaku.TYPE_FIX_TOP, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">DanmakuContext mDanmakuContext = DanmakuContext.create();   <span class="comment">// 创建弹幕所需的上下文信息</span></span><br><span class="line">mDanmakuContext.setDanmakuStyle(IDisplayer.DANMAKU_STYLE_STROKEN, <span class="number">3</span>) <span class="comment">// 弹幕样式</span></span><br><span class="line">        .setDuplicateMergingEnabled(<span class="keyword">true</span>)    <span class="comment">// 合并重复弹幕</span></span><br><span class="line">        .setScrollSpeedFactor(<span class="number">1.5f</span>)          <span class="comment">// 滚动弹幕速度系数</span></span><br><span class="line">        .setScaleTextSize(<span class="number">0.8f</span>)              <span class="comment">// 弹幕文字大小</span></span><br><span class="line">        .setCacheStuffer(<span class="keyword">new</span> SpannedCacheStuffer(), mCacheStufferAdapter) <span class="comment">// 缓存绘制</span></span><br><span class="line">        .setMaximumLines(maxLinesPair)       <span class="comment">// 弹幕最大行数</span></span><br><span class="line">        .preventOverlapping(overlappingEnablePair); <span class="comment">// 防止弹幕重叠</span></span><br><span class="line"></span><br><span class="line">BaseDanmakuParser mParser = createParser(<span class="keyword">this</span>.getResources().openRawResource(R.raw.comments)); <span class="comment">// 创建弹幕解析器</span></span><br><span class="line"><span class="comment">// 设置弹幕播放的状态回调</span></span><br><span class="line">svDanmaku.setCallback(<span class="keyword">new</span> DrawHandler.Callback() &#123;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prepared</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 弹幕准备完成</span></span><br><span class="line">        Log.d(<span class="string">"DFM"</span> , <span class="string">"prepared"</span>);</span><br><span class="line">        svDanmaku.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateTimer</span><span class="params">(DanmakuTimer timer)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 弹幕播放时间</span></span><br><span class="line">        Log.d(<span class="string">"DFM"</span> , <span class="string">"updateTimer : timer = "</span> + timer.currMillisecond);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">danmakuShown</span><span class="params">(BaseDanmaku danmaku)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 播放新的一条弹幕</span></span><br><span class="line">        Log.d(<span class="string">"DFM"</span> , <span class="string">"danmakuShown : danmaku = "</span> + danmaku.text);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawingFinished</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 弹幕播放结束</span></span><br><span class="line">        Log.d(<span class="string">"DFM"</span> , <span class="string">"drawingFinished"</span>);</span><br><span class="line">    &#125;&#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置弹幕点击监听</span></span><br><span class="line">    mMainBinding.svDanmaku.setOnDanmakuClickListener(<span class="keyword">new</span> IDanmakuView.OnDanmakuClickListener() &#123;</span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onViewClick</span><span class="params">(IDanmakuView view)</span> </span>&#123;</span><br><span class="line">            <span class="comment">// 点击的弹幕</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onDanmakuClick</span><span class="params">(IDanmakus danmakus)</span> </span>&#123;</span><br><span class="line">            <span class="comment">// 弹幕</span></span><br><span class="line">            Log.d(<span class="string">"DFM"</span>, <span class="string">"onDanmakuClick danmakus size:"</span> + danmakus.size());</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 播放准备</span></span><br><span class="line">    svDanmaku.prepare(mParser, mDanmakuContext);</span><br><span class="line">    <span class="comment">// 显示播放FPS,一般用作调试时使用</span></span><br><span class="line">    svDanmaku.showFPS(<span class="keyword">false</span>);</span><br><span class="line">    <span class="comment">// 开启绘制缓存</span></span><br><span class="line">    svDanmaku.enableDanmakuDrawingCache(<span class="keyword">true</span>);</span><br></pre></td></tr></table></figure>
<p>创建弹幕解析器<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * 创建弹幕解析器</span><br><span class="line"> * <span class="doctag">@param</span> stream stream</span><br><span class="line"> * <span class="doctag">@return</span> BaseDanmakuParser</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> BaseDanmakuParser <span class="title">createParser</span><span class="params">(InputStream stream)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (stream == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BaseDanmakuParser() &#123;</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">protected</span> Danmakus <span class="title">parse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Danmakus();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// TAG_BILI XML数据格式的弹幕。TAG_ACFUN JSON数据格式的弹幕</span></span><br><span class="line">    ILoader loader = DanmakuLoaderFactory.create(DanmakuLoaderFactory.TAG_BILI);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        loader.load(stream);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IllegalDataException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    BaseDanmakuParser parser = <span class="keyword">new</span> BiliDanmukuParser();</span><br><span class="line">    IDataSource&lt;?&gt; dataSource = loader.getDataSource();</span><br><span class="line">    parser.load(dataSource);</span><br><span class="line">    <span class="keyword">return</span> parser;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="http://res.cloudinary.com/dmfz9aun7/image/upload/v1474278152/android/dfm_play.gif" alt="img"></p>
<h2 id="2_u3001_u53D1_u9001_u5F39_u5E55"><a href="#2_u3001_u53D1_u9001_u5F39_u5E55" class="headerlink" title="2、发送弹幕"></a>2、发送弹幕</h2><p>常见的弹幕内容一般由以下部分组成<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> : 时间(弹幕出现时间) <span class="keyword">long</span>类型的时间戳</span><br><span class="line"><span class="number">2</span> : 类型(<span class="number">1</span>从左至右滚动弹幕 ； <span class="number">6</span>从右至左滚动弹幕； <span class="number">5</span>顶端固定弹幕；<span class="number">4</span>底端固定弹幕；<span class="number">7</span>高级弹幕；<span class="number">8</span>脚本弹幕)</span><br><span class="line"><span class="number">3</span> : 字号</span><br><span class="line"><span class="number">4</span> : 颜色</span><br><span class="line"><span class="number">5</span> : 弹幕池id</span><br><span class="line"><span class="number">6</span> : 用户hash</span><br><span class="line"><span class="number">7</span> : 弹幕id</span><br></pre></td></tr></table></figure></p>
<p>发送弹幕处理<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">BaseDanmaku baseDanmaku = mDanmakuContext.mDanmakuFactory.createDanmaku(BaseDanmaku.TYPE_FIX_BOTTOM); <span class="comment">// 通过DanmakuFactory来创建弹幕</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 弹幕内容信息</span></span><br><span class="line">baseDanmaku.text = <span class="string">"简单的一条弹幕"</span> + System.nanoTime(); <span class="comment">// 文本内容</span></span><br><span class="line">baseDanmaku.textSize = <span class="number">25f</span> * (mParser.getDisplayer().getDensity() - <span class="number">0.6f</span>); <span class="comment">// 字体大小</span></span><br><span class="line">baseDanmaku.textColor = Color.RED;         <span class="comment">// 字体颜色</span></span><br><span class="line">baseDanmaku.textShadowColor = Color.WHITE; <span class="comment">// 描边颜色</span></span><br><span class="line">baseDanmaku.borderColor = Color.RED;       <span class="comment">// 弹幕边框颜色</span></span><br><span class="line">baseDanmaku.padding = <span class="number">5</span>;                   <span class="comment">// 内边距</span></span><br><span class="line">baseDanmaku.priority = <span class="number">0</span>;                  <span class="comment">// 弹幕优先级,0为低优先级</span></span><br><span class="line">baseDanmaku.isLive = <span class="keyword">false</span>;                <span class="comment">// 是否是直播弹幕</span></span><br><span class="line">baseDanmaku.underlineColor = <span class="number">0</span>;            <span class="comment">// 0表示无下划线</span></span><br><span class="line"><span class="comment">// baseDanmaku.lines = new String[]&#123;"两行弹幕第1行弹幕" , "两行弹幕第2行弹幕"&#125;;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 发送时的时间由弹幕播放时间来确定</span></span><br><span class="line">baseDanmaku.setTime(mMainBinding.svDanmaku.getCurrentTime());<span class="comment">// 弹幕出现的时间</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 发送弹幕，根据业务内容是否执行弹幕上传操作 TODO</span></span><br><span class="line">mMainBinding.svDanmaku.addDanmaku(baseDanmaku);</span><br></pre></td></tr></table></figure></p>
<p><img src="http://res.cloudinary.com/dmfz9aun7/image/upload/v1474278810/android/dfm_add.gif" alt="img"></p>
<h2 id="3-__u5F39_u5E55_u72B6_u6001_u64CD_u4F5C"><a href="#3-__u5F39_u5E55_u72B6_u6001_u64CD_u4F5C" class="headerlink" title="3. 弹幕状态操作"></a>3. 弹幕状态操作</h2><p>（1）. 隐藏<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mMainBinding.svDanmaku.hide();</span><br></pre></td></tr></table></figure></p>
<p>（2）. 显示<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mMainBinding.svDanmaku.show();</span><br></pre></td></tr></table></figure></p>
<p>（3）. 暂停<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mMainBinding.svDanmaku.pause();</span><br></pre></td></tr></table></figure></p>
<p>（4）. 恢复继续<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mMainBinding.svDanmaku.onResume();</span><br></pre></td></tr></table></figure></p>
<p>（2）. 跳转<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mMainBinding.svDanmaku.seekTo(<span class="number">0</span>);   <span class="comment">// 跳转到起始位置</span></span><br></pre></td></tr></table></figure></p>
<h2 id="4-__u5F39_u5E55_u5468_u671F_u7BA1_u7406_u53CA_u8D44_u6E90_u91CA_u653E"><a href="#4-__u5F39_u5E55_u5468_u671F_u7BA1_u7406_u53CA_u8D44_u6E90_u91CA_u653E" class="headerlink" title="4. 弹幕周期管理及资源释放"></a>4. 弹幕周期管理及资源释放</h2><p>弹幕需要与Activity的生命周期配合来处理。防止未及时释放资源，造成Activity的内存问题。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onPause</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onPause();</span><br><span class="line">    <span class="keyword">if</span> (mDanmakuView != <span class="keyword">null</span> &amp;&amp; mDanmakuView.isPrepared()) &#123;</span><br><span class="line">        mDanmakuView.pause();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onResume</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onResume();</span><br><span class="line">    <span class="keyword">if</span> (mDanmakuView != <span class="keyword">null</span> &amp;&amp; mDanmakuView.isPrepared() &amp;&amp; mDanmakuView.isPaused()) &#123;</span><br><span class="line">        mDanmakuView.resume();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onDestroy();</span><br><span class="line">    <span class="keyword">if</span> (mDanmakuView != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 及时释放弹幕资源</span></span><br><span class="line">        mDanmakuView.release();</span><br><span class="line">        mDanmakuView = <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBackPressed</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onBackPressed();</span><br><span class="line">    <span class="keyword">if</span> (mDanmakuView != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 及时释放弹幕资源</span></span><br><span class="line">        mDanmakuView.release();</span><br><span class="line">        mDanmakuView = <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="u4E8C_u3001_u9AD8_u7EA7_u5F39_u5E55"><a href="#u4E8C_u3001_u9AD8_u7EA7_u5F39_u5E55" class="headerlink" title="二、高级弹幕"></a>二、高级弹幕</h1><h2 id="1-__u80CC_u666F_u7ED8_u5236"><a href="#1-__u80CC_u666F_u7ED8_u5236" class="headerlink" title="1. 背景绘制"></a>1. 背景绘制</h2><p><a href="https://github.com/Bilibili/DanmakuFlameMaster" target="_blank" rel="external">DFM</a>自定义SpannedCacheStuffer，drawBackground方法中实现背景绘制操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 绘制有背景的弹幕</span></span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">BackgroundCacheStuffer</span> <span class="keyword">extends</span> <span class="title">SpannedCacheStuffer</span></span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Paint mPaint = <span class="keyword">new</span> Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">measure</span><span class="params">(BaseDanmaku danmaku, TextPaint paint, <span class="keyword">boolean</span> fromWorkerThread)</span> </span>&#123;</span><br><span class="line">        danmaku.padding = <span class="number">10</span>;</span><br><span class="line">        <span class="keyword">super</span>.measure(danmaku, paint, fromWorkerThread);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawBackground</span><span class="params">(BaseDanmaku danmaku, Canvas canvas, <span class="keyword">float</span> left, <span class="keyword">float</span> top)</span> </span>&#123;</span><br><span class="line">        mPaint.setColor(<span class="number">0xEE90A4AE</span>);   <span class="comment">// 背景颜色</span></span><br><span class="line">        RectF rectF = <span class="keyword">new</span> RectF(left + <span class="number">5</span>, top + <span class="number">5</span>, left + danmaku.paintWidth - <span class="number">5</span>, top + danmaku.paintHeight - <span class="number">5</span>); <span class="comment">// 圆角矩形</span></span><br><span class="line">        canvas.drawRoundRect(rectF, <span class="number">50</span> , <span class="number">50</span> , mPaint);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawStroke</span><span class="params">(BaseDanmaku danmaku, String lineText, Canvas canvas, <span class="keyword">float</span> left, <span class="keyword">float</span> top, Paint paint)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 绘制背景时建议禁止绘制描边</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置DanmakuContext<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> DanmakuContext mDanmakuContext;</span><br><span class="line">...</span><br><span class="line">mDanmakuContext.setDanmakuStyle(IDisplayer.DANMAKU_STYLE_STROKEN, <span class="number">3</span>) <span class="comment">// 弹幕样式</span></span><br><span class="line">        .setDuplicateMergingEnabled(<span class="keyword">true</span>)    <span class="comment">// 合并重复弹幕</span></span><br><span class="line">        .setScrollSpeedFactor(<span class="number">1.5f</span>)          <span class="comment">// 滚动弹幕速度系数</span></span><br><span class="line">        .setScaleTextSize(<span class="number">0.8f</span>)              <span class="comment">// 弹幕文字大小</span></span><br><span class="line">        .setCacheStuffer(<span class="keyword">new</span> BackgroundCacheStuffer(), mCacheStufferAdapter) <span class="comment">// 缓存绘制</span></span><br><span class="line">        ...</span><br></pre></td></tr></table></figure></p>
<p><img src="http://res.cloudinary.com/dmfz9aun7/image/upload/c_scale,w_521/v1474442790/android/danmaku_bg.png" alt="img"></p>
<h2 id="2-__u81EA_u5B9A_u4E49_u89E3_u6790_u5668"><a href="#2-__u81EA_u5B9A_u4E49_u89E3_u6790_u5668" class="headerlink" title="2. 自定义解析器"></a>2. 自定义解析器</h2><p><a href="https://github.com/Bilibili/DanmakuFlameMaster" target="_blank" rel="external">DFM</a>内置两种解析器<a href="https://github.com/Bilibili/DanmakuFlameMaster/blob/d4abc40bcaa8cc6786c1dff4ca1694dd626955b5/Sample/src/main/java/com/sample/BiliDanmukuParser.java" target="_blank" rel="external">BiliDanmukuParser</a>。<code>BiliDanmukuParser</code>使用XML数据格式的弹幕，是BiliBili标准的弹幕格式。<code>AcFunDanmakuParser</code>使用JSON数据格式的弹幕，适用于解析Acfun标准的弹幕。除了使用这两种弹幕格式以外，还可以根据具体弹幕内容来自定义弹幕解析器。如有以下内容Json格式的弹幕，那么如何来处理这种数据呢，此时就需要自定义实现弹幕数据的解析。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[&#123;</span><br><span class="line">    <span class="string">"content"</span>:   <span class="string">"弹幕内容"</span> ,      <span class="comment">// 弹幕显示的内容</span></span><br><span class="line">    <span class="string">"time"</span> :     <span class="number">23.826000213623</span>, <span class="comment">// 弹幕出现的时间</span></span><br><span class="line">    <span class="string">"type"</span>:       <span class="number">6</span>      ,        <span class="comment">// 弹幕类型（参考danmaku中弹幕类型）</span></span><br><span class="line">    <span class="string">"fontsize"</span>:   <span class="number">12</span>     ,        <span class="comment">// 弹幕显示的字体大小</span></span><br><span class="line">    <span class="string">"fontcolor"</span>:  <span class="number">16777215</span>,       <span class="comment">// 弹幕字体颜色</span></span><br><span class="line">    <span class="string">"userid"</span>:     <span class="number">6</span>,              <span class="comment">// 用户hash</span></span><br><span class="line">    <span class="string">"username"</span>:   <span class="string">"alexwan"</span>,      <span class="comment">// 用户名称</span></span><br><span class="line">    <span class="string">"avatar"</span>:     <span class="string">"http://res.cloudinary.com/dmfz9aun7/image/upload/v1467081842/android/3397490934332211.jpg"</span>,</span><br><span class="line">    <span class="string">"danmakuid"</span>:  <span class="number">90</span>              <span class="comment">// 弹幕id</span></span><br><span class="line">&#125;, </span><br><span class="line">...</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<p>（1）定义弹幕JavaBean<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DanmakuData</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> time;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> type;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> fontSize;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> fontColor;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> userId;</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="keyword">private</span> String avatar;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> danmakuId;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>（2）实现<a href="https://github.com/Bilibili/DanmakuFlameMaster/blob/master/DanmakuFlameMaster/src/main/java/master/flame/danmaku/danmaku/parser/IDataSource.java" target="_blank" rel="external">IDataSource</a>，定义弹幕数据源（参考<a href="https://github.com/Bilibili/DanmakuFlameMaster/blob/master/DanmakuFlameMaster/src/main/java/master/flame/danmaku/danmaku/parser/android/JSONSource.java" target="_blank" rel="external">JSONSource</a>），加载指定数据源的弹幕数据。在<a href="https://github.com/Bilibili/DanmakuFlameMaster/blob/master/DanmakuFlameMaster/src/main/java/master/flame/danmaku/danmaku/loader/ILoader.java" target="_blank" rel="external">ILoader</a>子类中初始化。<br><figure class="highlight java"><figcaption><span>DanmakuSource.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DanmakuSource</span> <span class="keyword">implements</span> <span class="title">IDataSource</span>&lt;<span class="title">String</span>&gt; </span><br><span class="line">...</span><br><span class="line"><span class="title">private</span> <span class="title">String</span> <span class="title">mJson</span></span>;</span><br><span class="line"><span class="keyword">private</span> InputStream mInput;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">DanmakuSource</span><span class="params">(String json)</span> <span class="keyword">throws</span> JSONException</span>&#123;...&#125;                      <span class="comment">// 指定json字符串</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">DanmakuSource</span><span class="params">(InputStream in)</span> <span class="keyword">throws</span> JSONException</span>&#123;...&#125;                   <span class="comment">// 指定json数据流</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">DanmakuSource</span><span class="params">(URL url)</span> <span class="keyword">throws</span> JSONException, IOException</span>&#123;...&#125;             <span class="comment">// 指定URL源json</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">DanmakuSource</span><span class="params">(File file)</span> <span class="keyword">throws</span> FileNotFoundException, JSONException</span>&#123;...&#125; <span class="comment">// 指定file源json</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">DanmakuSource</span><span class="params">(Uri uri)</span> <span class="keyword">throws</span> IOException, JSONException</span>&#123;...&#125;             <span class="comment">// 指定Uri源json</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(InputStream in)</span> <span class="keyword">throws</span> JSONException </span><br><span class="line">...</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(String json)</span> <span class="keyword">throws</span> JSONException </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!TextUtils.isEmpty(json)) &#123;</span><br><span class="line">        <span class="comment">// 初始化json</span></span><br><span class="line">        mJson = json;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">data</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> mJson;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>（3）实现<a href="https://github.com/Bilibili/DanmakuFlameMaster/blob/master/DanmakuFlameMaster/src/main/java/master/flame/danmaku/danmaku/loader/ILoader.java" target="_blank" rel="external">ILoader</a>，执行<code>IDataSource</code>的初始化管理操作。XML格式弹幕直接使用<a href="https://github.com/Bilibili/DanmakuFlameMaster/blob/master/DanmakuFlameMaster/src/main/java/master/flame/danmaku/danmaku/loader/android/BiliDanmakuLoader.java" target="_blank" rel="external">BiliDanmakuLoader</a>加载，JSON格式弹幕可以使用<a href="https://github.com/Bilibili/DanmakuFlameMaster/blob/master/DanmakuFlameMaster/src/main/java/master/flame/danmaku/danmaku/loader/android/AcFunDanmakuLoader.java" target="_blank" rel="external">AcFunDanmakuLoader</a>用<code>JSONSource</code>来加载弹幕数据。也可以自定义实现弹幕加载方式。<br><figure class="highlight java"><figcaption><span>SimpleDanmakuLoader.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleDanmakuLoader</span> <span class="keyword">implements</span> <span class="title">ILoader</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SimpleDanmakuLoader</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> SimpleDanmakuLoader instance;</span><br><span class="line">    <span class="keyword">private</span> IDataSource&lt;String&gt; mDataSource;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//  这里使用单例保证加载器只会被实例化一次</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ILoader <span class="title">instance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (SimpleDanmakuLoader.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> SimpleDanmakuLoader();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IDataSource&lt;String&gt; <span class="title">getDataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mDataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span><br><span class="line">    * 加载Uri类型弹幕数据</span><br><span class="line">    */</span></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">load</span><span class="params">(String uri)</span> <span class="keyword">throws</span> IllegalDataException </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">             mDataSource = <span class="keyword">new</span> DanmakuSource(UriUtil.parseUriOrNull(uri));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalDataException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">    * 加载流数据弹幕</span><br><span class="line">    */</span></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">load</span><span class="params">(InputStream in)</span> <span class="keyword">throws</span> IllegalDataException </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            mDataSource = <span class="keyword">new</span> DanmakuSource(in);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JSONException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalDataException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><code>SimpleDanmakuLoader</code>创建<code>DanmakuSource</code>来获取弹幕内容。在初始化弹幕数据解析器时，调用<code>load</code>方法获取弹幕数据。</p>
<p>（4）定义弹幕解析类，继承<a href="https://github.com/Bilibili/DanmakuFlameMaster/blob/master/DanmakuFlameMaster/src/main/java/master/flame/danmaku/danmaku/parser/BaseDanmakuParser.java" target="_blank" rel="external">BaseDanmakuParser</a>创建自定义的弹幕解析类。<br><figure class="highlight java"><figcaption><span>SimpleDanmakuParser.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleDanmakuParser</span> <span class="keyword">extends</span> <span class="title">BaseDanmakuParser</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = SimpleDanmakuParser.class.getSimpleName();</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> IDanmakus <span class="title">parse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(mDataSource != <span class="keyword">null</span> &amp;&amp; mDataSource <span class="keyword">instanceof</span> DanmakuSource)&#123;</span><br><span class="line">            DanmakuSource source = (DanmakuSource) mDataSource;</span><br><span class="line">            <span class="keyword">return</span> doParse(source.data());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Danmakus();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Danmakus <span class="title">doParse</span><span class="params">(String json)</span></span>&#123;</span><br><span class="line">        Danmakus danmakus = <span class="keyword">new</span> Danmakus();</span><br><span class="line">        <span class="keyword">if</span>(TextUtils.isEmpty(json))&#123;</span><br><span class="line">            <span class="keyword">return</span> danmakus;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 使用Gson解析弹幕json数据</span></span><br><span class="line">        Type type = <span class="keyword">new</span> TypeToken&lt;List&lt;DanmakuData&gt;&gt;()&#123;&#125;.getType();</span><br><span class="line">        List&lt;DanmakuData&gt; list = <span class="keyword">new</span> Gson().fromJson(json , type);</span><br><span class="line">        <span class="keyword">int</span> size = list.size();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; size; i ++)&#123;</span><br><span class="line">            danmakus = parse(list.get(i) , danmakus , i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> danmakus;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 解析弹幕数据,组装BaseDanmaku</span><br><span class="line">     * <span class="doctag">@param</span> data DanmakuData</span><br><span class="line">     * <span class="doctag">@param</span> danmakus Danmakus</span><br><span class="line">     * <span class="doctag">@param</span> index index</span><br><span class="line">     * <span class="doctag">@return</span> Danmakus</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Danmakus <span class="title">parse</span><span class="params">(DanmakuData data, Danmakus danmakus , <span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(danmakus == <span class="keyword">null</span>)&#123;</span><br><span class="line">            danmakus =  <span class="keyword">new</span> Danmakus();</span><br><span class="line">        &#125;</span><br><span class="line">        BaseDanmaku item = mContext.mDanmakuFactory.createDanmaku(data.getType() , mContext);</span><br><span class="line">        <span class="keyword">if</span>(item != <span class="keyword">null</span>)&#123;</span><br><span class="line">            item.setTime((<span class="keyword">long</span>) (data.getTime() * <span class="number">1000</span>));</span><br><span class="line">            item.textSize = data.getFontSize();</span><br><span class="line">            item.textColor = data.getFontColor() | <span class="number">0xFF000000</span> ;</span><br><span class="line">            DanmakuUtils.fillText(item , data.getContent());</span><br><span class="line">            item.index = index;</span><br><span class="line">            item.setTimer(mTimer);</span><br><span class="line">            danmakus.addItem(item);</span><br><span class="line">            Log.i(TAG , <span class="string">"parse : time = "</span> + data.getTime() * <span class="number">1000</span> + <span class="string">" ; textSize = "</span> + data.getFontSize()</span><br><span class="line">                    + <span class="string">" ; textColor = "</span> + item.textColor + <span class="string">" ; content = "</span> + item.text);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> danmakus;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>（5）配置弹幕解析器</p>
<figure class="highlight java"><figcaption><span>MainActivity.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">mParser = customParser();</span><br><span class="line">mDanmakuView.prepare(mParser, mDanmakuContext);</span><br><span class="line">...</span><br><span class="line"><span class="function"><span class="keyword">private</span> BaseDanmakuParser <span class="title">customParser</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ILoader loader = SimpleDanmakuLoader.instance();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        loader.load(<span class="string">"http://..."</span>);</span><br><span class="line">        Log.i(TAG , <span class="string">"customParser : json = "</span> + <span class="keyword">new</span> Gson().toJson(list) );</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IllegalDataException e) &#123;</span><br><span class="line">        Log.e(TAG , <span class="string">"customParser : json = "</span> + <span class="keyword">new</span> Gson().toJson(list) + <span class="string">" ; error = "</span> , e);</span><br><span class="line">    &#125;</span><br><span class="line">    BaseDanmakuParser parser = <span class="keyword">new</span> SimpleDanmakuParser();</span><br><span class="line">    IDataSource&lt;?&gt; dataSource = loader.getDataSource();</span><br><span class="line">    parser.load(dataSource);</span><br><span class="line">    <span class="keyword">return</span> parser;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://res.cloudinary.com/dmfz9aun7/image/upload/c_scale,w_556/v1474625129/android/danmaku_parser.png" alt="img"></p>
<h2 id="3-__u56FE_u6587_u6DF7_u6392_u5F39_u5E55"><a href="#3-__u56FE_u6587_u6DF7_u6392_u5F39_u5E55" class="headerlink" title="3. 图文混排弹幕"></a>3. 图文混排弹幕</h2><p>（1）单排图文<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TODO</span></span><br></pre></td></tr></table></figure></p>
<p>（2）双排图文</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TODO</span></span><br></pre></td></tr></table></figure>
<h1 id="u53C2_u8003"><a href="#u53C2_u8003" class="headerlink" title="参考"></a>参考</h1><p>1、<a href="https://github.com/Bilibili/DanmakuFlameMaster/blob/master/Sample/src/main/java/com/sample/MainActivity.java" target="_blank" rel="external">Android开源弹幕引擎·烈焰弹幕使 ～ </a><br>2、<a href="http://wangpeiyuan.cn/2016/02/24/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%BC%B9%E5%B9%95%E7%9A%84%E5%BC%80%E5%8F%91/" target="_blank" rel="external">记一次弹幕的开发</a><br>3、<a href="http://blog.csdn.net/zxq614/article/details/52622792" target="_blank" rel="external">图文弹幕的实现</a><br>4、<a href="https://github.com/Bilibili/drawee-text-view" target="_blank" rel="external">Simple drawee spannable text view based on Fresco</a></p>

            
                

            
        </div>
    </div>
    <div class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/danmaku/">danmaku</a>

            </div>
        
        <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2017/04/23/深入理解OkHttp3的Interceptors/"  data-tooltip="深入理解OkHttp3的Interceptors（1）">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2016/09/06/Android：SurfaceView基础与原理/" data-tooltip="Android：SurfaceView基础与原理">
                
                    <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions"  href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" data-tooltip="分享至Google+" href="https://plus.google.com/share?url=http://blog.alexwan1989.com/2016/09/19/Android：DFM弹幕开发之基本配置/">
                <i class="fa fa-google-plus"></i>
            </a>
        </li>
       
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" data-tooltip="分享至Twitter" href="https://twitter.com/intent/tweet?text=http://blog.alexwan1989.com/2016/09/19/Android：DFM弹幕开发之基本配置/">
                <i class="fa fa-twitter"></i>
            </a>
        </li>

         <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" data-tooltip="分享至新浪微博" href="http://www.jiathis.com/send/?webid=tsina&amp;appkey=&amp;uid=1850331&amp;url=http://blog.alexwan1989.com/2016/09/19/Android：DFM弹幕开发之基本配置/&amp;title=Android：DFM弹幕开发之基本配置">
                <i class="fa fa-weibo"></i>
            </a>
        </li>

        
            <li class="post-action">
                <a class="post-action-btn btn btn--default" href="#disqus_thread">
                    <i class="fa fa-comment-o"></i>
                </a>
            </li>
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>


        
            <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2017 alexwan. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="1">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2017/04/23/深入理解OkHttp3的Interceptors/"  data-tooltip="深入理解OkHttp3的Interceptors（1）">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2016/09/06/Android：SurfaceView基础与原理/" data-tooltip="Android：SurfaceView基础与原理">
                
                    <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions"  href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" data-tooltip="分享至Google+" href="https://plus.google.com/share?url=http://blog.alexwan1989.com/2016/09/19/Android：DFM弹幕开发之基本配置/">
                <i class="fa fa-google-plus"></i>
            </a>
        </li>
       
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" data-tooltip="分享至Twitter" href="https://twitter.com/intent/tweet?text=http://blog.alexwan1989.com/2016/09/19/Android：DFM弹幕开发之基本配置/">
                <i class="fa fa-twitter"></i>
            </a>
        </li>

         <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" data-tooltip="分享至新浪微博" href="http://www.jiathis.com/send/?webid=tsina&amp;appkey=&amp;uid=1850331&amp;url=http://blog.alexwan1989.com/2016/09/19/Android：DFM弹幕开发之基本配置/&amp;title=Android：DFM弹幕开发之基本配置">
                <i class="fa fa-weibo"></i>
            </a>
        </li>

        
            <li class="post-action">
                <a class="post-action-btn btn btn--default" href="#disqus_thread">
                    <i class="fa fa-comment-o"></i>
                </a>
            </li>
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                <div id="share-options-bar" class="share-options-bar" data-behavior="1">
    <ul class="share-options">
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=http://blog.alexwan1989.com/2016/09/19/Android：DFM弹幕开发之基本配置/">
                <i class="fa fa-google-plus"></i><span class="">Share on Google Plus</span>
            </a>
        </li>
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.alexwan1989.com/2016/09/19/Android：DFM弹幕开发之基本配置/">
                <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
            </a>
        </li>
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=http://blog.alexwan1989.com/2016/09/19/Android：DFM弹幕开发之基本配置/">
                <i class="fa fa-twitter"></i><span>Share on Twitter</span>
            </a>
        </li>
    </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
            
        </div>
        <div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <!-- use remote images as avatar-->
            <img id="about-card-picture" src="http://res.cloudinary.com/dmfz9aun7/image/upload/v1467081842/android/3397490934332211.jpg"/>
        
            <h4 id="about-card-name">alexwan</h4>
        
            <h5 id="about-card-bio"><p>无限大な梦のあとの 何もない世の中じゃ!</p>
</h5>
        
        
            <h5 id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Android Developer</p>

            </h5>
        
        
            <h5 id="about-card-location">
                <i class="fa fa-map-marker"></i>
                <br/>
                China ShangHai
            </h5>
        
    </div>
</div>

        <div id="cover" style="background-image:url('http://res.cloudinary.com/dmfz9aun7/image/upload/v1465302627/hexo/re_zero_kara_hajimeru_isekai_seikatsu_99.jpg');"></div>

    </body>
    <!--SCRIPTS-->
<script src="/assets/js/script.min.js" type="text/javascript"></script>
<!--SCRIPTS END-->

    <script type="text/javascript">
        var disqus_shortname = 'alexwan';
        (function() {
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>



</html>
