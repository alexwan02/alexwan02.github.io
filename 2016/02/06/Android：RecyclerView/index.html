
<!DOCTYPE html>
<html lang="zh">
    
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Alexwan Studio">
    <title>Android：RecyclerView - Alexwan Studio</title>
    <meta name="author" content="alexwan">
    
        <link rel="icon" href="/assets/images/https://cdn.discordapp.com/icons/102860784329052160/109fd014c718f40110c4a182f105ca71.jpg">
    
    
        <link rel="alternative" type="application/atom+xml" title="RSS" href="/atom.xml">
    
    <meta name="description" content="RecyclerView basics
一、RecylerView 介绍RecyclerView是Android5.0之后V7包中的新特性。与ListView相似，但是比ListView更灵活，支持Android 2.1版本以上。正如它的名字：当一个item隐藏的时候，隐藏的item会被再回收重用，绑定新的数据。而不是被销毁为新的item的创建新的布局。RecylerView分为6个主要组件

A">
<meta property="og:type" content="blog">
<meta property="og:title" content="Android：RecyclerView">
<meta property="og:url" content="http://blog.alexwan1989.com/2016/02/06/Android：RecyclerView/index.html">
<meta property="og:site_name" content="Alexwan Studio">
<meta property="og:description" content="RecyclerView basics
一、RecylerView 介绍RecyclerView是Android5.0之后V7包中的新特性。与ListView相似，但是比ListView更灵活，支持Android 2.1版本以上。正如它的名字：当一个item隐藏的时候，隐藏的item会被再回收重用，绑定新的数据。而不是被销毁为新的item的创建新的布局。RecylerView分为6个主要组件

A">
<meta property="og:image" content="http://res.cloudinary.com/dmfz9aun7/image/upload/v1456548610/android/recyclerview_uml.png">
<meta property="og:image" content="http://res.cloudinary.com/dmfz9aun7/image/upload/v1456548620/android/recyclerview-1.png">
<meta property="og:image" content="http://res.cloudinary.com/dmfz9aun7/image/upload/v1456548620/android/recyclerview-active.png">
<meta property="og:image" content="http://res.cloudinary.com/dmfz9aun7/image/upload/v1456548621/android/recyclerview-linear-horizontal-reversed.png">
<meta property="og:image" content="http://res.cloudinary.com/dmfz9aun7/image/upload/v1456548622/android/recyclerview-grid-3-vertical.png">
<meta property="og:image" content="http://res.cloudinary.com/dmfz9aun7/image/upload/v1456548622/android/recyclerview-grid-3-vertical-reversed.png">
<meta property="og:image" content="http://res.cloudinary.com/dmfz9aun7/image/upload/v1456548621/android/recyclerview-staggered-grid.png">
<meta property="og:image" content="http://res.cloudinary.com/dmfz9aun7/image/upload/v1456548622/android/recyclerview-selection.png">
<meta property="og:image" content="http://res.cloudinary.com/dmfz9aun7/image/upload/v1456548665/android/recyclerview-remove.gif">
<meta property="og:updated_time" content="2016-02-27T05:00:30.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android：RecyclerView">
<meta name="twitter:description" content="RecyclerView basics
一、RecylerView 介绍RecyclerView是Android5.0之后V7包中的新特性。与ListView相似，但是比ListView更灵活，支持Android 2.1版本以上。正如它的名字：当一个item隐藏的时候，隐藏的item会被再回收重用，绑定新的数据。而不是被销毁为新的item的创建新的布局。RecylerView分为6个主要组件

A">
    
    
    
        <meta property="og:image" content="/assets/images/http://res.cloudinary.com/dmfz9aun7/image/upload/v1463120953/hexo/IMG_0738.jpg"/>
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style.min.css" type="text/css">
    <!--STYLES END-->
    
    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-74386866-1']);
        _gaq.push(['_trackPageview']);
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>

</head>

    <body>
        <div id="blog">
            <header id="header" data-behavior="1">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <h1 class="header-title">
        <a class="header-title-link" href="/ ">Alexwan Studio</a>
    </h1>
    
        
            <a  class="header-right-icon st-search-show-outputs"
                href="/#search">
        
                <i class="fa fa-lg fa-search"></i>
            </a>
    
</header>
            <nav id="sidebar" data-behavior="1">
    
        <div class="sidebar-profile">
            <a href="/#about">
                
                    <!-- use remote images as avatar-->
                    <img class="sidebar-profile-picture" src="http://res.cloudinary.com/dmfz9aun7/image/upload/v1463120953/hexo/IMG_0738.jpg"/>
                
            </a>
            <span class="sidebar-profile-name">alexwan</span>
        </div>
    
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/ "
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-home"></i>
                    <span class="sidebar-button-desc">主页</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-categories"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
                    <span class="sidebar-button-desc">分类</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-tags"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                    <span class="sidebar-button-desc">标签</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-archives"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-bars"></i>
                    <span class="sidebar-button-desc">归档</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link st-search-show-outputs"
                         href="/#search"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-search"></i>
                    <span class="sidebar-button-desc">搜索</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/#about"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-question"></i>
                    <span class="sidebar-button-desc">关于</span>
                </a>
        </li>
        
    </ul>
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="https://github.com/alexwan1989" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-github-square"></i>
                    <span class="sidebar-button-desc">GitHub</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="http://stackoverflow.com/users/4919743/alexwan1989" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-stack-overflow"></i>
                    <span class="sidebar-button-desc">Stack Overflow</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/alexwan1989@163.com"
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-envelope-o"></i>
                    <span class="sidebar-button-desc">Mail</span>
                </a>
        </li>
        
    </ul>
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/atom.xml"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
                    <span class="sidebar-button-desc">RSS</span>
                </a>
        </li>
        
    </ul>
    
</nav>

            
            <div id="main" data-behavior="1"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post" itemscope itemType="http://schema.org/BlogPosting">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title" itemprop="headline">
            Android：RecyclerView
        </h1>
    
    <div class="post-meta">
    <time itemprop="datePublished" content="Sat Feb 06 2016 06:47:38 GMT+0800">
	
		    Feb 06, 2016
    	
    </time>
    
</div>
</div>
    
    <div class="post-content markdown" itemprop="articleBody">
        <div class="main-content-wrap">
            <p><a href="http://enoent.fr/blog/2015/01/18/recyclerview-basics/" target="_blank" rel="external">RecyclerView basics</a></p>
<h3 id="u4E00_u3001RecylerView__u4ECB_u7ECD"><a href="#u4E00_u3001RecylerView__u4ECB_u7ECD" class="headerlink" title="一、RecylerView 介绍"></a>一、RecylerView 介绍</h3><p><code>RecyclerView</code>是Android5.0之后V7包中的新特性。与<code>ListView</code>相似，但是比<code>ListView</code>更灵活，支持Android 2.1版本以上。<br>正如它的名字：当一个item隐藏的时候，隐藏的item会被再回收重用，绑定新的数据。而不是被销毁为新的item的创建新的布局。<br>RecylerView分为6个主要组件</p>
<ol>
<li><code>Adapter</code>：提供数据，类似<code>ListView</code>的</li>
<li><code>ItemAnimator</code>：item的添加、删除、修改、移动的动画效果</li>
<li><code>ItemDecoration</code>：添加图画或修改Item布局</li>
<li><code>LayoutManager</code>：指定Item如何布局（List、Grid…）</li>
<li><code>ViewHolder</code>：每个Item View的基础类</li>
<li><code>RecylerView</code>：将所有的组件绑定</li>
</ol>
<div style="text-align:center"><br>    <img src="http://res.cloudinary.com/dmfz9aun7/image/upload/v1456548610/android/recyclerview_uml.png" style="width:80%;"><br></div>

<h3 id="u4E8C_u3001RecyclerView_u5C55_u793A"><a href="#u4E8C_u3001RecyclerView_u5C55_u793A" class="headerlink" title="二、RecyclerView展示"></a>二、RecyclerView展示</h3><h4 id="1-_u51C6_u5907"><a href="#1-_u51C6_u5907" class="headerlink" title="1.准备"></a>1.准备</h4><p>Gradle添加 <code>RecyclerView</code>的supprt-v7包依赖<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile <span class="string">'com.android.support:recyclerview-v7:21.0.3'</span></span><br></pre></td></tr></table></figure></p>
<p>本篇文章也使用<code>CardViews</code>，因此建议添加对应的依赖<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile <span class="string">'com.android.support:cardview-v7:21.0.3'</span></span><br></pre></td></tr></table></figure></p>
<h4 id="2-BaseItem"><a href="#2-BaseItem" class="headerlink" title="2.BaseItem"></a>2.BaseItem</h4><p><code>BaseItem</code> 包含一个<code>title</code> 和一个<code>subtitle</code>属性。用来表示列表中每个<code>item</code><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Item</span></span>&#123;</span><br><span class="line">  <span class="keyword">private</span> String title;</span><br><span class="line">  <span class="keyword">private</span> String subtitle;</span><br><span class="line">  Item(String title , String subtitle)&#123;</span><br><span class="line">    <span class="keyword">this</span>.title = title;</span><br><span class="line">    <span class="keyword">this</span>.subtitle = subtitle;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getTitle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> title;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getSubtitle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> subtitle;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="3-Item_Layout"><a href="#3-Item_Layout" class="headerlink" title="3.Item Layout"></a>3.Item Layout</h4><p>使用<code>CardView</code>作为Item的展示Layout。<code>CardView</code>是具有装饰的<code>FrameLayout</code>。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">android.support.v7.widget.CardView</span></span><br><span class="line">  <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">  <span class="attribute">xmlns:app</span>=<span class="value">"http://schemas.android.com/apk/res-auto"</span></span><br><span class="line">  <span class="attribute">android:layout_width</span>=<span class="value">"match_parent</span><br><span class="line">  android:layout_height="</span><span class="value">match_parent"</span></span><br><span class="line">  <span class="attribute">app:contentPadding</span>=<span class="value">"8dp"</span></span><br><span class="line">  <span class="attribute">app:cardUseCompatPadding</span>=<span class="value">"true"</span> &gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="title">LinearLayout</span></span><br><span class="line">      <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">      <span class="attribute">android:layout_height</span>=<span class="value">"match_parent"</span></span><br><span class="line">      <span class="attribute">android:orientation</span>=<span class="value">"vertical"</span> &gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="title">TextView</span></span><br><span class="line">          <span class="attribute">android:id</span>=<span class="value">"@+id/title"</span></span><br><span class="line">          <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">          <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span></span><br><span class="line">          <span class="attribute">android:singleLine</span>=<span class="value">"true"</span></span><br><span class="line">          <span class="attribute">style</span>=<span class="value">"@style/Base.TextAppearance.AppCompat.Headline"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="title">TextView</span></span><br><span class="line">          <span class="attribute">android:id</span>=<span class="value">"@+id/subtitle"</span></span><br><span class="line">          <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">          <span class="attribute">android:layout_height</span>=<span class="value">"0dp"</span></span><br><span class="line">          <span class="attribute">android:layout_weight</span>=<span class="value">"1"</span></span><br><span class="line">          <span class="attribute">style</span>=<span class="value">"@style/Base.TextAppearance.AppCompat.Subhead"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="title">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">android.support.v7.widget.CardView</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h4 id="4-adapter"><a href="#4-adapter" class="headerlink" title="4.adapter"></a>4.adapter</h4><ol>
<li><p>定义<code>ViewHolder</code>类，必须继承<code>RecyclerView.ViewHolder</code>。同时需要存储绑定数据时需要使用到的View的对象。<br>例子中我们需要两个TextView</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">Adapter</span>.<span class="title">ViewHolder</span>&gt; </span>&#123;</span><br><span class="line">  <span class="annotation">@SuppressWarnings</span>(<span class="string">"unused"</span>)</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = Adapter.class.getSimpleName();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewHolder</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span> </span>&#123;</span><br><span class="line">    TextView title;</span><br><span class="line">    TextView subtitle;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ViewHolder</span><span class="params">(View itemView)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(itemView);</span><br><span class="line"></span><br><span class="line">        title = (TextView) itemView.findViewById(R.id.title);</span><br><span class="line">        subtitle = (TextView) itemView.findViewById(R.id.subtitle);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用<code>Collection</code>存储对象的集合，简单起见，例子中使用<code>ArrayList</code>来存储列表数据。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">Adapter</span>.<span class="title">ViewHolder</span>&gt; </span>&#123;</span><br><span class="line">  <span class="annotation">@SuppressWarnings</span>(<span class="string">"unused"</span>)</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = Adapter.class.getSimpleName();</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ITEM_COUNT = <span class="number">50</span>;</span><br><span class="line">  <span class="keyword">private</span> List&lt;Item&gt; items;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Adapter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建item的列表</span></span><br><span class="line">    items = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ITEM_COUNT; ++i) &#123;</span><br><span class="line">        items.add(<span class="keyword">new</span> Item(<span class="string">"Item "</span> + i, <span class="string">"This is the item number "</span> + i));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 省略ViewHolder的定义</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>实现<code>RecyclerView.Adapter</code>的方法。</p>
</li>
</ol>
<ul>
<li><p>onCreateViewHolder(ViewGroup parent, int viewType) </p>
<p>  创建View，返回匹配的ViewHolder</p>
</li>
<li><p>onBindViewHolder(ViewHolder holder, int position) </p>
<p>  根据Item的position，给ViewHolder绑定数据</p>
</li>
<li><p>getItemCount()</p>
<p>  返回Adapter的item的数量</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">Adapter</span>.<span class="title">ViewHolder</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// Attributes and constructor omitted</span></span><br><span class="line"></span><br><span class="line">  <span class="annotation">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> ViewHolder <span class="title">onCreateViewHolder</span><span class="params">(ViewGroup parent, <span class="keyword">int</span> viewType)</span> </span>&#123;</span><br><span class="line">    View v = LayoutInflater.from(parent.getContext()).inflate(R.layout.item, parent, <span class="keyword">false</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ViewHolder(v);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="annotation">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(ViewHolder holder, <span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Item item = items.get(position);</span><br><span class="line"></span><br><span class="line">    holder.title.setText(item.getTitle());</span><br><span class="line">    holder.subtitle.setText(item.getSubtitle());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="annotation">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> items.size();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 省略ViewHolder的定义</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="5-_Bind_everything_together"><a href="#5-_Bind_everything_together" class="headerlink" title="5. Bind everything together"></a>5. Bind everything together</h4><ol>
<li><p>在Activity的布局文件中添加<code>RecyclerView</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;RelativeLayout</span><br><span class="line">  xmlns:android="http://schemas.android.com/apk/res/android"</span><br><span class="line">  xmlns:tools="http://schemas.android.com/tools"</span><br><span class="line">  android:layout_width="match_parent"</span><br><span class="line">  android:layout_height="match_parent"</span><br><span class="line">  tools:context=".MainActivity" &gt;</span><br><span class="line"></span><br><span class="line">  &lt;android.support.v7.widget.RecyclerView</span><br><span class="line">    android:id="@+id/recycler_view"</span><br><span class="line">    android:layout_width="match_parent"</span><br><span class="line">    android:layout_height="match_parent" /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/RelativeLayout&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用<code>LinearLayoutManager</code>，<code>DefaultItemAnimator</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">ActionBarActivity</span> </span>&#123;</span><br><span class="line">  <span class="annotation">@SuppressWarnings</span>(<span class="string">"unused"</span>)</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = MainActivity.class.getSimpleName();</span><br><span class="line"></span><br><span class="line">  <span class="annotation">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">    RecyclerView recyclerView = (RecyclerView) findViewById(R.id.recycler_view);</span><br><span class="line">    recyclerView.setAdapter(<span class="keyword">new</span> Adapter());</span><br><span class="line">    recyclerView.setItemAnimator(<span class="keyword">new</span> DefaultItemAnimator());</span><br><span class="line">    recyclerView.setLayoutManager(<span class="keyword">new</span> LinearLayoutManager(<span class="keyword">this</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>编译、运行</p>
</li>
</ol>
<div style="text-align:center"><br>    <img src="http://res.cloudinary.com/dmfz9aun7/image/upload/v1456548620/android/recyclerview-1.png" style="width:35%;"><br></div>

<h3 id="u4E09_u3001_u76F8_u540CRecyclerView_u663E_u793A_u4E0D_u540C_u7C7B_u578B_u7684View"><a href="#u4E09_u3001_u76F8_u540CRecyclerView_u663E_u793A_u4E0D_u540C_u7C7B_u578B_u7684View" class="headerlink" title="三、相同RecyclerView显示不同类型的View"></a>三、相同RecyclerView显示不同类型的View</h3><p>假设现在要显示两种类型的Item。如一个远程音乐的列表和一些离线的专辑。可以为他们指定行为，显示指定的信息。</p>
<ol>
<li><p>在Item中添加<code>active</code>属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Item</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> String title;</span><br><span class="line">  <span class="keyword">private</span> String subtitle;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">boolean</span> active;</span><br><span class="line"></span><br><span class="line">  Item(String title, String subtitle, <span class="keyword">boolean</span> active) &#123;</span><br><span class="line">    <span class="keyword">this</span>.title = title;</span><br><span class="line">    <span class="keyword">this</span>.subtitle = subtitle;</span><br><span class="line">    <span class="keyword">this</span>.active = active;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getTitle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> title;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getSubtitle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> subtitle;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isActive</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> active;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改创建Item的方法，随机设定Item的<code>active</code>值，根据<code>active</code>来改变subtitle状态</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">Adapter</span>.<span class="title">ViewHolder</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// 忽略参数</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Adapter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建Item</span></span><br><span class="line">        Random random = <span class="keyword">new</span> Random();</span><br><span class="line">        items = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ITEM_COUNT; ++i) &#123;</span><br><span class="line">            items.add(<span class="keyword">new</span> Item(<span class="string">"Item "</span> + i, <span class="string">"This is the item number "</span> + i, random.nextBoolean()));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 忽略onCreateViewHolder</span></span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(ViewHolder holder, <span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> Item item = items.get(position);</span><br><span class="line"></span><br><span class="line">        holder.title.setText(item.getTitle());</span><br><span class="line">        holder.subtitle.setText(item.getSubtitle() + <span class="string">", which is "</span> +</span><br><span class="line">                (item.isActive() ? <span class="string">"active"</span> : <span class="string">"inactive"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// …</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>学会显示不同String是个好的开始，但是我们不仅仅要满足于此。在Adapter中你可能会注意到<code>onCreateViewHolder(ViewGroup parent, int viewType)</code>中的viewType我们没有使用。这里的<code>viewType</code>可以用来实现这样的需求：修改ViewHolder的实例。我们必须告诉<code>Adapter</code>来确定Item的类型。通过复写<code>getItemViewType(int position)</code>方法实现。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">Adapter</span>.<span class="title">ViewHolder</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// …</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TYPE_INACTIVE = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TYPE_ACTIVE = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// …</span></span><br><span class="line"></span><br><span class="line">  <span class="annotation">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemViewType</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Item item = items.get(position);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> item.isActive() ? TYPE_ACTIVE : TYPE_INACTIVE;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// …</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>现在根据你的需求有多种可能：为每种类型的View创建不同的<code>ViewHolder</code>或为相同的<code>ViewHolder</code> inflate 不同的Layout。简单起见，这里使用相同的<code>ViewHolder</code> inflate 不同的Layout。我们对<code>inactive</code>的Item继续使用现在的Layout，对<code>active</code>的Item创建一个新的Layout</p>
</li>
</ol>
<figure class="highlight xml"><figcaption><span>layout/item_active.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">android.support.v7.widget.CardView</span></span><br><span class="line">    <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    <span class="attribute">xmlns:app</span>=<span class="value">"http://schemas.android.com/apk/res-auto"</span></span><br><span class="line">    <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"match_parent"</span></span><br><span class="line">    <span class="attribute">app:contentPadding</span>=<span class="value">"8dp"</span></span><br><span class="line">    <span class="attribute">app:cardUseCompatPadding</span>=<span class="value">"true"</span> &gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">LinearLayout</span></span><br><span class="line">        <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">        <span class="attribute">android:layout_height</span>=<span class="value">"match_parent"</span></span><br><span class="line">        <span class="attribute">android:orientation</span>=<span class="value">"vertical"</span> &gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="title">TextView</span></span><br><span class="line">            <span class="attribute">android:id</span>=<span class="value">"@+id/title"</span></span><br><span class="line">            <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">            <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span></span><br><span class="line">            <span class="attribute">android:singleLine</span>=<span class="value">"true"</span></span><br><span class="line">            <span class="attribute">android:textColor</span>=<span class="value">"@color/material_deep_teal_500"</span></span><br><span class="line">            <span class="attribute">style</span>=<span class="value">"@style/Base.TextAppearance.AppCompat.Headline"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="title">TextView</span></span><br><span class="line">            <span class="attribute">android:id</span>=<span class="value">"@+id/subtitle"</span></span><br><span class="line">            <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">            <span class="attribute">android:layout_height</span>=<span class="value">"0dp"</span></span><br><span class="line">            <span class="attribute">android:layout_weight</span>=<span class="value">"1"</span></span><br><span class="line">            <span class="attribute">android:textColor</span>=<span class="value">"@color/material_blue_grey_900"</span></span><br><span class="line">            <span class="attribute">style</span>=<span class="value">"@style/Base.TextAppearance.AppCompat.Subhead"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="title">LinearLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">android.support.v7.widget.CardView</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol>
<li>最后也是最重要：在<code>onCreateViewHolder</code>方法中根据<code>viewType</code>值Inflate不同的Layout</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">Adapter</span>.<span class="title">ViewHolder</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// …</span></span><br><span class="line"></span><br><span class="line">  <span class="annotation">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> ViewHolder <span class="title">onCreateViewHolder</span><span class="params">(ViewGroup parent, <span class="keyword">int</span> viewType)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> layout = viewType == TYPE_INACTIVE ? R.layout.item : R.layout.item_active;</span><br><span class="line"></span><br><span class="line">    View v = LayoutInflater.from(parent.getContext()).inflate(layout, parent, <span class="keyword">false</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ViewHolder(v);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// …</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在我们可以区分<code>active</code>和<code>inactive</code> Item了</p>
<div style="text-align:center"><br>    <img src="http://res.cloudinary.com/dmfz9aun7/image/upload/v1456548620/android/recyclerview-active.png" style="width:35%;"><br></div>

<h3 id="u56DB_u3001Layout_managers"><a href="#u56DB_u3001Layout_managers" class="headerlink" title="四、Layout managers"></a>四、Layout managers</h3><h4 id="1-LinearLayoutManager"><a href="#1-LinearLayoutManager" class="headerlink" title="1.LinearLayoutManager"></a>1.LinearLayoutManager</h4><p>这个也是上面我们用的Manager，复制了<code>ListView</code>的特性。<code>Layout managers</code>占用三个参数</p>
<ul>
<li><code>Context</code> 不能为空  </li>
<li><code>int orientation</code> vertical（默认值）、horizontal</li>
<li><code>boolean reverseLayout</code> 是否反转Layout</li>
</ul>
<p>下面是<code>反转</code> <code>水平方向</code>的LinearLayoutManager</p>
<div style="text-align:center"><br>    <img src="http://res.cloudinary.com/dmfz9aun7/image/upload/v1456548621/android/recyclerview-linear-horizontal-reversed.png" style="width:35%;"><br></div>

<p>设置反转Layout时显示最右边无需滑动</p>
<h4 id="2-GridLayoutManager"><a href="#2-GridLayoutManager" class="headerlink" title="2.GridLayoutManager"></a>2.GridLayoutManager</h4><p>类似<code>GridView</code>。占用四个参数</p>
<ul>
<li><code>Context</code> 非空</li>
<li><code>int spanCount</code> 非空</li>
<li><code>int orientation</code> vertical（默认值）、horizontal</li>
<li><code>boolean reverseLayout</code> 是否反转Layout</li>
</ul>
<p>下面是<code>spanCount</code>为3，<code>vertical</code>方向，<code>非反转</code>的GridLayoutManager</p>
<div style="text-align:center"><br>    <img src="http://res.cloudinary.com/dmfz9aun7/image/upload/v1456548622/android/recyclerview-grid-3-vertical.png" style="width:35%;"><br></div>

<p><code>注意</code>：GridLayoutManager的<code>reverseLayout</code>属性只反转设定的反向。如设置orientation为<code>vertical</code>时，只垂直反转，水平方向不变。</p>
<div style="text-align:center"><br>    <img src="http://res.cloudinary.com/dmfz9aun7/image/upload/v1456548622/android/recyclerview-grid-3-vertical-reversed.png" style="width:35%;"><br></div>

<h4 id="3-StaggeredGridLayoutManager"><a href="#3-StaggeredGridLayoutManager" class="headerlink" title="3.StaggeredGridLayoutManager"></a>3.StaggeredGridLayoutManager</h4><p>StaggeredGridLayoutManager是<code>GridLayoutManager</code>的加强版。截止到<code>support-v7 21.0.0.3</code>版本的包中，StaggeredGridLayoutManager仍然还有很多<a href="https://code.google.com/p/android/issues/detail?id=93711" target="_blank" rel="external">bug</a>和<a href="https://code.google.com/p/android/issues/detail?id=93156" target="_blank" rel="external">困扰的问题</a>。和其他几种LayoutManager相比，<code>StaggeredGridLayoutManager</code>看上去像是匆忙完成的。同时需要注意的是它不需要<code>Context</code>，但是<code>orientation</code> 不能省略。同<code>GridLayoutManager</code>一样，需要指定<code>span</code>的数量。构造器中不提供<code>reverse</code> 参数，可以用代码来实现。<br>下面是固定Span的Grid，我们可以让Item占用整行或整列。让我们看看如何实现。用之前例子中创建的 <code>active/inactive</code>属性的item list，让<code>active</code>属性的item占满整行。在<code>adapter</code> 绑定数据的时候，来实现。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">Adapter</span>.<span class="title">ViewHolder</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// …</span></span><br><span class="line">  <span class="annotation">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(ViewHolder holder, <span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Item item = items.get(position);</span><br><span class="line"></span><br><span class="line">    holder.title.setText(item.getTitle());</span><br><span class="line">    holder.subtitle.setText(item.getSubtitle() + <span class="string">", which is "</span> + (item.isActive() ? <span class="string">"active"</span> : <span class="string">"inactive"</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Span the item if active</span></span><br><span class="line">    <span class="keyword">final</span> ViewGroup.LayoutParams lp = holder.itemView.getLayoutParams();</span><br><span class="line">    <span class="keyword">if</span> (lp <span class="keyword">instanceof</span> StaggeredGridLayoutManager.LayoutParams) &#123;</span><br><span class="line">        StaggeredGridLayoutManager.LayoutParams sglp = (StaggeredGridLayoutManager.LayoutParams) lp;</span><br><span class="line">        sglp.setFullSpan(item.isActive());</span><br><span class="line">        holder.itemView.setLayoutParams(sglp);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// …</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在代码判断如果LayoutManager是StaggeredGridLayoutManager的实例，来修改Layout参数。效果如图</p>
<div style="text-align:center"><br>    <img src="http://res.cloudinary.com/dmfz9aun7/image/upload/v1456548621/android/recyclerview-staggered-grid.png" style="width:35%;"><br></div>

<h3 id="u4E94_u3001Item_u70B9_u51FB_u54CD_u5E94"><a href="#u4E94_u3001Item_u70B9_u51FB_u54CD_u5E94" class="headerlink" title="五、Item点击响应"></a>五、Item点击响应</h3><p>与ListView 不同的是RecyclerView没有提供相关的点击响应事件的API，但是依然很容易来实现。现在我们需要监听每个Item的<code>click</code>和<code>long-click</code>事件.每个Item是由<code>ViewHolder</code>来显示的，每个<code>ViewHolder</code>是由根<code>View</code> 来初始化的。OK，用<code>View</code>来作为<code>click</code>和<code>long-click</code>事件的回调。最后只需要把<code>ViewHolder</code>和它的position对应起来即可，<code>RecyclerView.ViewHolder</code>已经提供对应的方法<del>getPosition()</del> ( getPosition() 方法废弃, 根据你的情况用<code>getLayoutPosition()</code> 或 <code>getAdapterPosition()</code>来替代 )来获取当前绑定的Item的postion<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">Adapter</span>.<span class="title">ViewHolder</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// …</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewHolder</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span>,</span><br><span class="line">        <span class="title">View</span>.<span class="title">OnLongClickListener</span> </span>&#123;</span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(<span class="string">"unused"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = ViewHolder.class.getSimpleName();</span><br><span class="line"></span><br><span class="line">    TextView title;</span><br><span class="line">    TextView subtitle;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ViewHolder</span><span class="params">(View itemView)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">super</span>(itemView);</span><br><span class="line"></span><br><span class="line">      title = (TextView) itemView.findViewById(R.id.title);</span><br><span class="line">      subtitle = (TextView) itemView.findViewById(R.id.subtitle);</span><br><span class="line"></span><br><span class="line">      itemView.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">      itemView.setOnLongClickListener(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">      Log.d(TAG, <span class="string">"Item clicked at position "</span> + getPosition());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onLongClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">      Log.d(TAG, <span class="string">"Item long-clicked at position "</span> + getPosition());</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="u516D_u3001_u9009_u62E9_u5904_u7406"><a href="#u516D_u3001_u9009_u62E9_u5904_u7406" class="headerlink" title="六、选择处理"></a>六、选择处理</h3><p><code>long-click</code>事件一个常用的模式是触发选择模式。再一次，<code>RecyclerView</code>没有帮助我们实现，但是实现起来也很简单。<br>分为三步</p>
<ul>
<li>维护一个选择状态</li>
<li>更新选中的Item的View</li>
<li>开启选择模式</li>
</ul>
<p>为了说明，我们添加一个选择Item的方式，然后移除选中的Item。</p>
<h4 id="1-_u9009_u62E9_u72B6_u6001"><a href="#1-_u9009_u62E9_u72B6_u6001" class="headerlink" title="1.选择状态"></a>1.选择状态</h4><p>我们需要修改<code>Adapter</code>来维护一个选中的item list。<code>Adapter</code>需要提供一下列表参数</p>
<ul>
<li>选中的元素列表</li>
<li>改变给定元素的选择状态</li>
</ul>
<p>我们加入额外的方法几个方法：</p>
<ul>
<li>检查指定的元素是否被选中</li>
<li>清空选中</li>
<li>提供选中元素的数量</li>
</ul>
<p>这里并不是随便选择这些方法，在下个部分我们需要它们。<br>我们注意到这五个方法都不是特定的Item，我们可以用普通方式写这些方法并重用<code>Adapter</code>的行为。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">SelectableAdapter</span>&lt;<span class="title">VH</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span>&gt; <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">VH</span>&gt; </span>&#123;</span><br><span class="line">  <span class="annotation">@SuppressWarnings</span>(<span class="string">"unused"</span>)</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = SelectableAdapter.class.getSimpleName();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> SparseBooleanArray selectedItems;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">SelectableAdapter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    selectedItems = <span class="keyword">new</span> SparseBooleanArray();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * 指定对应位置的Item是否被选中</span><br><span class="line">   * <span class="doctag">@param</span> Item的position</span><br><span class="line">   * <span class="doctag">@return</span> 如果是选中返回true，否则返回false</span><br><span class="line">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSelected</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> getSelectedItems().contains(position);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * 给定postion的Item的选中状态触发器</span><br><span class="line">   * <span class="doctag">@param</span> position item 的 postion</span><br><span class="line">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">toggleSelection</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (selectedItems.get(position, <span class="keyword">false</span>)) &#123;</span><br><span class="line">      selectedItems.delete(position);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      selectedItems.put(position, <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    notifyItemChanged(position);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * 清空所有Item的选中状态</span><br><span class="line">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clearSelection</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;Integer&gt; selection = getSelectedItems();</span><br><span class="line">    selectedItems.clear();</span><br><span class="line">    <span class="keyword">for</span> (Integer i : selection) &#123;</span><br><span class="line">      notifyItemChanged(i);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * 选中Item的数量</span><br><span class="line">   * <span class="doctag">@return</span> 选中Item的数量</span><br><span class="line">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSelectedItemCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> selectedItems.size();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * 被选中的Item的Id list</span><br><span class="line">   * <span class="doctag">@return</span> 被选中的Item的Id list</span><br><span class="line">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title">getSelectedItems</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;Integer&gt; items = <span class="keyword">new</span> ArrayList&lt;&gt;(selectedItems.size());</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; selectedItems.size(); ++i) &#123;</span><br><span class="line">      items.add(selectedItems.keyAt(i));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> items;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>最后<code>Adapter</code>继承我们创建<code>SelectableAdapter</code><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">extends</span> <span class="title">SelectableAdapter</span>&lt;<span class="title">Adapter</span>.<span class="title">ViewHolder</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// …</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="2-_u66F4_u65B0Item_u7684View"><a href="#2-_u66F4_u65B0Item_u7684View" class="headerlink" title="2.更新Item的View"></a>2.更新Item的View</h4><p>通知用户选中了一个Item，我们经常看到选中的View被覆盖某个颜色。在<code>item.xml</code>和<code>item_active.xml</code>中，我们添加一个<code>invisible</code>并带有颜色的View。因为这个View应该填充整个<code>CardView</code>，我们应该改变Layout的一些属性（将CardView的padding属性移动到LinearLayout中），View的颜色应该为透明的。<br>我们要用android Framework的<code>selectableItemBackground</code>为<code>CardView</code>的foreground设定属性值，来添加一个好看的触摸反馈。在Android 5.0以及以上，显示涟漪的效果，Android 5.0以下版本显示灰色。</p>
<figure class="highlight xml"><figcaption><span>item.xml（item_active.xml做对应的修改）</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">android.support.v7.widget.CardView</span></span><br><span class="line">    <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    <span class="attribute">xmlns:app</span>=<span class="value">"http://schemas.android.com/apk/res-auto"</span></span><br><span class="line">    <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"match_parent"</span></span><br><span class="line">    <span class="attribute">android:foreground</span>=<span class="value">"?android:attr/selectableItemBackground"</span></span><br><span class="line">    <span class="attribute">app:cardUseCompatPadding</span>=<span class="value">"true"</span> &gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">LinearLayout</span></span><br><span class="line">        <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">        <span class="attribute">android:layout_height</span>=<span class="value">"match_parent"</span></span><br><span class="line">        <span class="attribute">android:orientation</span>=<span class="value">"vertical"</span></span><br><span class="line">        <span class="attribute">android:padding</span>=<span class="value">"8dp"</span> &gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="title">TextView</span></span><br><span class="line">            <span class="attribute">android:id</span>=<span class="value">"@+id/title"</span></span><br><span class="line">            <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">            <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span></span><br><span class="line">            <span class="attribute">android:singleLine</span>=<span class="value">"true"</span></span><br><span class="line">            <span class="attribute">style</span>=<span class="value">"@style/Base.TextAppearance.AppCompat.Headline"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="title">TextView</span></span><br><span class="line">            <span class="attribute">android:id</span>=<span class="value">"@+id/subtitle"</span></span><br><span class="line">            <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">            <span class="attribute">android:layout_height</span>=<span class="value">"0dp"</span></span><br><span class="line">            <span class="attribute">android:layout_weight</span>=<span class="value">"1"</span></span><br><span class="line">            <span class="attribute">style</span>=<span class="value">"@style/Base.TextAppearance.AppCompat.Subhead"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="title">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">View</span></span><br><span class="line">        <span class="attribute">android:id</span>=<span class="value">"@+id/selected_overlay"</span></span><br><span class="line">        <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">        <span class="attribute">android:layout_height</span>=<span class="value">"match_parent"</span></span><br><span class="line">        <span class="attribute">android:background</span>=<span class="value">"@color/selected_overlay"</span></span><br><span class="line">        <span class="attribute">android:visibility</span>=<span class="value">"invisible"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">android.support.v7.widget.CardView</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>下一步决定什么时候显示这个效果，很明显需要 <code>Adapters</code>的<code>onBindViewHolder()</code>方法中。在<code>ViewHolder</code>中添加overlay view的属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">extends</span> <span class="title">SelectableAdapter</span>&lt;<span class="title">Adapter</span>.<span class="title">ViewHolder</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// …</span></span><br><span class="line"></span><br><span class="line">  <span class="annotation">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(ViewHolder holder, <span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Item item = items.get(position);</span><br><span class="line"></span><br><span class="line">    holder.title.setText(item.getTitle());</span><br><span class="line">    holder.subtitle.setText(item.getSubtitle() + <span class="string">", which is "</span> + (item.isActive() ? <span class="string">"active"</span> : <span class="string">"inactive"</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Span the item if active</span></span><br><span class="line">    <span class="keyword">final</span> ViewGroup.LayoutParams lp = holder.itemView.getLayoutParams();</span><br><span class="line">    <span class="keyword">if</span> (lp <span class="keyword">instanceof</span> StaggeredGridLayoutManager.LayoutParams) &#123;</span><br><span class="line">      StaggeredGridLayoutManager.LayoutParams sglp = (StaggeredGridLayoutManager.LayoutParams) lp;</span><br><span class="line">      sglp.setFullSpan(item.isActive());</span><br><span class="line">      holder.itemView.setLayoutParams(sglp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//  高亮选中的Item</span></span><br><span class="line">    holder.selectedOverlay.setVisibility(isSelected(position) ? View.VISIBLE : View.INVISIBLE);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// …</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewHolder</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span>,</span><br><span class="line">        <span class="title">View</span>.<span class="title">OnLongClickListener</span> </span>&#123;</span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(<span class="string">"unused"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = ViewHolder.class.getSimpleName();</span><br><span class="line"></span><br><span class="line">      TextView title;</span><br><span class="line">      TextView subtitle;</span><br><span class="line">      View selectedOverlay;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="title">ViewHolder</span><span class="params">(View itemView)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(itemView);</span><br><span class="line"></span><br><span class="line">        title = (TextView) itemView.findViewById(R.id.title);</span><br><span class="line">        subtitle = (TextView) itemView.findViewById(R.id.subtitle);</span><br><span class="line">        selectedOverlay = itemView.findViewById(R.id.selected_overlay);</span><br><span class="line"></span><br><span class="line">        itemView.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        itemView.setOnLongClickListener(<span class="keyword">this</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// …</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-_u5F00_u542F_u9009_u4E2D_u6A21_u5F0F"><a href="#3-_u5F00_u542F_u9009_u4E2D_u6A21_u5F0F" class="headerlink" title="3.开启选中模式"></a>3.开启选中模式</h4><p>最后一步可能有点复杂，但也不是很难。我们需要将<code>click</code>和<code>long-click</code>返回给<code>Activity</code>。用<code>ViewHolder</code>暴露一个<code>Listener</code>，通过<code>Adapter</code>传递它，实现需求。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">extends</span> <span class="title">SelectableAdapter</span>&lt;<span class="title">Adapter</span>.<span class="title">ViewHolder</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// …</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> ViewHolder.ClickListener clickListener;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Adapter</span><span class="params">(ViewHolder.ClickListener clickListener)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.clickListener = clickListener;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建Item</span></span><br><span class="line">    Random random = <span class="keyword">new</span> Random();</span><br><span class="line">    items = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ITEM_COUNT; ++i) &#123;</span><br><span class="line">      items.add(<span class="keyword">new</span> Item(<span class="string">"Item "</span> + i, <span class="string">"This is the item number "</span> + i, random.nextBoolean()));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="annotation">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> ViewHolder <span class="title">onCreateViewHolder</span><span class="params">(ViewGroup parent, <span class="keyword">int</span> viewType)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> layout = viewType == TYPE_INACTIVE ? R.layout.item : R.layout.item_active;</span><br><span class="line"></span><br><span class="line">    View v = LayoutInflater.from(parent.getContext()).inflate(layout, parent, <span class="keyword">false</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ViewHolder(v, clickListener);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// …</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewHolder</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span>,</span><br><span class="line">          <span class="title">View</span>.<span class="title">OnLongClickListener</span> </span>&#123;</span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(<span class="string">"unused"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = ViewHolder.class.getSimpleName();</span><br><span class="line"></span><br><span class="line">    TextView title;</span><br><span class="line">    TextView subtitle;</span><br><span class="line">    View selectedOverlay;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ClickListener listener;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ViewHolder</span><span class="params">(View itemView, ClickListener listener)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">super</span>(itemView);</span><br><span class="line"></span><br><span class="line">      title = (TextView) itemView.findViewById(R.id.title);</span><br><span class="line">      subtitle = (TextView) itemView.findViewById(R.id.subtitle);</span><br><span class="line">      selectedOverlay = itemView.findViewById(R.id.selected_overlay);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">this</span>.listener = listener;</span><br><span class="line"></span><br><span class="line">      itemView.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">      itemView.setOnLongClickListener(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (listener != <span class="keyword">null</span>) &#123;</span><br><span class="line">        listener.onItemClicked(getPosition());</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onLongClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (listener != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> listener.onItemLongClicked(getPosition());</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ClickListener</span> </span>&#123;</span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onItemClicked</span><span class="params">(<span class="keyword">int</span> position)</span></span>;</span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onItemLongClicked</span><span class="params">(<span class="keyword">int</span> position)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>我们用<code>ActionMode</code>来区分选择模式和正常模式，当选择模式被激活时显示不同的<code>ActionBar</code>。实现<code>ActionMode.Callback</code>来激活选择模式。简单起见，<code>Activity</code>使用一个内部类来实现其接口，同时实现我们我们新创建的Click接口<code>Adapter.ViewHolder.ClickListener</code>。我们需要<code>Callback</code>来访问<code>Adapter</code>，所以把<code>Adapter</code>作为<code>Activity</code>的一个属性。<br>我们的Activity看上去变得复杂了。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">ActionBarActivity</span> <span class="keyword">implements</span> <span class="title">Adapter</span>.<span class="title">ViewHolder</span>.<span class="title">ClickListener</span> </span>&#123;</span><br><span class="line">  <span class="annotation">@SuppressWarnings</span>(<span class="string">"unused"</span>)</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = MainActivity.class.getSimpleName();</span><br><span class="line">  <span class="keyword">private</span> Adapter adapter;</span><br><span class="line">  <span class="keyword">private</span> ActionModeCallback actionModeCallback = <span class="keyword">new</span> ActionModeCallback();</span><br><span class="line">  <span class="keyword">private</span> ActionMode actionMode;</span><br><span class="line"></span><br><span class="line">  <span class="annotation">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">    adapter = <span class="keyword">new</span> Adapter(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    RecyclerView recyclerView = (RecyclerView) findViewById(R.id.recycler_view);</span><br><span class="line">    recyclerView.setAdapter(adapter);</span><br><span class="line">    recyclerView.setItemAnimator(<span class="keyword">new</span> DefaultItemAnimator());</span><br><span class="line">    recyclerView.setLayoutManager(<span class="keyword">new</span> StaggeredGridLayoutManager(<span class="number">3</span>, StaggeredGridLayoutManager.VERTICAL));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="annotation">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onItemClicked</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (actionMode != <span class="keyword">null</span>) &#123;</span><br><span class="line">      toggleSelection(position);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="annotation">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onItemLongClicked</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (actionMode == <span class="keyword">null</span>) &#123;</span><br><span class="line">      actionMode = startSupportActionMode(actionModeCallback);</span><br><span class="line">    &#125;</span><br><span class="line">    toggleSelection(position);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * 触发Item的选中状态</span><br><span class="line">   *</span><br><span class="line">   * 如果选中的Item数量为0, 则关闭选中状态模式</span><br><span class="line">   * 注意：actionMode不能为空</span><br><span class="line">   *</span><br><span class="line">   * <span class="doctag">@param</span> position 触发选中状态的Item位置</span><br><span class="line">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">toggleSelection</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">    adapter.toggleSelection(position);</span><br><span class="line">    <span class="keyword">int</span> count = adapter.getSelectedItemCount();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (count == <span class="number">0</span>) &#123;</span><br><span class="line">      actionMode.finish();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      actionMode.setTitle(String.valueOf(count));</span><br><span class="line">      actionMode.invalidate();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ActionModeCallback</span> <span class="keyword">implements</span> <span class="title">ActionMode</span>.<span class="title">Callback</span> </span>&#123;</span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(<span class="string">"unused"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String TAG = ActionModeCallback.class.getSimpleName();</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onCreateActionMode</span><span class="params">(ActionMode mode, Menu menu)</span> </span>&#123;</span><br><span class="line">      mode.getMenuInflater().inflate (R.menu.selected_menu, menu);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onPrepareActionMode</span><span class="params">(ActionMode mode, Menu menu)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onActionItemClicked</span><span class="params">(ActionMode mode, MenuItem item)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">switch</span> (item.getItemId()) &#123;</span><br><span class="line">        <span class="keyword">case</span> R.id.menu_remove:</span><br><span class="line">          <span class="comment">// <span class="doctag">TODO:</span> 具体的移除Item操作</span></span><br><span class="line">          Log.d(TAG, <span class="string">"menu_remove"</span>);</span><br><span class="line">          mode.finish();</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="annotation">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroyActionMode</span><span class="params">(ActionMode mode)</span> </span>&#123;</span><br><span class="line">        adapter.clearSelection();</span><br><span class="line">        actionMode = <span class="keyword">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>下图显示<code>Item5</code>被选中时的截图</p>
<div style="text-align:center"><br>    <img src="http://res.cloudinary.com/dmfz9aun7/image/upload/v1456548622/android/recyclerview-selection.png" style="width:35%;"><br></div>

<h3 id="u4E03_u3001_u6539_u53D8_u6570_u636E"><a href="#u4E03_u3001_u6539_u53D8_u6570_u636E" class="headerlink" title="七、改变数据"></a>七、改变数据</h3><p>想要更新View，，<code>Adapter</code>必须来发出数据发生了变化的通知。在<code>ListView</code>上，adapter只有一个可以使用的方法<code>notifyDataSetChanged()</code>。然而这个方法还不很理想：需要刷新所有的View，因为我们不能够确切知道什么发生了变化。而<code>RecyclerView.Adapter</code>提供多种方法：</p>
<ul>
<li>notifyItemChanged(int position)</li>
<li>notifyItemInserted(int position)</li>
<li>notifyItemRemoved(int position)</li>
<li>notifyItemMoved(int fromPosition, int toPosition)</li>
<li>notifyItemRangeChanged(int positionStart, int itemCount)</li>
<li>notifyItemRangeInserted(int positionStart, int itemCount)</li>
<li>notifyItemRangeRemoved(int positionStart, int itemCount)</li>
<li>notifyDataSetChanged()</li>
</ul>
<p>我们可以知道Item或Items的变化、添加、移除、移动。<br>我们在<code>Adapter</code>中向外部类提供移除Item、Item List的两个<code>public</code>方法。如果直接移除一个Item，直接从列表移除即可。但是移除item list 并没有简单。举个例子，如果现在需要移除<code>[5 ,  8 , 9]</code> 三个位置的Item，当移除5位置的Item后，我们Item的list长度就会变短，因此list数据中原来的8变成了7。结果我们移除<code>[5 , 8 , 9]</code>三个位置的数据实际对应的是[5 , 7 , 7]。再考虑到一种情况如果是移除<code>[8 ， 9 ， 5]</code>三个位置的Item呢？<br>因此我们需要将提供需要移除的Item List进行逆序排序。这样我们就能简单调用<code>notifyItemRangeRemoved()</code>方法来移除item list。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">extends</span> <span class="title">SelectableAdapter</span>&lt;<span class="title">Adapter</span>.<span class="title">ViewHolder</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// …</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeItem</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">    items.remove(position);</span><br><span class="line">    notifyItemRemoved(position);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeItems</span><span class="params">(List&lt;Integer&gt; positions)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// list逆序排序</span></span><br><span class="line">    Collections.sort(positions, <span class="keyword">new</span> Comparator&lt;Integer&gt;() &#123;</span><br><span class="line">      <span class="annotation">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Integer lhs, Integer rhs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> rhs - lhs;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 拆分排列后的list</span></span><br><span class="line">    <span class="keyword">while</span> (!positions.isEmpty()) &#123;</span><br><span class="line">      <span class="keyword">if</span> (positions.size() == <span class="number">1</span>) &#123;</span><br><span class="line">        removeItem(positions.get(<span class="number">0</span>));</span><br><span class="line">        positions.remove(<span class="number">0</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (positions.size() &gt; count &amp;&amp; positions.get(count).equals(positions.get(count - <span class="number">1</span>) - <span class="number">1</span>)) &#123;</span><br><span class="line">          ++count;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (count == <span class="number">1</span>) &#123;</span><br><span class="line">          removeItem(positions.get(<span class="number">0</span>));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          removeRange(positions.get(count - <span class="number">1</span>), count);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; ++i) &#123;</span><br><span class="line">          positions.remove(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">removeRange</span><span class="params">(<span class="keyword">int</span> positionStart, <span class="keyword">int</span> itemCount)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; itemCount; ++i) &#123;</span><br><span class="line">      items.remove(positionStart);</span><br><span class="line">    &#125;</span><br><span class="line">    notifyItemRangeRemoved(positionStart, itemCount);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// …</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>最后在<code>Activity</code>中调用这两个方法，在<code>menu</code>菜单中创建<code>Remove</code>的操作。我们只需要在<code>Remove</code>菜单中调用<code>removeItems()</code>方法就可以了。我们可以在<code>click</code>中调用<code>removeItem()</code>方法来测试移除单个Item。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">ActionBarActivity</span> <span class="keyword">implements</span> <span class="title">Adapter</span>.<span class="title">ViewHolder</span>.<span class="title">ClickListener</span> </span>&#123;</span><br><span class="line">  <span class="comment">// …</span></span><br><span class="line"></span><br><span class="line">  <span class="annotation">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onItemClicked</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (actionMode != <span class="keyword">null</span>) &#123;</span><br><span class="line">      toggleSelection(position);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      adapter.removeItem(position);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// …</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ActionModeCallback</span> <span class="keyword">implements</span> <span class="title">ActionMode</span>.<span class="title">Callback</span> </span>&#123;</span><br><span class="line">    <span class="comment">// …</span></span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onActionItemClicked</span><span class="params">(ActionMode mode, MenuItem item)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">switch</span> (item.getItemId()) &#123;</span><br><span class="line">        <span class="keyword">case</span> R.id.menu_remove:</span><br><span class="line">          adapter.removeItems(adapter.getSelectedItems());</span><br><span class="line">          mode.finish();</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// …</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样我们就实现了移除Item功能了。与传统<code>notifyDataSetChanged()</code>的方法相比，我们还有额外的动画效果</p>
<div style="text-align:center"><br>    <img src="http://res.cloudinary.com/dmfz9aun7/image/upload/v1456548665/android/recyclerview-remove.gif" style="width:35%;"><br></div>

<h3 id="u516B_u3001_u603B_u7ED3"><a href="#u516B_u3001_u603B_u7ED3" class="headerlink" title="八、总结"></a>八、总结</h3><p><code>RecyclerView</code>使用相对<code>ListView</code>和<code>GridView</code>有一点复杂，但是提供了 viewholders、数据源、list等之间拆分的简单实现，动画效果提升了用户体验。<br>关于性能，对比<code>ListView</code>，两个都相似的实现了<code>ViewHolder</code>模式。然而用<code>RecyclerView</code>，你不得不选择<code>ViewHolder</code>模式。对于用户来说比没有使用<code>ViewHolder</code>有更好的体验，对于开发者来说，可以写出更好的代码。<br>同时，<code>RecyclerView</code>仍然有一些明显的不足（如：StaggeredGridLayoutManager），除此以外可以完美在项目中使用。</p>
<p>示例代码：<a href="https://github.com/Kernald/recyclerview-sample" target="_blank" rel="external">GitHub</a></p>

            
                

            
        </div>
    </div>
    <div class="post-footer main-content-wrap">
        
        <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2016/02/08/Android  React Native系列（一）：学习路径/"  data-tooltip="Android  React Native系列（一）：学习路径">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2016/01/31/Android：Material-Design笔记（一）/" data-tooltip="Android：Material Design笔记（一）">
                
                    <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions"  href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" data-tooltip="分享至Google+" href="https://plus.google.com/share?url=http://blog.alexwan1989.com/2016/02/06/Android：RecyclerView/">
                <i class="fa fa-google-plus"></i>
            </a>
        </li>
       
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" data-tooltip="分享至Twitter" href="https://twitter.com/intent/tweet?text=http://blog.alexwan1989.com/2016/02/06/Android：RecyclerView/">
                <i class="fa fa-twitter"></i>
            </a>
        </li>

         <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" data-tooltip="分享至新浪微博" href="http://www.jiathis.com/send/?webid=tsina&amp;appkey=&amp;uid=1850331&amp;url=http://blog.alexwan1989.com/2016/02/06/Android：RecyclerView/&amp;title=Android：RecyclerView">
                <i class="fa fa-weibo"></i>
            </a>
        </li>

        
            <li class="post-action">
                <a class="post-action-btn btn btn--default" href="#disqus_thread">
                    <i class="fa fa-comment-o"></i>
                </a>
            </li>
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>


        
            <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2016 alexwan. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="1">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2016/02/08/Android  React Native系列（一）：学习路径/"  data-tooltip="Android  React Native系列（一）：学习路径">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2016/01/31/Android：Material-Design笔记（一）/" data-tooltip="Android：Material Design笔记（一）">
                
                    <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions"  href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" data-tooltip="分享至Google+" href="https://plus.google.com/share?url=http://blog.alexwan1989.com/2016/02/06/Android：RecyclerView/">
                <i class="fa fa-google-plus"></i>
            </a>
        </li>
       
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" data-tooltip="分享至Twitter" href="https://twitter.com/intent/tweet?text=http://blog.alexwan1989.com/2016/02/06/Android：RecyclerView/">
                <i class="fa fa-twitter"></i>
            </a>
        </li>

         <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" data-tooltip="分享至新浪微博" href="http://www.jiathis.com/send/?webid=tsina&amp;appkey=&amp;uid=1850331&amp;url=http://blog.alexwan1989.com/2016/02/06/Android：RecyclerView/&amp;title=Android：RecyclerView">
                <i class="fa fa-weibo"></i>
            </a>
        </li>

        
            <li class="post-action">
                <a class="post-action-btn btn btn--default" href="#disqus_thread">
                    <i class="fa fa-comment-o"></i>
                </a>
            </li>
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                <div id="share-options-bar" class="share-options-bar" data-behavior="1">
    <ul class="share-options">
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=http://blog.alexwan1989.com/2016/02/06/Android：RecyclerView/">
                <i class="fa fa-google-plus"></i><span class="">Share on Google Plus</span>
            </a>
        </li>
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.alexwan1989.com/2016/02/06/Android：RecyclerView/">
                <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
            </a>
        </li>
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=http://blog.alexwan1989.com/2016/02/06/Android：RecyclerView/">
                <i class="fa fa-twitter"></i><span>Share on Twitter</span>
            </a>
        </li>
    </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
            
        </div>
        <div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <!-- use remote images as avatar-->
            <img id="about-card-picture" src="http://res.cloudinary.com/dmfz9aun7/image/upload/v1463120953/hexo/IMG_0738.jpg"/>
        
            <h4 id="about-card-name">alexwan</h4>
        
            <h5 id="about-card-bio"><p>无限大な梦のあとの 何もない世の中じゃ!</p>
</h5>
        
        
            <h5 id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Android Developer</p>

            </h5>
        
        
            <h5 id="about-card-location">
                <i class="fa fa-map-marker"></i>
                <br/>
                China ShangHai
            </h5>
        
    </div>
</div>

        <div id="cover" style="background-image:url('http://res.cloudinary.com/dmfz9aun7/image/upload/v1465302627/hexo/re_zero_kara_hajimeru_isekai_seikatsu_99.jpg');"></div>

    </body>
    <!--SCRIPTS-->
<script src="/assets/js/script.min.js" type="text/javascript"></script>
<!--SCRIPTS END-->

    <script type="text/javascript">
        var disqus_shortname = 'alexwan';
        (function() {
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>



</html>
