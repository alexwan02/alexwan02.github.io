<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
<meta name="twitter:description">
  
    <link rel="alternative" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/13/hello-world/" class="article-date">
  <time datetime="2016-06-13T06:41:19.000Z" itemprop="datePublished">2016-06-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/13/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="http://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="http://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="http://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick_Start"><a href="#Quick_Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create_a_new_post"><a href="#Create_a_new_post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run_server"><a href="#Run_server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate_static_files"><a href="#Generate_static_files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy_to_remote_sites"><a href="#Deploy_to_remote_sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/06/13/hello-world/" data-id="cipdnp2gc0004vx2277vcfely" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Android：Activity启动过程" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/05/Android：Activity启动过程/" class="article-date">
  <time datetime="2016-06-05T15:14:29.000Z" itemprop="datePublished">2016-06-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/05/Android：Activity启动过程/">Android：Activity启动过程</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="u4E00_u3001_u6253_u5F00Activity"><a href="#u4E00_u3001_u6253_u5F00Activity" class="headerlink" title="一、打开Activity"></a>一、打开Activity</h2><p>Activity通用的启动方式<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span> , TestActivity.class);</span><br><span class="line">startActivity(intent);</span><br></pre></td></tr></table></figure></p>
<h2 id="u4E8C_u3001startActivity_28_29"><a href="#u4E8C_u3001startActivity_28_29" class="headerlink" title="二、startActivity()"></a>二、startActivity()</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startActivity</span><span class="params">(Intent intent, @Nullable Bundle options)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (options != <span class="keyword">null</span>) &#123;</span><br><span class="line">        startActivityForResult(intent, -<span class="number">1</span>, options);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Note we want to go through this call for compatibility with</span></span><br><span class="line">        <span class="comment">// applications that may have overridden the method.</span></span><br><span class="line">        startActivityForResult(intent, -<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/06/05/Android：Activity启动过程/" data-id="cipdnp2h3000nvx226w7f3chp" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-RxJava读书笔记(一)" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/05/17/RxJava读书笔记(一)/" class="article-date">
  <time datetime="2016-05-17T07:41:44.000Z" itemprop="datePublished">2016-05-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/RxJava/">RxJava</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/05/17/RxJava读书笔记(一)/">RxJava读书笔记(一)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="https://www.gitbook.com/book/yuxingxin/rxjava-essentials-cn/details" target="_blank" rel="external">RxJava Essentials CN</a></p>
<p><a href="http://reactivex.io/documentation/observable.html" target="_blank" rel="external">ReactiveX</a></p>
<p><a href="https://mcxiaoke.gitbooks.io/rxdocs/content/Intro.html" target="_blank" rel="external">ReactiveX文档中文翻译</a></p>
<h2 id="u4ECB_u7ECD"><a href="#u4ECB_u7ECD" class="headerlink" title="介绍"></a>介绍</h2><h3 id="u6982_u8FF0"><a href="#u6982_u8FF0" class="headerlink" title="概述"></a>概述</h3><p>RxJava是<a href="https://reactivex.io/" target="_blank" rel="external">ReactiveX (Reactive Extensions)</a>的Java版本：</p>
<ul>
<li>a library for composing asynchronous and event-based programs by using observable sequences.<br>一个构成异步的、基于事件的用可观察的序列的程序库。</li>
</ul>
<p>关于ReactiveX的更多信息，查看<a href="http://reactivex.io/intro.html" target="_blank" rel="external">Introduction to ReactiveX</a></p>
<h3 id="u8F7B_u91CF_u7EA7"><a href="#u8F7B_u91CF_u7EA7" class="headerlink" title="轻量级"></a>轻量级</h3><p>RxJava是个轻量级的库，以单独的jar形式，集中观察者模式和相关高阶函数</p>
<h3 id="u591A_u8BED_u8A00_u7684_u5B9E_u73B0"><a href="#u591A_u8BED_u8A00_u7684_u5B9E_u73B0" class="headerlink" title="多语言的实现"></a>多语言的实现</h3><p>RxJava支持Java6及以上的基于JVM的实现的语言如：<a href="https://github.com/ReactiveX/RxGroovy" target="_blank" rel="external">Groovy</a>、<a href="https://github.com/ReactiveX/RxClojure" target="_blank" rel="external">Clojure</a>、<a href="https://github.com/ReactiveX/RxJRuby" target="_blank" rel="external">JRuby</a>、<a href="https://github.com/ReactiveX/RxKotlin" target="_blank" rel="external">Kotlin</a>、<a href="https://github.com/ReactiveX/RxScala" target="_blank" rel="external">Scala</a>。</p>
<p>RxJava适用多语言环境不仅仅是Java或Scala。设计遵守每种JVM-based语言的风格。</p>
<h3 id="RxJava_u5E93"><a href="#RxJava_u5E93" class="headerlink" title="RxJava库"></a>RxJava库</h3><p>以下的扩展库都可以适用RxJava</p>
<ul>
<li><a href="https://github.com/Netflix/Hystrix/wiki/How-To-Use#wiki-Reactive-Execution" target="_blank" rel="external">Hystrix</a> 针对分布式系统的延迟和容错库</li>
<li><a href="http://camel.apache.org/rx.html" target="_blank" rel="external">Camel RX</a>使用RxJava提供重用<a href="http://camel.apache.org/components.html" target="_blank" rel="external">Apache Camel components, protocols, transports and data formats</a>的简单方式。</li>
<li><a href="https://github.com/myfreeweb/rxjava-http-tail" target="_blank" rel="external">rxjava-http-tail</a> </li>
<li><a href="https://github.com/vert-x/mod-rxvertx" target="_blank" rel="external">mod-rxvertx - Extension for VertX</a></li>
<li><a href="https://github.com/davidmoten/rxjava-jdbc" target="_blank" rel="external">rxjava-jdbc</a></li>
<li><a href="https://github.com/davidmoten/rtree" target="_blank" rel="external">rtree</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/05/17/RxJava读书笔记(一)/" data-id="cipdnp2gl0007vx22z12g16s2" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/RxJava/">RxJava</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Android：NDK开发（二）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/18/Android：NDK开发（二）/" class="article-date">
  <time datetime="2016-04-18T03:32:17.000Z" itemprop="datePublished">2016-04-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/18/Android：NDK开发（二）/">Android NDK开发（二）：使用Android Studio开发进行NDK开发</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="http://tools.android.com/tech-docs/android-ndk-preview" target="_blank" rel="external">Android NDK Preview</a></p>
<p><a href="http://tools.android.com/tech-docs/new-build-system/gradle-experimental" target="_blank" rel="external">Experimental Plugin User Guide</a></p>
<p><a href="http://blog.csdn.net/yanbober/article/details/51027520" target="_blank" rel="external">NDK-JNI实战教程（四）再谈新工具及NDK开发调试</a></p>
<p><a href="https://dailyios.com/article/Using_Android_Studio_for_NDK_development.html" target="_blank" rel="external">使用AndroidStudio进行NDK开发（一）</a></p>
<h3 id="u4E00_u3001Android_Studio_u73AF_u5883_u914D_u7F6E"><a href="#u4E00_u3001Android_Studio_u73AF_u5883_u914D_u7F6E" class="headerlink" title="一、Android Studio环境配置"></a>一、Android Studio环境配置</h3><h4 id="1_u3001_u4ECB_u7ECD"><a href="#1_u3001_u4ECB_u7ECD" class="headerlink" title="1、介绍"></a>1、介绍</h4><p>Android Studio的插件是基于Gradle的新组件模型机制，减少了NDK环境配置时间。同时含有编译JNI应用所需的NDK集成环境。本篇用户指导详细介绍如何使用Android Studio的新插件、标出新的插件和传统插件的区别。</p>
<blockquote>
<p>注意：新的插件还是预览版，对应的Gradle api不是最终的版本，也意味着不同插件需要配合对应版本的Gradle来使用，DSL也可能变动。</p>
</blockquote>
<h4 id="2_u3001_u6700_u65B0_u7248_u672C"><a href="#2_u3001_u6700_u65B0_u7248_u672C" class="headerlink" title="2、最新版本"></a>2、最新版本</h4><p>Check <a href="/bintray repository">https://bintray.com/android/android-tools/com.android.tools.build.gradle-experimental/view</a> 查看最新版本；</p>
<h4 id="3_u3001_u914D_u7F6E"><a href="#3_u3001_u914D_u7F6E" class="headerlink" title="3、配置"></a>3、配置</h4><ul>
<li>Gradle（根据下面的表格选择对应的插件版本）</li>
<li>Android NDK r10e（如需使用NDK）</li>
<li>SDK的Build Tools 至少需要19.0.0 ，意图在未来的版本变动最小化迁移过流程中带来的变动。一些特性需要更新的版本。</li>
<li><p>每个不同版本的插件需要配置对应的Gradle版本</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">┌───────────┬────────────┐</span><br><span class="line">    Plugin Version  	    Gradle Version          	</span><br><span class="line">├───────────┼────────────┤</span><br><span class="line">    <span class="number">0.1</span>.0                   <span class="number">2.5</span>                            	</span><br><span class="line">├───────────┼────────────┤</span><br><span class="line">    <span class="number">0.2</span>.0                   <span class="number">2.6</span> 	                          	</span><br><span class="line">├───────────┼────────────┤</span><br><span class="line">    <span class="number">0.3</span>.0-alpha3            <span class="number">2.8</span>                           	</span><br><span class="line">├───────────┼────────────┤</span><br><span class="line">    <span class="number">0.6</span>.0-alpha1            <span class="number">2.8</span>                            	</span><br><span class="line">├───────────┼────────────┤</span><br><span class="line">    <span class="number">0.6</span>.0-alpha5            <span class="number">2.10</span>                           	</span><br><span class="line">├───────────┼────────────┤</span><br><span class="line">    <span class="number">0.7</span>.0-alpha1            <span class="number">2.10</span>                           	</span><br><span class="line">└───────────┴────────────┘</span><br></pre></td></tr></table></figure>
<h4 id="4_u3001_u4ECE_u4F20_u7EDFAndroid_Gradle__u63D2_u4EF6_u8FC1_u79FB"><a href="#4_u3001_u4ECE_u4F20_u7EDFAndroid_Gradle__u63D2_u4EF6_u8FC1_u79FB" class="headerlink" title="4、从传统Android Gradle 插件迁移"></a>4、从传统Android Gradle 插件迁移</h4><p>经典的Android Studio项目类似下面的目录结构，迁移新的ndk插件需要修改标出的文件内容。传统插件和新插件的有几个重要的DSL内容变化。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── app/</span><br><span class="line">│   ├── app.iml</span><br><span class="line">│   ├── build.gradle  ◀</span><br><span class="line">│   └── src/</span><br><span class="line">├── build.gradle ◀</span><br><span class="line">├── gradle/</span><br><span class="line">│   └── wrapper/</span><br><span class="line">│       ├── gradle-wrapper.jar</span><br><span class="line">│       └── gradle-wrapper.properties ◀</span><br><span class="line">├── gradle.properties</span><br><span class="line">├── gradlew*</span><br><span class="line">├── gradlew.bat</span><br><span class="line">├── local.properties</span><br><span class="line">├── MyApplication.iml</span><br><span class="line">└── settings.gradle</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="uFF081_uFF09-/gradle/wrapper/gradle-wrapper-properties"><a href="#uFF081_uFF09-/gradle/wrapper/gradle-wrapper-properties" class="headerlink" title="（1）./gradle/wrapper/gradle-wrapper.properties"></a>（1）./gradle/wrapper/gradle-wrapper.properties</h5><ul>
<li>新插件每个版本支持指定的gradle版本。参考<a href="http://tools.android.com/tech-docs/new-build-system/gradle-experimental?pli=1#TOC-Gradle-Requirements" target="_blank" rel="external">Gradle Requirements</a> 选择Gradle。</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#Wed Apr 10 15:27:10 PDT 2013</span><br><span class="line">distributionBase=GRADLE_USER_HOME</span><br><span class="line">distributionPath=wrapper/dists</span><br><span class="line">zipStoreBase=GRADLE_USER_HOME</span><br><span class="line">zipStorePath=wrapper/dists</span><br><span class="line">distributionUrl=https\://services.gradle.org/distributions/gradle-2.10-all.zip</span><br></pre></td></tr></table></figure>
<h5 id="uFF082_uFF09-/build-gradle"><a href="#uFF082_uFF09-/build-gradle" class="headerlink" title="（2）./build.gradle"></a>（2）./build.gradle</h5><ul>
<li>插件路径 <code>com.android.tools.build:gradle-experimental</code> 替换 <code>com.android.tools.build:gradle</code>.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Top-level build file where you can add configuration options common to all sub-projects/modules.</span></span><br><span class="line">buildscript &#123;</span><br><span class="line">  repositories &#123;</span><br><span class="line">    jcenter()</span><br><span class="line">  &#125;</span><br><span class="line">  dependencies &#123;</span><br><span class="line">    classpath <span class="string">"com.android.tools.build:gradle-experimental:0.7.0-alpha4"</span></span><br><span class="line">    <span class="comment">// <span class="doctag">NOTE:</span> Do not place your application dependencies here; they belong</span></span><br><span class="line">    <span class="comment">// in the individual module build.gradle files</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        jcenter()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="uFF083_uFF09-/app/build-gradle"><a href="#uFF083_uFF09-/app/build-gradle" class="headerlink" title="（3）./app/build.gradle"></a>（3）./app/build.gradle</h5><p>DSL有意义的变化，我们知道很多变化看起来没有必要的，而我们的目的是移除一些这些变化，来减少在未来处理迁移的处理。</p>
<blockquote>
<p>注意：从版本<code>0.6.0-alpha5</code>开始，DSL有部分重要的提升。例子中的代码不适应之前版本，如果你使用旧版本插件，请参考<a href="https://sites.google.com/a/android.com/tools/tech-docs/new-build-system/gradle-experimental/0-4-0" target="_blank" rel="external">旧版本用户指导</a></p>
</blockquote>
<p>DSL 变化：</p>
<ul>
<li>插件名称由<code>com.android.application</code>变为<code>com.android.model.application</code>，或者用<code>apply plugin: &quot;com.android.model.library&quot;</code> 创建Android aar Library。</li>
<li>用<code>model { }</code>来包裹配置。</li>
<li>用add方法来为集合添加元素。</li>
</ul>
<p>当前DSL限制 </p>
<ul>
<li>属性列表只能设置它们的直系类型，无法接受其他类型。例如：<ul>
<li>你可以用String来设置File类型的属性，但List<file>只能接受文件类型</file></li>
</ul>
</li>
<li>创建编译类型或产品需要调用create方法，修改已经存在的发布或编译类型可以使用名字来完成。</li>
<li><p>修改变量和任务的DSL很受限制。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: <span class="string">"com.android.model.application"</span></span><br><span class="line">model &#123;</span><br><span class="line">  android &#123;</span><br><span class="line">    compileSdkVersion <span class="number">23</span></span><br><span class="line">    buildToolsVersion <span class="string">"23.0.2"</span></span><br><span class="line"></span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">      applicationId <span class="string">"com.example.user.myapplication"</span></span><br><span class="line">      minSdkVersion.apiLevel <span class="number">15</span></span><br><span class="line">      targetSdkVersion.apiLevel <span class="number">22</span></span><br><span class="line">      versionCode <span class="number">1</span></span><br><span class="line">      versionName <span class="string">"1.0"</span></span><br><span class="line"></span><br><span class="line">      buildConfigFields &#123;</span><br><span class="line">        create() &#123;</span><br><span class="line">          type <span class="string">"int"</span></span><br><span class="line">          name <span class="string">"VALUE"</span></span><br><span class="line">          value <span class="string">"1"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    buildTypes &#123;</span><br><span class="line">      release &#123;</span><br><span class="line">        minifyEnabled <span class="keyword">false</span></span><br><span class="line">        proguardFiles.add(file(<span class="string">"proguard-rules.pro"</span>))</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    productFlavors &#123;</span><br><span class="line">      create(<span class="string">"flavor1"</span>) &#123;</span><br><span class="line">        applicationId <span class="string">"com.app"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="comment">// Configures source set directory.</span></span><br><span class="line">    sources &#123;</span><br><span class="line">      main &#123;</span><br><span class="line">        java &#123;</span><br><span class="line">          source &#123;</span><br><span class="line">            srcDir <span class="string">"src"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">  <span class="function">compile <span class="title">fileTree</span><span class="params">(dir: <span class="string">"libs"</span>, include: [<span class="string">"*.jar"</span>])</span></span><br><span class="line">  compile "com.android.support:appcompat-v7:22.2.0"</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<h5 id="uFF084_uFF09_u7B7E_u540D_u914D_u7F6E"><a href="#uFF084_uFF09_u7B7E_u540D_u914D_u7F6E" class="headerlink" title="（4）签名配置"></a>（4）签名配置</h5><p>用<code>$()</code>语法指定其他的model元素。使用<code>$()</code>，需要为Gradle 2.10以下版本添加<code>&quot;-Dorg.gradle.model.dsl=true&quot;</code>Gradle命令行的参数。对指定签名配置文件很有用。</p>
<blockquote>
<p>注意：android.signingConfigs必须在<code>android {}</code>块之外。</p>
</blockquote>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: <span class="string">"com.android.model.application"</span></span><br><span class="line"></span><br><span class="line">model &#123;</span><br><span class="line">  android &#123;</span><br><span class="line">    compileSdkVersion <span class="number">23</span></span><br><span class="line">    buildToolsVersion <span class="string">"23.0.2"</span></span><br><span class="line">    buildTypes &#123;</span><br><span class="line">      release &#123;</span><br><span class="line">        signingConfig = $(<span class="string">"android.signingConfigs.myConfig"</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  android.signingConfigs &#123;</span><br><span class="line">    create(<span class="string">"myConfig"</span>) &#123;</span><br><span class="line">      storeFile <span class="string">"/path/to/debug.keystore"</span></span><br><span class="line">      storePassword <span class="string">"android"</span></span><br><span class="line">      keyAlias <span class="string">"androiddebugkey"</span></span><br><span class="line">      keyPassword <span class="string">"android"</span></span><br><span class="line">      storeType <span class="string">"jks"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="5_u3001NDK_u96C6_u6210_u73AF_u5883"><a href="#5_u3001NDK_u96C6_u6210_u73AF_u5883" class="headerlink" title="5、NDK集成环境"></a>5、NDK集成环境</h4><p>新的插件集成了NDK开发环境，支持创建Native应用。如何使用NDK集成环境：</p>
<ul>
<li>用Studio内部SDK Manager 下载 NDK</li>
<li>设定local.properties中的ndk.dir 或ANDROID_NDK_HOME环境变量的值，为NDK的路径</li>
<li>在build.gradle 中添加<code>android.ndk</code>模块<h5 id="uFF081_uFF09_u7B80_u5355NDK_u914D_u7F6E"><a href="#uFF081_uFF09_u7B80_u5355NDK_u914D_u7F6E" class="headerlink" title="（1）简单NDK配置"></a>（1）简单NDK配置</h5>一个简单NDK应用的build.gradle如下：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: <span class="string">'com.android.model.application'</span></span><br><span class="line"></span><br><span class="line">model &#123;</span><br><span class="line">  android &#123;</span><br><span class="line">    compileSdkVersion <span class="number">23</span></span><br><span class="line">    buildToolsVersion <span class="string">"23.0.2"</span></span><br><span class="line">    ndk &#123;</span><br><span class="line">      moduleName <span class="string">"native"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>注意：<code>moduleName</code>参数不能省略，决定native库的名称</p>
</blockquote>
<h5 id="uFF082_uFF09Ndk_Source__u8BBE_u7F6E"><a href="#uFF082_uFF09Ndk_Source__u8BBE_u7F6E" class="headerlink" title="（2）Ndk Source 设置"></a>（2）Ndk Source 设置</h5><p>默认情况下，会查找<code>src/main/jni</code>中的 C/C++ 文件。配置android.sources 修改源码路径<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">model &#123;</span><br><span class="line">  android &#123;</span><br><span class="line">    compileSdkVersion <span class="number">23</span></span><br><span class="line">    buildToolsVersion <span class="string">"23.0.2"</span></span><br><span class="line">    ndk &#123;</span><br><span class="line">      moduleName <span class="string">"native"</span></span><br><span class="line">    &#125;</span><br><span class="line">    sources &#123;</span><br><span class="line">      main &#123;</span><br><span class="line">        jni &#123;</span><br><span class="line">          source &#123;</span><br><span class="line">            srcDir <span class="string">"src"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>JNI源码包含C和C++ 文件，子目录中所有文件都包含。带有.c后缀的文件为 C 文件，而C++ 文件则有以下几种后缀：.C ，.CPP，.c++ .cp ，.cpp ，.cxx。可以使用<code>exculde</code>方法排除文件，用<code>include</code>忽略文件。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">model &#123; </span><br><span class="line">  android.sources &#123;</span><br><span class="line">    main &#123;</span><br><span class="line">      jni &#123;</span><br><span class="line">        source &#123;</span><br><span class="line">          include <span class="string">"someFile.txt"</span></span><br><span class="line">          exclude <span class="string">"**/excludeThisFile.c"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;		</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h5 id="uFF083_uFF09_u5176_u4ED6_u7F16_u8BD1_u53C2_u6570"><a href="#uFF083_uFF09_u5176_u4ED6_u7F16_u8BD1_u53C2_u6570" class="headerlink" title="（3）其他编译参数"></a>（3）其他编译参数</h5><p>可以使用<code>android.ndk{}</code>块来设置参数<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">model &#123;</span><br><span class="line">  android &#123;</span><br><span class="line">    compileSdkVersion <span class="number">23</span></span><br><span class="line">    buildToolsVersion <span class="string">"23.0.2"</span></span><br><span class="line">    ndk &#123;</span><br><span class="line">      <span class="comment">// All Configurations that can be changed in android.ndk</span></span><br><span class="line">      moduleName <span class="string">"native"</span></span><br><span class="line">      toolchain <span class="string">"clang"</span></span><br><span class="line">      toolchainVersion <span class="string">"3.5"</span></span><br><span class="line">      <span class="comment">// Note that CFlags has a capital C ,which is inconsistent with </span></span><br><span class="line">      <span class="comment">// the naming convention of other properties. This is a </span></span><br><span class="line">      <span class="comment">// technical limitation that will be resolved</span></span><br><span class="line">      CFlags.add(<span class="string">"-DCUSTOM_DEFINE"</span>)</span><br><span class="line">      cppFlags.add(<span class="string">"-DCUSTOM_DEFINE"</span>)</span><br><span class="line">      ldFlags.add(<span class="string">"-L/custom/lib/path"</span>)</span><br><span class="line">      ldLibs.add(<span class="string">"log"</span>)</span><br><span class="line">      stl <span class="string">"stlport_static"</span></span><br><span class="line">    &#125;</span><br><span class="line">    buildTypes &#123;</span><br><span class="line">      release &#123;</span><br><span class="line">        ndk &#123;</span><br><span class="line">          debuggable <span class="keyword">true</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    productFlavors &#123;</span><br><span class="line">      create(<span class="string">"arm"</span>) &#123;</span><br><span class="line">        ndk &#123;</span><br><span class="line">          <span class="comment">// You can customize the NDK configurations for each</span></span><br><span class="line">          <span class="comment">// productFlavors and buildTypes.</span></span><br><span class="line">          abiFilters.add(<span class="string">"armeabi-v7a"</span>)	  </span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      create(<span class="string">"fat"</span>) &#123;</span><br><span class="line">        <span class="comment">// If ndk.abiFilters is not configured, the application</span></span><br><span class="line">        <span class="comment">// compile and package all suppported ABI.</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// You can modify the NDK configuration for each variant.</span></span><br><span class="line">  components.android &#123;</span><br><span class="line">    binaries.afterEach &#123; binary -&gt;</span><br><span class="line">      binary.mergedNdkConfig.cppFlags.add( <span class="string">"-DVARIANT=\""</span> + binary.name + <span class="string">"\""</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h5 id="uFF084_uFF09_u5DF2_u77E5_u9650_u5236"><a href="#uFF084_uFF09_u5DF2_u77E5_u9650_u5236" class="headerlink" title="（4）已知限制"></a>（4）已知限制</h5><ol>
<li>不支持类似cpu_feature的NDK 单元</li>
<li>不支持合并外部build系统 </li>
</ol>
<h5 id="uFF085_uFF09_u793A_u4F8B"><a href="#uFF085_uFF09_u793A_u4F8B" class="headerlink" title="（5）示例"></a>（5）示例</h5><p>访问Github的<a href="https://github.com/googlesamples/android-ndk" target="_blank" rel="external">Ndk Samples</a></p>
<h5 id="uFF086_uFF09_u591A_u91CDNDK_Project"><a href="#uFF086_uFF09_u591A_u91CDNDK_Project" class="headerlink" title="（6）多重NDK Project"></a>（6）多重NDK Project</h5><p>0.4.0 Plugin 添加了NDK依赖的基础支持，可以创建一个native 库。如果使用0.4.0 Plugin可以用Gradle编译native项目，但在Android Studio中编辑和调试功能尚未实现。</p>
<ul>
<li><p>独立NDK Plugin</p>
<p>  在gradle-experimental:0.4.0中，一个新的Plugin可以只创建native library，无须创建android application 或 android     library。DSL与 application/library Plugin相近。下面的例子中<code>build.gradle</code>可以使用<code>src/main/jni</code>的C/C++源文件来生成<code>libhello.so</code>文件</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: <span class="string">"com.android.model.native"</span></span><br><span class="line">model &#123;</span><br><span class="line">  android&#123;</span><br><span class="line">    compileSdkVersion <span class="number">23</span></span><br><span class="line">    ndk &#123;</span><br><span class="line">      moduleName <span class="string">"hello"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>已知问题</p>
<ul>
<li>Android Studio 未支持编辑单独plugin</li>
<li>编译application时修改library源文件后，不会自动重链接到新的library</li>
</ul>
</li>
</ul>
<h5 id="uFF086_uFF09Ndk_u4F9D_u8D56"><a href="#uFF086_uFF09Ndk_u4F9D_u8D56" class="headerlink" title="（6）Ndk依赖"></a>（6）Ndk依赖</h5><p>指定依赖的语法遵照Gradle未来依赖系统的方式，你可以设定依赖的Android Project或指定文件。<br>比如，假设有个使用独立NDK Plugin的subproject</p>
<figure class="highlight java"><figcaption><span>lib/build.gradle</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: <span class="string">"com.android.model.native"</span></span><br><span class="line">model &#123;</span><br><span class="line">  android&#123;</span><br><span class="line">    compileSdkVersion <span class="number">23</span></span><br><span class="line">    ndk &#123;</span><br><span class="line">      moduleName <span class="string">"hello"</span></span><br><span class="line">    &#125;</span><br><span class="line">    sources &#123;</span><br><span class="line">      main &#123;</span><br><span class="line">        jni &#123;</span><br><span class="line">          exportedHeaders &#123;</span><br><span class="line">            srcDir <span class="string">"src/main/headers"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>任何带有JNI依赖的项目需要包含exportedHeaders指定的目录。你可以为项目的依赖项目添加JNI代码</p>
<figure class="highlight java"><figcaption><span>app/build.gradle</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: <span class="string">"com.android.model.application"</span></span><br><span class="line">model&#123;</span><br><span class="line">  android&#123;</span><br><span class="line">    compileSdkVersion <span class="number">23</span></span><br><span class="line">    buildToolsVersion <span class="string">"23.0.2"</span></span><br><span class="line">    source &#123;</span><br><span class="line">      main &#123;</span><br><span class="line">        jni &#123;</span><br><span class="line">          dependencies &#123;</span><br><span class="line">            project <span class="string">":lib1"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>你可以指定target项目的buildType 和（或）productFlavor 。否则，plugin会查找相同的buildType和productFlavor作为你的application。你也可以指定linkageType，如果希望native library最为静态链接库的话。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">model&#123;</span><br><span class="line">  android.sources &#123;</span><br><span class="line">    main &#123;</span><br><span class="line">      jni &#123;</span><br><span class="line">        dependencies &#123;</span><br><span class="line">          project <span class="string">":lib1"</span></span><br><span class="line">          buildType <span class="string">"debug"</span></span><br><span class="line">          productFlavor <span class="string">"flavor1"</span></span><br><span class="line">          linkage <span class="string">"static"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>声明依赖文件，创建预编译库，添加依赖库等</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">model &#123;</span><br><span class="line">  repositories &#123;</span><br><span class="line">    libs (PrebuiltLibraries) &#123;</span><br><span class="line">      prebuilt &#123;</span><br><span class="line">        headers.srcDir <span class="string">"path/to/headers"</span></span><br><span class="line">        binaries.withType (SharedLibraryBinary) &#123;</span><br><span class="line">          sharedLibraryFile = file(<span class="string">"lib/$&#123;targetPlatform.getName() &#125;/prebuilt.so"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  android.sources &#123;</span><br><span class="line">    main &#123;</span><br><span class="line">      jniLibs &#123;</span><br><span class="line">        dependencies &#123;</span><br><span class="line">          library <span class="string">"prebuilt"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以添加native 依赖到”jniLibs”或”jni” source 集合中。当添加natice依赖库到”jniLibs”中，依赖会打包到<code>application/library</code>下，但不会用来编译JNI代码。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">model &#123;</span><br><span class="line">  android.sources &#123;</span><br><span class="line">    main &#123;</span><br><span class="line">      jniLibs &#123;</span><br><span class="line">      	dependencies &#123;</span><br><span class="line">          library <span class="string">"prebuilt"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="6_u3001DSL_u53D8_u5316"><a href="#6_u3001DSL_u53D8_u5316" class="headerlink" title="6、DSL变化"></a>6、DSL变化</h4><p>Plugin还在试验阶段，DSL会随着plugin开发版本变动。本节来说明不同版本的DSL变化，来帮助迁移。</p>
<h5 id="uFF081_uFF09_u30010-6-0-alpha1_-_26gt_3B_0-6-0-alpha5"><a href="#uFF081_uFF09_u30010-6-0-alpha1_-_26gt_3B_0-6-0-alpha5" class="headerlink" title="（1）、0.6.0-alpha1 -&gt; 0.6.0-alpha5"></a>（1）、0.6.0-alpha1 -&gt; 0.6.0-alpha5</h5><ul>
<li>Plugin需要gradle 2.10 ，带来DSL签名方面的改善</li>
<li><p>配置信息可以被折叠</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">android&#123;</span><br><span class="line">  buildTypes &#123;</span><br><span class="line">   ... </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  替换</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">android.buildTypes &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>文件类型接受String，但String无法添加到List<file>中</file></p>
</li>
<li>-Dorg.gradle.model=true 现在为默认值。允许被其他model引用，但是引用的model必须为独立的block</li>
<li>大多数参数不在需要’=’来设值</li>
</ul>
<h5 id="uFF082_uFF09_u30010-4-x_-_26gt_3B_0-6-0-alpha1"><a href="#uFF082_uFF09_u30010-4-x_-_26gt_3B_0-6-0-alpha1" class="headerlink" title="（2）、0.4.x -&gt; 0.6.0-alpha1"></a>（2）、0.4.x -&gt; 0.6.0-alpha1</h5><ul>
<li><p>指定依赖指定库文件的DSL修改为遵守Gradle的native依赖DSL。<a href="https://github.com/gradle/gradle/blob/master/subprojects/docs/src/samples/native-binaries/prebuilt/build.gradle" target="_blank" rel="external">Sample</a></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">model &#123;</span><br><span class="line">  repositories &#123;</span><br><span class="line">    prebuilt(PrebuildtLibraries) &#123;</span><br><span class="line">      binaries.withType(SharedLibraryBinary)&#123;</span><br><span class="line">        sharedLibraryFile = file(<span class="string">"lib/$&#123;targetPlatform.getName()&#125;/prebuilt.so"</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    android.sources &#123;</span><br><span class="line">      main&#123;</span><br><span class="line">        jniLibs &#123;</span><br><span class="line">          dependencies &#123;</span><br><span class="line">            library <span class="string">"prebuilt"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="uFF083_uFF09_u30010-2-x_-_26gt_3B_0-4-0"><a href="#uFF083_uFF09_u30010-2-x_-_26gt_3B_0-4-0" class="headerlink" title="（3）、0.2.x -&gt; 0.4.0"></a>（3）、0.2.x -&gt; 0.4.0</h5><ul>
<li>+= 不在用于collections。列表添加Items可以使用’add’和’addAll’放。如 <code>CFlags += &quot;-DCUSTOM_DEFINE&quot;</code>用<code>CFlags.add(&quot;-DCUSTOM_DEFINE&quot;)</code>替换。</li>
</ul>
<h5 id="uFF084_uFF09_u30010-1-x_-_26gt_3B_0-2-x"><a href="#uFF084_uFF09_u30010-1-x_-_26gt_3B_0-2-x" class="headerlink" title="（4）、0.1.x -&gt; 0.2.x"></a>（4）、0.1.x -&gt; 0.2.x</h5><ul>
<li><p>jniDebuggable 从buildType 移动到ndk模块中</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">release &#123;</span><br><span class="line">  jniDebuggable = <span class="keyword">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  变为</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">release &#123;</span><br><span class="line">  ndk.with &#123;</span><br><span class="line">    debuggable = <span class="keyword">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/04/18/Android：NDK开发（二）/" data-id="cipdnp2gx000kvx225nnu5akl" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Android：NDK开发（一）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/12/Android：NDK开发（一）/" class="article-date">
  <time datetime="2016-04-12T09:28:12.000Z" itemprop="datePublished">2016-04-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/12/Android：NDK开发（一）/">Android：NDK开发（一）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="u4E00_u3001Mac_NDK_u5F00_u53D1_u73AF_u5883_u642D_u5EFA"><a href="#u4E00_u3001Mac_NDK_u5F00_u53D1_u73AF_u5883_u642D_u5EFA" class="headerlink" title="一、Mac NDK开发环境搭建"></a>一、Mac NDK开发环境搭建</h2><h2 id="u4E8C_u3001Android_Studio_u914D_u7F6E"><a href="#u4E8C_u3001Android_Studio_u914D_u7F6E" class="headerlink" title="二、Android Studio配置"></a>二、Android Studio配置</h2><h2 id="u4E09_u3001NDK__u914D_u7F6E_u6587_u4EF6_u4ECB_u7ECD"><a href="#u4E09_u3001NDK__u914D_u7F6E_u6587_u4EF6_u4ECB_u7ECD" class="headerlink" title="三、NDK 配置文件介绍"></a>三、NDK 配置文件介绍</h2><h3 id="uFF08_u4E00_uFF09_u3001Android-MK"><a href="#uFF08_u4E00_uFF09_u3001Android-MK" class="headerlink" title="（一）、Android.MK"></a>（一）、Android.MK</h3><p>Android.MK文件位于<code>./jni</code>文件夹下，描述编译系统的资源和共享库信息。对于定义项目配置å<code>Application.mk</code>、环境变量。</p>
<h4 id="1-__u57FA_u672C_u5C5E_u6027"><a href="#1-__u57FA_u672C_u5C5E_u6027" class="headerlink" title="1. 基本属性"></a>1. 基本属性</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LOCAL_PATH</span></span><br><span class="line">LOCAL_PATH := $(call my-dir)</span><br><span class="line"></span><br><span class="line"><span class="comment">// CLEAR_VARS</span></span><br><span class="line">include $(CLEAR_VARS)</span><br><span class="line"></span><br><span class="line"><span class="comment">// LOCAL_MODULE</span></span><br><span class="line">LOCAL_MODULE := hello-jni</span><br><span class="line"></span><br><span class="line"><span class="comment">// LOCAL_SRC_FILES</span></span><br><span class="line">LOCAL_SRC_FILES := hello-jni.c</span><br><span class="line"></span><br><span class="line"><span class="comment">// BUILD_SHARED_LIBRARY</span></span><br><span class="line">include $(BUILD_SHARED_LIBRARY)</span><br></pre></td></tr></table></figure>
<h4 id="2-__u53D8_u91CF_u548C_u5B8F"><a href="#2-__u53D8_u91CF_u548C_u5B8F" class="headerlink" title="2. 变量和宏"></a>2. 变量和宏</h4><h4 id="3-_NDK_u5B9A_u4E49_u7684_u53D8_u91CF"><a href="#3-_NDK_u5B9A_u4E49_u7684_u53D8_u91CF" class="headerlink" title="3. NDK定义的变量"></a>3. NDK定义的变量</h4><p>（1） CLEAR_VARS</p>
<p>（2）2BUILD_SHARED_LIBRARY</p>
<p>（3）BUILD_STATIC_LIBRARY</p>
<p>（4）PREBUILT_SHARED_LIBRARY</p>
<p>（5）PREBUILT_STATIC_LIBRARY</p>
<p>（6）TARGET_ARCH</p>
<p>（7）TARGET_PLATFORM</p>
<p>（8）TARGET_ARCH_ABI</p>
<p>（9）TARGET_ABI</p>
<h4 id="4-__u7EC4_u4EF6_u63CF_u8FF0_u7684_u53D8_u91CF"><a href="#4-__u7EC4_u4EF6_u63CF_u8FF0_u7684_u53D8_u91CF" class="headerlink" title="4. 组件描述的变量"></a>4. 组件描述的变量</h4><p>（1）LOCAL_PATH</p>
<p>（2）LOCAL_MODULE</p>
<p>（3）LOCAL_MODULE_FILENAME</p>
<p>（4）LOCAL_SRC_FILES</p>
<p>（5）LOCAL_CPP_EXTENSION</p>
<p>（6）LOCAL_CPP_FEATURES</p>
<p>（7）LOCAL_C_INCLUDES</p>
<p>（8）LOCAL_CFLAGS</p>
<p>（9）LOCAL_CPPFLAGS</p>
<p>（10）LOCAL_STATIC_LIBRARIES</p>
<p>（11）LOCAL_SHARED_LIBRARIES</p>
<p>（12）LOCAL_WHOLE_STATIC_LIBRARIES</p>
<p>（13）LOCAL_LDLIBS</p>
<p>（14）LOCAL_LDFLAGS</p>
<p>（15）LOCAL_ALLOW_UNDEFINED_SYMBOLS</p>
<p>（16）LOCAL_ARM_MODE</p>
<p>（17）LOCAL_ARM_NEON</p>
<p>（18）LOCAL_DISABLE_NO_EXECUTE</p>
<p>（19）LOCAL_DISABLE_RELRO</p>
<p>（20）LOCAL_DISABLE_FORMAT_STRING_CHECKS</p>
<p>（21）LOCAL_EXPORT_CFLAGS</p>
<p>（22）LOCAL_EXPORT_CPPFLAGS</p>
<p>（23）LOCAL_EXPORT_C_INCLUDES</p>
<p>（24）LOCAL_EXPORT_LDFLAGS</p>
<p>（25）LOCAL_EXPORT_LDLIBS</p>
<p>（26）LOCAL_SHORT_COMMANDS</p>
<p>（27）LOCAL_THIN_ARCHIVE</p>
<p>（28）LOCAL_FILTER_ASM</p>
<h4 id="5-_NDK_u63D0_u4F9B_u7684_u51FD_u6570_u5B8F"><a href="#5-_NDK_u63D0_u4F9B_u7684_u51FD_u6570_u5B8F" class="headerlink" title="5. NDK提供的函数宏"></a>5. NDK提供的函数宏</h4><p>（1）my-dir</p>
<p>（2）all-subdir-makefiles</p>
<p>（3）this-makefile</p>
<p>（4）parent-makefile</p>
<p>（5）grand-parent-makefile</p>
<p>（6）import-module</p>
<h3 id="uFF08_u4E8C_uFF09_u3001Application-mk"><a href="#uFF08_u4E8C_uFF09_u3001Application-mk" class="headerlink" title="（二）、Application.mk"></a>（二）、Application.mk</h3><h3 id="uFF08_u4E09_uFF09_u3001_u5C5E_u6027"><a href="#uFF08_u4E09_uFF09_u3001_u5C5E_u6027" class="headerlink" title="（三）、属性"></a>（三）、属性</h3><p>（1）APP_PROJECT_PATH</p>
<p>（2）APP_OPTIM</p>
<p>（3）APP_OPTIM</p>
<p>（4）APP_CFLAGS</p>
<p>（5）APP_CPPFLAGS</p>
<p>（6）APP_LDFLAGS</p>
<p>（7）APP_BUILD_SCRIPT</p>
<p>（8）APP_ABI</p>
<p>（9）APP_PLATFORM</p>
<p>（10）APP_STL</p>
<p>（11）APP_SHORT_COMMANDS</p>
<p>（12）APP_SHORT_COMMANDS</p>
<p>（13）APP_PIE</p>
<p>（14）APP_THIN_ARCHIVE</p>
<h2 id="u56DB_u3001ndk-build"><a href="#u56DB_u3001ndk-build" class="headerlink" title="四、ndk-build"></a>四、ndk-build</h2><h3 id="uFF08_u4E00_uFF09_u3001_u6838_u5FC3"><a href="#uFF08_u4E00_uFF09_u3001_u6838_u5FC3" class="headerlink" title="（一）、核心"></a>（一）、核心</h3><h3 id="uFF08_u4E8C_uFF09_u3001_u8FD0_u884C"><a href="#uFF08_u4E8C_uFF09_u3001_u8FD0_u884C" class="headerlink" title="（二）、运行"></a>（二）、运行</h3><h3 id="uFF08_u4E09_uFF09_u3001_u53EF_u9009_u53C2_u6570"><a href="#uFF08_u4E09_uFF09_u3001_u53EF_u9009_u53C2_u6570" class="headerlink" title="（三）、可选参数"></a>（三）、可选参数</h3><h2 id="u4E94_u3001NDK_u5B9E_u6218"><a href="#u4E94_u3001NDK_u5B9E_u6218" class="headerlink" title="五、NDK实战"></a>五、NDK实战</h2><p>###<br>javah -jni io.github.yanbober.ndkapplication.NdkJniUtils</p>
<p>###<br>native 方法的第一个参数为 JNI接口指针 ：JNIEnv。<br>第二个参数</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/04/12/Android：NDK开发（一）/" data-id="cipdnp2gz000lvx2226ni6cyh" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Android：主题切换实现" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/06/Android：主题切换实现/" class="article-date">
  <time datetime="2016-04-06T10:58:34.000Z" itemprop="datePublished">2016-04-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/06/Android：主题切换实现/">Android：主题切换实现</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="http://www.cnblogs.com/punkisnotdead/p/4968851.html" target="_blank" rel="external">Android 实现切换主题皮肤功能</a></p>
<p><a href="http://www.hidroh.com/2015/02/16/support-multiple-themes-android-app/" target="_blank" rel="external">Supporting multiple themes in your Android app 1</a> 、 <a href="http://www.hidroh.com/2015/02/25/support-multiple-themes-android-app-part-2/" target="_blank" rel="external">2</a></p>
<p><a href="https://github.com/zzz40500/ThemeDemo" target="_blank" rel="external">日夜间模式切换 DEMO</a></p>
<p><a href="http://cyrilmottier.com/2012/11/27/actionbar-on-the-move/" target="_blank" rel="external">ActionBar on the Move</a></p>
<p>### </p>
<p>### </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/04/06/Android：主题切换实现/" data-id="cipdnp2gs000hvx222qfm9qpa" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Android：6-0运行时权限" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/06/Android：6-0运行时权限/" class="article-date">
  <time datetime="2016-04-06T02:47:42.000Z" itemprop="datePublished">2016-04-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/06/Android：6-0运行时权限/">Android：6.0运行时权限</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="http://developer.android.com/intl/zh-cn/training/permissions/index.html" target="_blank" rel="external">Working with System Permissions</a></p>
<p><a href="http://droidyue.com/blog/2016/01/17/understanding-marshmallow-runtime-permission/index.html" target="_blank" rel="external">聊一聊Android 6.0的运行时权限</a></p>
<p><a href="http://blog.csdn.net/caroline_wendy/article/details/50587230" target="_blank" rel="external">Android 6.0: 动态权限管理的解决方案</a></p>
<p>###Android 6.0运行时权限</p>
<h4 id="u6743_u9650_u58F0_u660E"><a href="#u6743_u9650_u58F0_u660E" class="headerlink" title="权限声明"></a>权限声明</h4><h4 id="u8BF7_u6C42_u8FD0_u884C_u65F6_u6743_u9650"><a href="#u8BF7_u6C42_u8FD0_u884C_u65F6_u6743_u9650" class="headerlink" title="请求运行时权限"></a>请求运行时权限</h4><h5 id="u6743_u9650_u68C0_u67E5"><a href="#u6743_u9650_u68C0_u67E5" class="headerlink" title="权限检查"></a>权限检查</h5><h4 id="u6743_u9650_u6700_u4F73_u5B9E_u8DF5"><a href="#u6743_u9650_u6700_u4F73_u5B9E_u8DF5" class="headerlink" title="权限最佳实践"></a>权限最佳实践</h4>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/04/06/Android：6-0运行时权限/" data-id="cipdnp2h5000ovx22c18lzofg" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Android源码学习：编译过程中的问题" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/04/Android源码学习：编译过程中的问题/" class="article-date">
  <time datetime="2016-03-04T02:12:38.000Z" itemprop="datePublished">2016-03-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android源码学习系列/">Android源码学习系列</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/04/Android源码学习：编译过程中的问题/">Android源码学习（二）：编译问题总结</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/03/04/Android源码学习：编译过程中的问题/" data-id="cipdnp2h9000rvx22nhgj3r8u" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Android  React Native系列（一）：学习路径" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/02/08/Android  React Native系列（一）：学习路径/" class="article-date">
  <time datetime="2016-02-08T08:02:51.000Z" itemprop="datePublished">2016-02-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/08/Android  React Native系列（一）：学习路径/">Android  React Native系列（一）：学习路径</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="u4E00_u3001JavaScript/HTML/CSS"><a href="#u4E00_u3001JavaScript/HTML/CSS" class="headerlink" title="一、JavaScript/HTML/CSS"></a>一、JavaScript/HTML/CSS</h3><ol>
<li><a href="http://es6.ruanyifeng.com/#README" target="_blank" rel="external">ECMAScript 6 入门</a></li>
<li><a href="http://gank.io/post/564151c1f1df1210001c9161" target="_blank" rel="external">给 JavaScript 初心者的 ES2015 实战</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects" target="_blank" rel="external">JavaScript 标准库</a></li>
</ol>
<h3 id="u4E8C_u3001NodeJs/Jquery"><a href="#u4E8C_u3001NodeJs/Jquery" class="headerlink" title="二、NodeJs/Jquery"></a>二、NodeJs/Jquery</h3><ol>
<li><a href="https://cnodejs.org/getstart" target="_blank" rel="external">Node.js 新手入门</a></li>
<li><a href="http://nqdeng.github.io/7-days-nodejs/" target="_blank" rel="external">七天学会NodeJS</a></li>
</ol>
<h3 id="u4E09_u3001ReactJs"><a href="#u4E09_u3001ReactJs" class="headerlink" title="三、ReactJs"></a>三、ReactJs</h3><ol>
<li><a href="http://reactjs.cn/react/docs/getting-started.html" target="_blank" rel="external">React</a></li>
</ol>
<h3 id="u56DB_u3001Flux/Redux"><a href="#u56DB_u3001Flux/Redux" class="headerlink" title="四、Flux/Redux"></a>四、Flux/Redux</h3><h3 id="u4E94_u3001React_Native"><a href="#u4E94_u3001React_Native" class="headerlink" title="五、React Native"></a>五、React Native</h3><ol>
<li><a href="http://reactnative.cn/" target="_blank" rel="external">React Native 中文网</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/02/08/Android  React Native系列（一）：学习路径/" data-id="cipdnp2hm0015vx22j1miig6e" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Android：RecyclerView" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/02/06/Android：RecyclerView/" class="article-date">
  <time datetime="2016-02-05T22:47:38.000Z" itemprop="datePublished">2016-02-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/06/Android：RecyclerView/">Android：RecyclerView</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="http://enoent.fr/blog/2015/01/18/recyclerview-basics/" target="_blank" rel="external">RecyclerView basics</a></p>
<h3 id="u4E00_u3001RecylerView__u4ECB_u7ECD"><a href="#u4E00_u3001RecylerView__u4ECB_u7ECD" class="headerlink" title="一、RecylerView 介绍"></a>一、RecylerView 介绍</h3><p><code>RecyclerView</code>是Android5.0之后V7包中的新特性。与<code>ListView</code>相似，但是比<code>ListView</code>更灵活，支持Android 2.1版本以上。<br>正如它的名字：当一个item隐藏的时候，隐藏的item会被再回收重用，绑定新的数据。而不是被销毁为新的item的创建新的布局。<br>RecylerView分为6个主要组件</p>
<ol>
<li><code>Adapter</code>：提供数据，类似<code>ListView</code>的</li>
<li><code>ItemAnimator</code>：item的添加、删除、修改、移动的动画效果</li>
<li><code>ItemDecoration</code>：添加图画或修改Item布局</li>
<li><code>LayoutManager</code>：指定Item如何布局（List、Grid…）</li>
<li><code>ViewHolder</code>：每个Item View的基础类</li>
<li><code>RecylerView</code>：将所有的组件绑定</li>
</ol>
<div style="text-align:center"><br>    <img src="http://res.cloudinary.com/dmfz9aun7/image/upload/v1456548610/android/recyclerview_uml.png" style="width:80%;"><br></div>

<h3 id="u4E8C_u3001RecyclerView_u5C55_u793A"><a href="#u4E8C_u3001RecyclerView_u5C55_u793A" class="headerlink" title="二、RecyclerView展示"></a>二、RecyclerView展示</h3><h4 id="1-_u51C6_u5907"><a href="#1-_u51C6_u5907" class="headerlink" title="1.准备"></a>1.准备</h4><p>Gradle添加 <code>RecyclerView</code>的supprt-v7包依赖<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile <span class="string">'com.android.support:recyclerview-v7:21.0.3'</span></span><br></pre></td></tr></table></figure></p>
<p>本篇文章也使用<code>CardViews</code>，因此建议添加对应的依赖<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile <span class="string">'com.android.support:cardview-v7:21.0.3'</span></span><br></pre></td></tr></table></figure></p>
<h4 id="2-BaseItem"><a href="#2-BaseItem" class="headerlink" title="2.BaseItem"></a>2.BaseItem</h4><p><code>BaseItem</code> 包含一个<code>title</code> 和一个<code>subtitle</code>属性。用来表示列表中每个<code>item</code><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Item</span></span>&#123;</span><br><span class="line">  <span class="keyword">private</span> String title;</span><br><span class="line">  <span class="keyword">private</span> String subtitle;</span><br><span class="line">  Item(String title , String subtitle)&#123;</span><br><span class="line">    <span class="keyword">this</span>.title = title;</span><br><span class="line">    <span class="keyword">this</span>.subtitle = subtitle;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getTitle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> title;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getSubtitle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> subtitle;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="3-Item_Layout"><a href="#3-Item_Layout" class="headerlink" title="3.Item Layout"></a>3.Item Layout</h4><p>使用<code>CardView</code>作为Item的展示Layout。<code>CardView</code>是具有装饰的<code>FrameLayout</code>。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">android.support.v7.widget.CardView</span></span><br><span class="line">  <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">  <span class="attribute">xmlns:app</span>=<span class="value">"http://schemas.android.com/apk/res-auto"</span></span><br><span class="line">  <span class="attribute">android:layout_width</span>=<span class="value">"match_parent</span><br><span class="line">  android:layout_height="</span><span class="value">match_parent"</span></span><br><span class="line">  <span class="attribute">app:contentPadding</span>=<span class="value">"8dp"</span></span><br><span class="line">  <span class="attribute">app:cardUseCompatPadding</span>=<span class="value">"true"</span> &gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="title">LinearLayout</span></span><br><span class="line">      <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">      <span class="attribute">android:layout_height</span>=<span class="value">"match_parent"</span></span><br><span class="line">      <span class="attribute">android:orientation</span>=<span class="value">"vertical"</span> &gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="title">TextView</span></span><br><span class="line">          <span class="attribute">android:id</span>=<span class="value">"@+id/title"</span></span><br><span class="line">          <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">          <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span></span><br><span class="line">          <span class="attribute">android:singleLine</span>=<span class="value">"true"</span></span><br><span class="line">          <span class="attribute">style</span>=<span class="value">"@style/Base.TextAppearance.AppCompat.Headline"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="title">TextView</span></span><br><span class="line">          <span class="attribute">android:id</span>=<span class="value">"@+id/subtitle"</span></span><br><span class="line">          <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">          <span class="attribute">android:layout_height</span>=<span class="value">"0dp"</span></span><br><span class="line">          <span class="attribute">android:layout_weight</span>=<span class="value">"1"</span></span><br><span class="line">          <span class="attribute">style</span>=<span class="value">"@style/Base.TextAppearance.AppCompat.Subhead"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="title">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">android.support.v7.widget.CardView</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h4 id="4-adapter"><a href="#4-adapter" class="headerlink" title="4.adapter"></a>4.adapter</h4><ol>
<li><p>定义<code>ViewHolder</code>类，必须继承<code>RecyclerView.ViewHolder</code>。同时需要存储绑定数据时需要使用到的View的对象。<br>例子中我们需要两个TextView</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">Adapter</span>.<span class="title">ViewHolder</span>&gt; </span>&#123;</span><br><span class="line">  <span class="annotation">@SuppressWarnings</span>(<span class="string">"unused"</span>)</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = Adapter.class.getSimpleName();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewHolder</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span> </span>&#123;</span><br><span class="line">    TextView title;</span><br><span class="line">    TextView subtitle;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ViewHolder</span><span class="params">(View itemView)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(itemView);</span><br><span class="line"></span><br><span class="line">        title = (TextView) itemView.findViewById(R.id.title);</span><br><span class="line">        subtitle = (TextView) itemView.findViewById(R.id.subtitle);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用<code>Collection</code>存储对象的集合，简单起见，例子中使用<code>ArrayList</code>来存储列表数据。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">Adapter</span>.<span class="title">ViewHolder</span>&gt; </span>&#123;</span><br><span class="line">  <span class="annotation">@SuppressWarnings</span>(<span class="string">"unused"</span>)</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = Adapter.class.getSimpleName();</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ITEM_COUNT = <span class="number">50</span>;</span><br><span class="line">  <span class="keyword">private</span> List&lt;Item&gt; items;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Adapter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建item的列表</span></span><br><span class="line">    items = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ITEM_COUNT; ++i) &#123;</span><br><span class="line">        items.add(<span class="keyword">new</span> Item(<span class="string">"Item "</span> + i, <span class="string">"This is the item number "</span> + i));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 省略ViewHolder的定义</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>实现<code>RecyclerView.Adapter</code>的方法。</p>
</li>
</ol>
<ul>
<li><p>onCreateViewHolder(ViewGroup parent, int viewType) </p>
<p>  创建View，返回匹配的ViewHolder</p>
</li>
<li><p>onBindViewHolder(ViewHolder holder, int position) </p>
<p>  根据Item的position，给ViewHolder绑定数据</p>
</li>
<li><p>getItemCount()</p>
<p>  返回Adapter的item的数量</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">Adapter</span>.<span class="title">ViewHolder</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// Attributes and constructor omitted</span></span><br><span class="line"></span><br><span class="line">  <span class="annotation">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> ViewHolder <span class="title">onCreateViewHolder</span><span class="params">(ViewGroup parent, <span class="keyword">int</span> viewType)</span> </span>&#123;</span><br><span class="line">    View v = LayoutInflater.from(parent.getContext()).inflate(R.layout.item, parent, <span class="keyword">false</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ViewHolder(v);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="annotation">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(ViewHolder holder, <span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Item item = items.get(position);</span><br><span class="line"></span><br><span class="line">    holder.title.setText(item.getTitle());</span><br><span class="line">    holder.subtitle.setText(item.getSubtitle());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="annotation">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> items.size();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 省略ViewHolder的定义</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="5-_Bind_everything_together"><a href="#5-_Bind_everything_together" class="headerlink" title="5. Bind everything together"></a>5. Bind everything together</h4><ol>
<li><p>在Activity的布局文件中添加<code>RecyclerView</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;RelativeLayout</span><br><span class="line">  xmlns:android="http://schemas.android.com/apk/res/android"</span><br><span class="line">  xmlns:tools="http://schemas.android.com/tools"</span><br><span class="line">  android:layout_width="match_parent"</span><br><span class="line">  android:layout_height="match_parent"</span><br><span class="line">  tools:context=".MainActivity" &gt;</span><br><span class="line"></span><br><span class="line">  &lt;android.support.v7.widget.RecyclerView</span><br><span class="line">    android:id="@+id/recycler_view"</span><br><span class="line">    android:layout_width="match_parent"</span><br><span class="line">    android:layout_height="match_parent" /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/RelativeLayout&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用<code>LinearLayoutManager</code>，<code>DefaultItemAnimator</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">ActionBarActivity</span> </span>&#123;</span><br><span class="line">  <span class="annotation">@SuppressWarnings</span>(<span class="string">"unused"</span>)</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = MainActivity.class.getSimpleName();</span><br><span class="line"></span><br><span class="line">  <span class="annotation">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">    RecyclerView recyclerView = (RecyclerView) findViewById(R.id.recycler_view);</span><br><span class="line">    recyclerView.setAdapter(<span class="keyword">new</span> Adapter());</span><br><span class="line">    recyclerView.setItemAnimator(<span class="keyword">new</span> DefaultItemAnimator());</span><br><span class="line">    recyclerView.setLayoutManager(<span class="keyword">new</span> LinearLayoutManager(<span class="keyword">this</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>编译、运行</p>
</li>
</ol>
<div style="text-align:center"><br>    <img src="http://res.cloudinary.com/dmfz9aun7/image/upload/v1456548620/android/recyclerview-1.png" style="width:35%;"><br></div>

<h3 id="u4E09_u3001_u76F8_u540CRecyclerView_u663E_u793A_u4E0D_u540C_u7C7B_u578B_u7684View"><a href="#u4E09_u3001_u76F8_u540CRecyclerView_u663E_u793A_u4E0D_u540C_u7C7B_u578B_u7684View" class="headerlink" title="三、相同RecyclerView显示不同类型的View"></a>三、相同RecyclerView显示不同类型的View</h3><p>假设现在要显示两种类型的Item。如一个远程音乐的列表和一些离线的专辑。可以为他们指定行为，显示指定的信息。</p>
<ol>
<li><p>在Item中添加<code>active</code>属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Item</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> String title;</span><br><span class="line">  <span class="keyword">private</span> String subtitle;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">boolean</span> active;</span><br><span class="line"></span><br><span class="line">  Item(String title, String subtitle, <span class="keyword">boolean</span> active) &#123;</span><br><span class="line">    <span class="keyword">this</span>.title = title;</span><br><span class="line">    <span class="keyword">this</span>.subtitle = subtitle;</span><br><span class="line">    <span class="keyword">this</span>.active = active;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getTitle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> title;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getSubtitle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> subtitle;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isActive</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> active;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改创建Item的方法，随机设定Item的<code>active</code>值，根据<code>active</code>来改变subtitle状态</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">Adapter</span>.<span class="title">ViewHolder</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// 忽略参数</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Adapter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建Item</span></span><br><span class="line">        Random random = <span class="keyword">new</span> Random();</span><br><span class="line">        items = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ITEM_COUNT; ++i) &#123;</span><br><span class="line">            items.add(<span class="keyword">new</span> Item(<span class="string">"Item "</span> + i, <span class="string">"This is the item number "</span> + i, random.nextBoolean()));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 忽略onCreateViewHolder</span></span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(ViewHolder holder, <span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> Item item = items.get(position);</span><br><span class="line"></span><br><span class="line">        holder.title.setText(item.getTitle());</span><br><span class="line">        holder.subtitle.setText(item.getSubtitle() + <span class="string">", which is "</span> +</span><br><span class="line">                (item.isActive() ? <span class="string">"active"</span> : <span class="string">"inactive"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// …</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>学会显示不同String是个好的开始，但是我们不仅仅要满足于此。在Adapter中你可能会注意到<code>onCreateViewHolder(ViewGroup parent, int viewType)</code>中的viewType我们没有使用。这里的<code>viewType</code>可以用来实现这样的需求：修改ViewHolder的实例。我们必须告诉<code>Adapter</code>来确定Item的类型。通过复写<code>getItemViewType(int position)</code>方法实现。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">Adapter</span>.<span class="title">ViewHolder</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// …</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TYPE_INACTIVE = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TYPE_ACTIVE = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// …</span></span><br><span class="line"></span><br><span class="line">  <span class="annotation">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemViewType</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Item item = items.get(position);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> item.isActive() ? TYPE_ACTIVE : TYPE_INACTIVE;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// …</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>现在根据你的需求有多种可能：为每种类型的View创建不同的<code>ViewHolder</code>或为相同的<code>ViewHolder</code> inflate 不同的Layout。简单起见，这里使用相同的<code>ViewHolder</code> inflate 不同的Layout。我们对<code>inactive</code>的Item继续使用现在的Layout，对<code>active</code>的Item创建一个新的Layout</p>
</li>
</ol>
<figure class="highlight xml"><figcaption><span>layout/item_active.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">android.support.v7.widget.CardView</span></span><br><span class="line">    <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    <span class="attribute">xmlns:app</span>=<span class="value">"http://schemas.android.com/apk/res-auto"</span></span><br><span class="line">    <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"match_parent"</span></span><br><span class="line">    <span class="attribute">app:contentPadding</span>=<span class="value">"8dp"</span></span><br><span class="line">    <span class="attribute">app:cardUseCompatPadding</span>=<span class="value">"true"</span> &gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">LinearLayout</span></span><br><span class="line">        <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">        <span class="attribute">android:layout_height</span>=<span class="value">"match_parent"</span></span><br><span class="line">        <span class="attribute">android:orientation</span>=<span class="value">"vertical"</span> &gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="title">TextView</span></span><br><span class="line">            <span class="attribute">android:id</span>=<span class="value">"@+id/title"</span></span><br><span class="line">            <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">            <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span></span><br><span class="line">            <span class="attribute">android:singleLine</span>=<span class="value">"true"</span></span><br><span class="line">            <span class="attribute">android:textColor</span>=<span class="value">"@color/material_deep_teal_500"</span></span><br><span class="line">            <span class="attribute">style</span>=<span class="value">"@style/Base.TextAppearance.AppCompat.Headline"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="title">TextView</span></span><br><span class="line">            <span class="attribute">android:id</span>=<span class="value">"@+id/subtitle"</span></span><br><span class="line">            <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">            <span class="attribute">android:layout_height</span>=<span class="value">"0dp"</span></span><br><span class="line">            <span class="attribute">android:layout_weight</span>=<span class="value">"1"</span></span><br><span class="line">            <span class="attribute">android:textColor</span>=<span class="value">"@color/material_blue_grey_900"</span></span><br><span class="line">            <span class="attribute">style</span>=<span class="value">"@style/Base.TextAppearance.AppCompat.Subhead"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="title">LinearLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">android.support.v7.widget.CardView</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol>
<li>最后也是最重要：在<code>onCreateViewHolder</code>方法中根据<code>viewType</code>值Inflate不同的Layout</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">Adapter</span>.<span class="title">ViewHolder</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// …</span></span><br><span class="line"></span><br><span class="line">  <span class="annotation">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> ViewHolder <span class="title">onCreateViewHolder</span><span class="params">(ViewGroup parent, <span class="keyword">int</span> viewType)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> layout = viewType == TYPE_INACTIVE ? R.layout.item : R.layout.item_active;</span><br><span class="line"></span><br><span class="line">    View v = LayoutInflater.from(parent.getContext()).inflate(layout, parent, <span class="keyword">false</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ViewHolder(v);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// …</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在我们可以区分<code>active</code>和<code>inactive</code> Item了</p>
<div style="text-align:center"><br>    <img src="http://res.cloudinary.com/dmfz9aun7/image/upload/v1456548620/android/recyclerview-active.png" style="width:35%;"><br></div>

<h3 id="u56DB_u3001Layout_managers"><a href="#u56DB_u3001Layout_managers" class="headerlink" title="四、Layout managers"></a>四、Layout managers</h3><h4 id="1-LinearLayoutManager"><a href="#1-LinearLayoutManager" class="headerlink" title="1.LinearLayoutManager"></a>1.LinearLayoutManager</h4><p>这个也是上面我们用的Manager，复制了<code>ListView</code>的特性。<code>Layout managers</code>占用三个参数</p>
<ul>
<li><code>Context</code> 不能为空  </li>
<li><code>int orientation</code> vertical（默认值）、horizontal</li>
<li><code>boolean reverseLayout</code> 是否反转Layout</li>
</ul>
<p>下面是<code>反转</code> <code>水平方向</code>的LinearLayoutManager</p>
<div style="text-align:center"><br>    <img src="http://res.cloudinary.com/dmfz9aun7/image/upload/v1456548621/android/recyclerview-linear-horizontal-reversed.png" style="width:35%;"><br></div>

<p>设置反转Layout时显示最右边无需滑动</p>
<h4 id="2-GridLayoutManager"><a href="#2-GridLayoutManager" class="headerlink" title="2.GridLayoutManager"></a>2.GridLayoutManager</h4><p>类似<code>GridView</code>。占用四个参数</p>
<ul>
<li><code>Context</code> 非空</li>
<li><code>int spanCount</code> 非空</li>
<li><code>int orientation</code> vertical（默认值）、horizontal</li>
<li><code>boolean reverseLayout</code> 是否反转Layout</li>
</ul>
<p>下面是<code>spanCount</code>为3，<code>vertical</code>方向，<code>非反转</code>的GridLayoutManager</p>
<div style="text-align:center"><br>    <img src="http://res.cloudinary.com/dmfz9aun7/image/upload/v1456548622/android/recyclerview-grid-3-vertical.png" style="width:35%;"><br></div>

<p><code>注意</code>：GridLayoutManager的<code>reverseLayout</code>属性只反转设定的反向。如设置orientation为<code>vertical</code>时，只垂直反转，水平方向不变。</p>
<div style="text-align:center"><br>    <img src="http://res.cloudinary.com/dmfz9aun7/image/upload/v1456548622/android/recyclerview-grid-3-vertical-reversed.png" style="width:35%;"><br></div>

<h4 id="3-StaggeredGridLayoutManager"><a href="#3-StaggeredGridLayoutManager" class="headerlink" title="3.StaggeredGridLayoutManager"></a>3.StaggeredGridLayoutManager</h4><p>StaggeredGridLayoutManager是<code>GridLayoutManager</code>的加强版。截止到<code>support-v7 21.0.0.3</code>版本的包中，StaggeredGridLayoutManager仍然还有很多<a href="https://code.google.com/p/android/issues/detail?id=93711" target="_blank" rel="external">bug</a>和<a href="https://code.google.com/p/android/issues/detail?id=93156" target="_blank" rel="external">困扰的问题</a>。和其他几种LayoutManager相比，<code>StaggeredGridLayoutManager</code>看上去像是匆忙完成的。同时需要注意的是它不需要<code>Context</code>，但是<code>orientation</code> 不能省略。同<code>GridLayoutManager</code>一样，需要指定<code>span</code>的数量。构造器中不提供<code>reverse</code> 参数，可以用代码来实现。<br>下面是固定Span的Grid，我们可以让Item占用整行或整列。让我们看看如何实现。用之前例子中创建的 <code>active/inactive</code>属性的item list，让<code>active</code>属性的item占满整行。在<code>adapter</code> 绑定数据的时候，来实现。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">Adapter</span>.<span class="title">ViewHolder</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// …</span></span><br><span class="line">  <span class="annotation">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(ViewHolder holder, <span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Item item = items.get(position);</span><br><span class="line"></span><br><span class="line">    holder.title.setText(item.getTitle());</span><br><span class="line">    holder.subtitle.setText(item.getSubtitle() + <span class="string">", which is "</span> + (item.isActive() ? <span class="string">"active"</span> : <span class="string">"inactive"</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Span the item if active</span></span><br><span class="line">    <span class="keyword">final</span> ViewGroup.LayoutParams lp = holder.itemView.getLayoutParams();</span><br><span class="line">    <span class="keyword">if</span> (lp <span class="keyword">instanceof</span> StaggeredGridLayoutManager.LayoutParams) &#123;</span><br><span class="line">        StaggeredGridLayoutManager.LayoutParams sglp = (StaggeredGridLayoutManager.LayoutParams) lp;</span><br><span class="line">        sglp.setFullSpan(item.isActive());</span><br><span class="line">        holder.itemView.setLayoutParams(sglp);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// …</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在代码判断如果LayoutManager是StaggeredGridLayoutManager的实例，来修改Layout参数。效果如图</p>
<div style="text-align:center"><br>    <img src="http://res.cloudinary.com/dmfz9aun7/image/upload/v1456548621/android/recyclerview-staggered-grid.png" style="width:35%;"><br></div>

<h3 id="u4E94_u3001Item_u70B9_u51FB_u54CD_u5E94"><a href="#u4E94_u3001Item_u70B9_u51FB_u54CD_u5E94" class="headerlink" title="五、Item点击响应"></a>五、Item点击响应</h3><p>与ListView 不同的是RecyclerView没有提供相关的点击响应事件的API，但是依然很容易来实现。现在我们需要监听每个Item的<code>click</code>和<code>long-click</code>事件.每个Item是由<code>ViewHolder</code>来显示的，每个<code>ViewHolder</code>是由根<code>View</code> 来初始化的。OK，用<code>View</code>来作为<code>click</code>和<code>long-click</code>事件的回调。最后只需要把<code>ViewHolder</code>和它的position对应起来即可，<code>RecyclerView.ViewHolder</code>已经提供对应的方法<del>getPosition()</del> ( getPosition() 方法废弃, 根据你的情况用<code>getLayoutPosition()</code> 或 <code>getAdapterPosition()</code>来替代 )来获取当前绑定的Item的postion<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">Adapter</span>.<span class="title">ViewHolder</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// …</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewHolder</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span>,</span><br><span class="line">        <span class="title">View</span>.<span class="title">OnLongClickListener</span> </span>&#123;</span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(<span class="string">"unused"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = ViewHolder.class.getSimpleName();</span><br><span class="line"></span><br><span class="line">    TextView title;</span><br><span class="line">    TextView subtitle;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ViewHolder</span><span class="params">(View itemView)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">super</span>(itemView);</span><br><span class="line"></span><br><span class="line">      title = (TextView) itemView.findViewById(R.id.title);</span><br><span class="line">      subtitle = (TextView) itemView.findViewById(R.id.subtitle);</span><br><span class="line"></span><br><span class="line">      itemView.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">      itemView.setOnLongClickListener(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">      Log.d(TAG, <span class="string">"Item clicked at position "</span> + getPosition());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onLongClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">      Log.d(TAG, <span class="string">"Item long-clicked at position "</span> + getPosition());</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="u516D_u3001_u9009_u62E9_u5904_u7406"><a href="#u516D_u3001_u9009_u62E9_u5904_u7406" class="headerlink" title="六、选择处理"></a>六、选择处理</h3><p><code>long-click</code>事件一个常用的模式是触发选择模式。再一次，<code>RecyclerView</code>没有帮助我们实现，但是实现起来也很简单。<br>分为三步</p>
<ul>
<li>维护一个选择状态</li>
<li>更新选中的Item的View</li>
<li>开启选择模式</li>
</ul>
<p>为了说明，我们添加一个选择Item的方式，然后移除选中的Item。</p>
<h4 id="1-_u9009_u62E9_u72B6_u6001"><a href="#1-_u9009_u62E9_u72B6_u6001" class="headerlink" title="1.选择状态"></a>1.选择状态</h4><p>我们需要修改<code>Adapter</code>来维护一个选中的item list。<code>Adapter</code>需要提供一下列表参数</p>
<ul>
<li>选中的元素列表</li>
<li>改变给定元素的选择状态</li>
</ul>
<p>我们加入额外的方法几个方法：</p>
<ul>
<li>检查指定的元素是否被选中</li>
<li>清空选中</li>
<li>提供选中元素的数量</li>
</ul>
<p>这里并不是随便选择这些方法，在下个部分我们需要它们。<br>我们注意到这五个方法都不是特定的Item，我们可以用普通方式写这些方法并重用<code>Adapter</code>的行为。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">SelectableAdapter</span>&lt;<span class="title">VH</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span>&gt; <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">VH</span>&gt; </span>&#123;</span><br><span class="line">  <span class="annotation">@SuppressWarnings</span>(<span class="string">"unused"</span>)</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = SelectableAdapter.class.getSimpleName();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> SparseBooleanArray selectedItems;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">SelectableAdapter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    selectedItems = <span class="keyword">new</span> SparseBooleanArray();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * 指定对应位置的Item是否被选中</span><br><span class="line">   * <span class="doctag">@param</span> Item的position</span><br><span class="line">   * <span class="doctag">@return</span> 如果是选中返回true，否则返回false</span><br><span class="line">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSelected</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> getSelectedItems().contains(position);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * 给定postion的Item的选中状态触发器</span><br><span class="line">   * <span class="doctag">@param</span> position item 的 postion</span><br><span class="line">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">toggleSelection</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (selectedItems.get(position, <span class="keyword">false</span>)) &#123;</span><br><span class="line">      selectedItems.delete(position);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      selectedItems.put(position, <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    notifyItemChanged(position);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * 清空所有Item的选中状态</span><br><span class="line">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clearSelection</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;Integer&gt; selection = getSelectedItems();</span><br><span class="line">    selectedItems.clear();</span><br><span class="line">    <span class="keyword">for</span> (Integer i : selection) &#123;</span><br><span class="line">      notifyItemChanged(i);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * 选中Item的数量</span><br><span class="line">   * <span class="doctag">@return</span> 选中Item的数量</span><br><span class="line">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSelectedItemCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> selectedItems.size();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * 被选中的Item的Id list</span><br><span class="line">   * <span class="doctag">@return</span> 被选中的Item的Id list</span><br><span class="line">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title">getSelectedItems</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;Integer&gt; items = <span class="keyword">new</span> ArrayList&lt;&gt;(selectedItems.size());</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; selectedItems.size(); ++i) &#123;</span><br><span class="line">      items.add(selectedItems.keyAt(i));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> items;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>最后<code>Adapter</code>继承我们创建<code>SelectableAdapter</code><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">extends</span> <span class="title">SelectableAdapter</span>&lt;<span class="title">Adapter</span>.<span class="title">ViewHolder</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// …</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="2-_u66F4_u65B0Item_u7684View"><a href="#2-_u66F4_u65B0Item_u7684View" class="headerlink" title="2.更新Item的View"></a>2.更新Item的View</h4><p>通知用户选中了一个Item，我们经常看到选中的View被覆盖某个颜色。在<code>item.xml</code>和<code>item_active.xml</code>中，我们添加一个<code>invisible</code>并带有颜色的View。因为这个View应该填充整个<code>CardView</code>，我们应该改变Layout的一些属性（将CardView的padding属性移动到LinearLayout中），View的颜色应该为透明的。<br>我们要用android Framework的<code>selectableItemBackground</code>为<code>CardView</code>的foreground设定属性值，来添加一个好看的触摸反馈。在Android 5.0以及以上，显示涟漪的效果，Android 5.0以下版本显示灰色。</p>
<figure class="highlight xml"><figcaption><span>item.xml（item_active.xml做对应的修改）</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">android.support.v7.widget.CardView</span></span><br><span class="line">    <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    <span class="attribute">xmlns:app</span>=<span class="value">"http://schemas.android.com/apk/res-auto"</span></span><br><span class="line">    <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"match_parent"</span></span><br><span class="line">    <span class="attribute">android:foreground</span>=<span class="value">"?android:attr/selectableItemBackground"</span></span><br><span class="line">    <span class="attribute">app:cardUseCompatPadding</span>=<span class="value">"true"</span> &gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">LinearLayout</span></span><br><span class="line">        <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">        <span class="attribute">android:layout_height</span>=<span class="value">"match_parent"</span></span><br><span class="line">        <span class="attribute">android:orientation</span>=<span class="value">"vertical"</span></span><br><span class="line">        <span class="attribute">android:padding</span>=<span class="value">"8dp"</span> &gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="title">TextView</span></span><br><span class="line">            <span class="attribute">android:id</span>=<span class="value">"@+id/title"</span></span><br><span class="line">            <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">            <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span></span><br><span class="line">            <span class="attribute">android:singleLine</span>=<span class="value">"true"</span></span><br><span class="line">            <span class="attribute">style</span>=<span class="value">"@style/Base.TextAppearance.AppCompat.Headline"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="title">TextView</span></span><br><span class="line">            <span class="attribute">android:id</span>=<span class="value">"@+id/subtitle"</span></span><br><span class="line">            <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">            <span class="attribute">android:layout_height</span>=<span class="value">"0dp"</span></span><br><span class="line">            <span class="attribute">android:layout_weight</span>=<span class="value">"1"</span></span><br><span class="line">            <span class="attribute">style</span>=<span class="value">"@style/Base.TextAppearance.AppCompat.Subhead"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="title">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">View</span></span><br><span class="line">        <span class="attribute">android:id</span>=<span class="value">"@+id/selected_overlay"</span></span><br><span class="line">        <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">        <span class="attribute">android:layout_height</span>=<span class="value">"match_parent"</span></span><br><span class="line">        <span class="attribute">android:background</span>=<span class="value">"@color/selected_overlay"</span></span><br><span class="line">        <span class="attribute">android:visibility</span>=<span class="value">"invisible"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">android.support.v7.widget.CardView</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>下一步决定什么时候显示这个效果，很明显需要 <code>Adapters</code>的<code>onBindViewHolder()</code>方法中。在<code>ViewHolder</code>中添加overlay view的属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">extends</span> <span class="title">SelectableAdapter</span>&lt;<span class="title">Adapter</span>.<span class="title">ViewHolder</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// …</span></span><br><span class="line"></span><br><span class="line">  <span class="annotation">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(ViewHolder holder, <span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Item item = items.get(position);</span><br><span class="line"></span><br><span class="line">    holder.title.setText(item.getTitle());</span><br><span class="line">    holder.subtitle.setText(item.getSubtitle() + <span class="string">", which is "</span> + (item.isActive() ? <span class="string">"active"</span> : <span class="string">"inactive"</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Span the item if active</span></span><br><span class="line">    <span class="keyword">final</span> ViewGroup.LayoutParams lp = holder.itemView.getLayoutParams();</span><br><span class="line">    <span class="keyword">if</span> (lp <span class="keyword">instanceof</span> StaggeredGridLayoutManager.LayoutParams) &#123;</span><br><span class="line">      StaggeredGridLayoutManager.LayoutParams sglp = (StaggeredGridLayoutManager.LayoutParams) lp;</span><br><span class="line">      sglp.setFullSpan(item.isActive());</span><br><span class="line">      holder.itemView.setLayoutParams(sglp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//  高亮选中的Item</span></span><br><span class="line">    holder.selectedOverlay.setVisibility(isSelected(position) ? View.VISIBLE : View.INVISIBLE);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// …</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewHolder</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span>,</span><br><span class="line">        <span class="title">View</span>.<span class="title">OnLongClickListener</span> </span>&#123;</span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(<span class="string">"unused"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = ViewHolder.class.getSimpleName();</span><br><span class="line"></span><br><span class="line">      TextView title;</span><br><span class="line">      TextView subtitle;</span><br><span class="line">      View selectedOverlay;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="title">ViewHolder</span><span class="params">(View itemView)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(itemView);</span><br><span class="line"></span><br><span class="line">        title = (TextView) itemView.findViewById(R.id.title);</span><br><span class="line">        subtitle = (TextView) itemView.findViewById(R.id.subtitle);</span><br><span class="line">        selectedOverlay = itemView.findViewById(R.id.selected_overlay);</span><br><span class="line"></span><br><span class="line">        itemView.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        itemView.setOnLongClickListener(<span class="keyword">this</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// …</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-_u5F00_u542F_u9009_u4E2D_u6A21_u5F0F"><a href="#3-_u5F00_u542F_u9009_u4E2D_u6A21_u5F0F" class="headerlink" title="3.开启选中模式"></a>3.开启选中模式</h4><p>最后一步可能有点复杂，但也不是很难。我们需要将<code>click</code>和<code>long-click</code>返回给<code>Activity</code>。用<code>ViewHolder</code>暴露一个<code>Listener</code>，通过<code>Adapter</code>传递它，实现需求。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">extends</span> <span class="title">SelectableAdapter</span>&lt;<span class="title">Adapter</span>.<span class="title">ViewHolder</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// …</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> ViewHolder.ClickListener clickListener;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Adapter</span><span class="params">(ViewHolder.ClickListener clickListener)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.clickListener = clickListener;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建Item</span></span><br><span class="line">    Random random = <span class="keyword">new</span> Random();</span><br><span class="line">    items = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ITEM_COUNT; ++i) &#123;</span><br><span class="line">      items.add(<span class="keyword">new</span> Item(<span class="string">"Item "</span> + i, <span class="string">"This is the item number "</span> + i, random.nextBoolean()));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="annotation">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> ViewHolder <span class="title">onCreateViewHolder</span><span class="params">(ViewGroup parent, <span class="keyword">int</span> viewType)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> layout = viewType == TYPE_INACTIVE ? R.layout.item : R.layout.item_active;</span><br><span class="line"></span><br><span class="line">    View v = LayoutInflater.from(parent.getContext()).inflate(layout, parent, <span class="keyword">false</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ViewHolder(v, clickListener);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// …</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewHolder</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span>,</span><br><span class="line">          <span class="title">View</span>.<span class="title">OnLongClickListener</span> </span>&#123;</span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(<span class="string">"unused"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = ViewHolder.class.getSimpleName();</span><br><span class="line"></span><br><span class="line">    TextView title;</span><br><span class="line">    TextView subtitle;</span><br><span class="line">    View selectedOverlay;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ClickListener listener;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ViewHolder</span><span class="params">(View itemView, ClickListener listener)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">super</span>(itemView);</span><br><span class="line"></span><br><span class="line">      title = (TextView) itemView.findViewById(R.id.title);</span><br><span class="line">      subtitle = (TextView) itemView.findViewById(R.id.subtitle);</span><br><span class="line">      selectedOverlay = itemView.findViewById(R.id.selected_overlay);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">this</span>.listener = listener;</span><br><span class="line"></span><br><span class="line">      itemView.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">      itemView.setOnLongClickListener(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (listener != <span class="keyword">null</span>) &#123;</span><br><span class="line">        listener.onItemClicked(getPosition());</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onLongClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (listener != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> listener.onItemLongClicked(getPosition());</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ClickListener</span> </span>&#123;</span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onItemClicked</span><span class="params">(<span class="keyword">int</span> position)</span></span>;</span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onItemLongClicked</span><span class="params">(<span class="keyword">int</span> position)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>我们用<code>ActionMode</code>来区分选择模式和正常模式，当选择模式被激活时显示不同的<code>ActionBar</code>。实现<code>ActionMode.Callback</code>来激活选择模式。简单起见，<code>Activity</code>使用一个内部类来实现其接口，同时实现我们我们新创建的Click接口<code>Adapter.ViewHolder.ClickListener</code>。我们需要<code>Callback</code>来访问<code>Adapter</code>，所以把<code>Adapter</code>作为<code>Activity</code>的一个属性。<br>我们的Activity看上去变得复杂了。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">ActionBarActivity</span> <span class="keyword">implements</span> <span class="title">Adapter</span>.<span class="title">ViewHolder</span>.<span class="title">ClickListener</span> </span>&#123;</span><br><span class="line">  <span class="annotation">@SuppressWarnings</span>(<span class="string">"unused"</span>)</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = MainActivity.class.getSimpleName();</span><br><span class="line">  <span class="keyword">private</span> Adapter adapter;</span><br><span class="line">  <span class="keyword">private</span> ActionModeCallback actionModeCallback = <span class="keyword">new</span> ActionModeCallback();</span><br><span class="line">  <span class="keyword">private</span> ActionMode actionMode;</span><br><span class="line"></span><br><span class="line">  <span class="annotation">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">    adapter = <span class="keyword">new</span> Adapter(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    RecyclerView recyclerView = (RecyclerView) findViewById(R.id.recycler_view);</span><br><span class="line">    recyclerView.setAdapter(adapter);</span><br><span class="line">    recyclerView.setItemAnimator(<span class="keyword">new</span> DefaultItemAnimator());</span><br><span class="line">    recyclerView.setLayoutManager(<span class="keyword">new</span> StaggeredGridLayoutManager(<span class="number">3</span>, StaggeredGridLayoutManager.VERTICAL));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="annotation">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onItemClicked</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (actionMode != <span class="keyword">null</span>) &#123;</span><br><span class="line">      toggleSelection(position);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="annotation">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onItemLongClicked</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (actionMode == <span class="keyword">null</span>) &#123;</span><br><span class="line">      actionMode = startSupportActionMode(actionModeCallback);</span><br><span class="line">    &#125;</span><br><span class="line">    toggleSelection(position);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * 触发Item的选中状态</span><br><span class="line">   *</span><br><span class="line">   * 如果选中的Item数量为0, 则关闭选中状态模式</span><br><span class="line">   * 注意：actionMode不能为空</span><br><span class="line">   *</span><br><span class="line">   * <span class="doctag">@param</span> position 触发选中状态的Item位置</span><br><span class="line">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">toggleSelection</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">    adapter.toggleSelection(position);</span><br><span class="line">    <span class="keyword">int</span> count = adapter.getSelectedItemCount();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (count == <span class="number">0</span>) &#123;</span><br><span class="line">      actionMode.finish();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      actionMode.setTitle(String.valueOf(count));</span><br><span class="line">      actionMode.invalidate();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ActionModeCallback</span> <span class="keyword">implements</span> <span class="title">ActionMode</span>.<span class="title">Callback</span> </span>&#123;</span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(<span class="string">"unused"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String TAG = ActionModeCallback.class.getSimpleName();</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onCreateActionMode</span><span class="params">(ActionMode mode, Menu menu)</span> </span>&#123;</span><br><span class="line">      mode.getMenuInflater().inflate (R.menu.selected_menu, menu);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onPrepareActionMode</span><span class="params">(ActionMode mode, Menu menu)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onActionItemClicked</span><span class="params">(ActionMode mode, MenuItem item)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">switch</span> (item.getItemId()) &#123;</span><br><span class="line">        <span class="keyword">case</span> R.id.menu_remove:</span><br><span class="line">          <span class="comment">// <span class="doctag">TODO:</span> 具体的移除Item操作</span></span><br><span class="line">          Log.d(TAG, <span class="string">"menu_remove"</span>);</span><br><span class="line">          mode.finish();</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="annotation">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroyActionMode</span><span class="params">(ActionMode mode)</span> </span>&#123;</span><br><span class="line">        adapter.clearSelection();</span><br><span class="line">        actionMode = <span class="keyword">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>下图显示<code>Item5</code>被选中时的截图</p>
<div style="text-align:center"><br>    <img src="http://res.cloudinary.com/dmfz9aun7/image/upload/v1456548622/android/recyclerview-selection.png" style="width:35%;"><br></div>

<h3 id="u4E03_u3001_u6539_u53D8_u6570_u636E"><a href="#u4E03_u3001_u6539_u53D8_u6570_u636E" class="headerlink" title="七、改变数据"></a>七、改变数据</h3><p>想要更新View，，<code>Adapter</code>必须来发出数据发生了变化的通知。在<code>ListView</code>上，adapter只有一个可以使用的方法<code>notifyDataSetChanged()</code>。然而这个方法还不很理想：需要刷新所有的View，因为我们不能够确切知道什么发生了变化。而<code>RecyclerView.Adapter</code>提供多种方法：</p>
<ul>
<li>notifyItemChanged(int position)</li>
<li>notifyItemInserted(int position)</li>
<li>notifyItemRemoved(int position)</li>
<li>notifyItemMoved(int fromPosition, int toPosition)</li>
<li>notifyItemRangeChanged(int positionStart, int itemCount)</li>
<li>notifyItemRangeInserted(int positionStart, int itemCount)</li>
<li>notifyItemRangeRemoved(int positionStart, int itemCount)</li>
<li>notifyDataSetChanged()</li>
</ul>
<p>我们可以知道Item或Items的变化、添加、移除、移动。<br>我们在<code>Adapter</code>中向外部类提供移除Item、Item List的两个<code>public</code>方法。如果直接移除一个Item，直接从列表移除即可。但是移除item list 并没有简单。举个例子，如果现在需要移除<code>[5 ,  8 , 9]</code> 三个位置的Item，当移除5位置的Item后，我们Item的list长度就会变短，因此list数据中原来的8变成了7。结果我们移除<code>[5 , 8 , 9]</code>三个位置的数据实际对应的是[5 , 7 , 7]。再考虑到一种情况如果是移除<code>[8 ， 9 ， 5]</code>三个位置的Item呢？<br>因此我们需要将提供需要移除的Item List进行逆序排序。这样我们就能简单调用<code>notifyItemRangeRemoved()</code>方法来移除item list。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">extends</span> <span class="title">SelectableAdapter</span>&lt;<span class="title">Adapter</span>.<span class="title">ViewHolder</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// …</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeItem</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">    items.remove(position);</span><br><span class="line">    notifyItemRemoved(position);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeItems</span><span class="params">(List&lt;Integer&gt; positions)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// list逆序排序</span></span><br><span class="line">    Collections.sort(positions, <span class="keyword">new</span> Comparator&lt;Integer&gt;() &#123;</span><br><span class="line">      <span class="annotation">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Integer lhs, Integer rhs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> rhs - lhs;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 拆分排列后的list</span></span><br><span class="line">    <span class="keyword">while</span> (!positions.isEmpty()) &#123;</span><br><span class="line">      <span class="keyword">if</span> (positions.size() == <span class="number">1</span>) &#123;</span><br><span class="line">        removeItem(positions.get(<span class="number">0</span>));</span><br><span class="line">        positions.remove(<span class="number">0</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (positions.size() &gt; count &amp;&amp; positions.get(count).equals(positions.get(count - <span class="number">1</span>) - <span class="number">1</span>)) &#123;</span><br><span class="line">          ++count;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (count == <span class="number">1</span>) &#123;</span><br><span class="line">          removeItem(positions.get(<span class="number">0</span>));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          removeRange(positions.get(count - <span class="number">1</span>), count);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; ++i) &#123;</span><br><span class="line">          positions.remove(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">removeRange</span><span class="params">(<span class="keyword">int</span> positionStart, <span class="keyword">int</span> itemCount)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; itemCount; ++i) &#123;</span><br><span class="line">      items.remove(positionStart);</span><br><span class="line">    &#125;</span><br><span class="line">    notifyItemRangeRemoved(positionStart, itemCount);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// …</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>最后在<code>Activity</code>中调用这两个方法，在<code>menu</code>菜单中创建<code>Remove</code>的操作。我们只需要在<code>Remove</code>菜单中调用<code>removeItems()</code>方法就可以了。我们可以在<code>click</code>中调用<code>removeItem()</code>方法来测试移除单个Item。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">ActionBarActivity</span> <span class="keyword">implements</span> <span class="title">Adapter</span>.<span class="title">ViewHolder</span>.<span class="title">ClickListener</span> </span>&#123;</span><br><span class="line">  <span class="comment">// …</span></span><br><span class="line"></span><br><span class="line">  <span class="annotation">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onItemClicked</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (actionMode != <span class="keyword">null</span>) &#123;</span><br><span class="line">      toggleSelection(position);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      adapter.removeItem(position);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// …</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ActionModeCallback</span> <span class="keyword">implements</span> <span class="title">ActionMode</span>.<span class="title">Callback</span> </span>&#123;</span><br><span class="line">    <span class="comment">// …</span></span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onActionItemClicked</span><span class="params">(ActionMode mode, MenuItem item)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">switch</span> (item.getItemId()) &#123;</span><br><span class="line">        <span class="keyword">case</span> R.id.menu_remove:</span><br><span class="line">          adapter.removeItems(adapter.getSelectedItems());</span><br><span class="line">          mode.finish();</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// …</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样我们就实现了移除Item功能了。与传统<code>notifyDataSetChanged()</code>的方法相比，我们还有额外的动画效果</p>
<div style="text-align:center"><br>    <img src="http://res.cloudinary.com/dmfz9aun7/image/upload/v1456548665/android/recyclerview-remove.gif" style="width:35%;"><br></div>

<h3 id="u516B_u3001_u603B_u7ED3"><a href="#u516B_u3001_u603B_u7ED3" class="headerlink" title="八、总结"></a>八、总结</h3><p><code>RecyclerView</code>使用相对<code>ListView</code>和<code>GridView</code>有一点复杂，但是提供了 viewholders、数据源、list等之间拆分的简单实现，动画效果提升了用户体验。<br>关于性能，对比<code>ListView</code>，两个都相似的实现了<code>ViewHolder</code>模式。然而用<code>RecyclerView</code>，你不得不选择<code>ViewHolder</code>模式。对于用户来说比没有使用<code>ViewHolder</code>有更好的体验，对于开发者来说，可以写出更好的代码。<br>同时，<code>RecyclerView</code>仍然有一些明显的不足（如：StaggeredGridLayoutManager），除此以外可以完美在项目中使用。</p>
<p>示例代码：<a href="https://github.com/Kernald/recyclerview-sample" target="_blank" rel="external">GitHub</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/02/06/Android：RecyclerView/" data-id="cipdnp2gv000jvx22doii0d8l" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android源码学习系列/">Android源码学习系列</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java设计模式/">Java设计模式</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/RxJava/">RxJava</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java设计模式/">Java设计模式</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RxJava/">RxJava</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android/">android</a><span class="tag-list-count">2</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Java设计模式/" style="font-size: 10px;">Java设计模式</a> <a href="/tags/RxJava/" style="font-size: 10px;">RxJava</a> <a href="/tags/android/" style="font-size: 20px;">android</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a><span class="archive-list-count">14</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/06/13/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2016/06/05/Android：Activity启动过程/">Android：Activity启动过程</a>
          </li>
        
          <li>
            <a href="/2016/05/17/RxJava读书笔记(一)/">RxJava读书笔记(一)</a>
          </li>
        
          <li>
            <a href="/2016/04/18/Android：NDK开发（二）/">Android NDK开发（二）：使用Android Studio开发进行NDK开发</a>
          </li>
        
          <li>
            <a href="/2016/04/12/Android：NDK开发（一）/">Android：NDK开发（一）</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>